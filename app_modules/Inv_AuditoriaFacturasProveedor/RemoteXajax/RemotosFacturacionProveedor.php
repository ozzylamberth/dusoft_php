<?php /**  * Archivo Xajax  * Tiene como responsabilidad hacer el manejo de las funciones  * que son invocadas por medio de xajax  *  * @package IPSOFT-SIIS  * @version $Revision: 1.11 $  * @copyright (C) 2009 IPSOFT - SA (www.ipsoft-sa.com)  * @author Sandra Viviana Pantoja Torres   */     /**  * Funcion que permite seleccionar el numero de contrato relacionado a un Proveedor  para modificar el contrato  * @param string $noId cadena numero de identificacion del proveedor  * @param string $tipoId cadena con el tipo de identificacion del proveedor  * @return Object $objResponse objeto de respuesta al formulario    */      		function ListadoTerceros($TipoIdTercero,$TerceroId,$Descripcion,$offset)		{  			$objResponse = new xajaxResponse();			$sql = AutoCarga::factory("FacturacionProveedorSQL", "classes", "app", "Inv_AuditoriaFacturasProveedor");						$datos =$sql->ObtenerTerceros($TipoIdTercero,$TerceroId,$Descripcion,$offset);						if(!empty($datos))			{								$action['paginador'] = "Paginador('".$TipoIdTercero."','".$TerceroId."','".$Descripcion."'";       				$pghtml = AutoCarga::factory("ClaseHTML");				$html .= $pghtml->ObtenerPaginadoXajax($sql->conteo,$sql->pagina,$action['paginador']);  				$url=ModuloGetURL("app","Inv_AuditoriaFacturasProveedor","controller","MenuPrincipal");		//		print_r($_REQUEST);								$html .= "<table width=\"95%\" class=\"modulo_table_list_title\" align=\"center\">";				$html .= "  <tr align=\" class=\"modulo_table_list_title\" >\n";				$html .= "      <td width=\"15%\">IDENTIFICACION</td>\n";				$html .= "      <td width=\"25%\">PROVEEDOR</td>\n";				$html .= "      <td width=\"10%\">TELEFONOS</td>\n";				$html .= "      <td width=\"18%\">DIRECCIÒN</td>\n";				$html .= "      <td  width=\"25%\" >E-M@IL</td>\n";				$html .= "      <td width=\"3%\">MENU.</td>\n";				$html .= "  </tr>\n";				$est = "modulo_list_claro"; $back = "#DDDDDD";				foreach($datos as $key => $dtl)				{		            $url_final= $url."&codigo_proveedor_id=".$dtl['codigo_proveedor_id']."&datos[empresa]=".$_REQUEST['datos']['empresa']."";					$html .= "  <tr class=\"modulo_list_claro\">\n";		            $html .= "      <td align=\"center\">".$dtl['tipo_id_tercero']." ".$dtl['tercero_id']."</td>\n";		            $html .= "      <td align=\"left\">".$dtl['nombre_tercero']."</td>\n";		            $html .= "      <td align=\"left\">".$dtl['telefono']."</td>\n";		            $html .= "      <td align=\"left\">".$dtl['direccion']."</td>\n";		            $html .= "      <td align=\"left\">".$dtl['email']."</td>\n";		            $html .= "      <td align=\"center\">\n";					$html .= "      <a href=\"".$url_final."\">\n";					$html .= "      <img src=\"".GetThemePath()."/images/ingresar.png\" border=\"0\" title=\"parametrizacion\">";					$html .= "      </a>\n";					$html .= "      </td>\n";                    $html .= "  </tr>\n";				}             	        $html .= "	</table><br>\n";	        $html .= "	<br>\n";	        }	        else	        {	           $html .= "<br><center class=\"label_error\">NO SE ENCONTRARON REGISTROS PARA LA BUSQUEDA REALIZADA</center><br>\n";	        }						$objResponse->assign("ListadoTerceros","innerHTML",$objResponse->setTildes($html));			return $objResponse;		}		function VerificarFactura($NumeroFactura,$CodigoProveedorId)		{    		$objResponse = new xajaxResponse();										$html .= "<center>\n";						    $html .= "  <label class=\"label_error\">ADVERTENCIA:!DESPUES DE VERIFICAR, NO SE PUEDE MODIFICAR¡</label>\n";						    $html .= "</center>\n";														$html .= "<center>\n";						    $html .= "  <div class=\"label_error\" id=\"error\"></div>\n";						    $html .= "</center>\n";														$select .= "<select class=\"select\" name=\"calificacion_verificacion\">";							$select .= "<option value=\"1\">BIEN</option>";							$select .= "<option value=\"0\">MAL</option>";							$select .= "</select>";																					$html .= "					<form name=\"FormaVerificar\" id=\"FormaVerificar\" method=\"post\">";										$html .= "	<table align=\"center\" border=\"0\" width=\"80%\" class=\"modulo_table_list\">\n";							//print_r($request);					        $html .= "		<tr class=\"formulacion_table_list\" >\n";							$html .= "			<td width=\"20%\" colspan=\"7\">Datos Para La Verifcacion De La Factura</td>\n";					  		$html .= "		</tr>\n";														$html .= "		<tr >\n";							$html .= "			<td width=\"40%\"><b>NUMERO FACTURA PROVEEDOR</b></td><td width=\"60%\"><input style=\"width:100%;height:100%\" readonly=\"true\" value=\"".$NumeroFactura."\" type=\"text\" class=\"input-text\" name=\"numero_factura\" ></td>\n";							$html .= "		</tr >\n";							$html .= "		<tr >\n";							$html .= "			<td width=\"40%\"><b>CALIFICACION FACTURA</b></td><td width=\"60%\">".$select."</td>\n";							$html .= "		</tr >\n";							$html .= "		<tr >\n";					  		$html .= "			<td width=\"40%\"><b>OBSERVACIONES</b></td><td width=\"60%\"><textarea style=\"width:100%;height:100%\" name=\"observacion_verificacion\"></textarea></td>\n";							$html .= "		</tr >\n";							$html .= "		<tr ".$clase." onmouseout=mOut(this,\"".$bck."\"); onmouseover=\"mOvr(this,'#FFFFFF');\" >\n";							$html .= "			<td align=\"center\" colspan=\"2\">\n";							$html .= "			".$hidden." ";														$html .= "		<input type=\"hidden\" name=\"codigo_proveedor_id\" value=\"".$CodigoProveedorId."\">";							$html .= "			<input type=\"button\" value=\"VERIFICAR\" class=\"modulo_table_list\" onclick=\"Validar(xajax.getFormValues('FormaVerificar'));\">\n";							$html .= "			</td>";							$html .= "		</tr>\n";																  																		        $html .= "		</table>\n";							$html .= "					 </form>";																$html .= "		<br>\n";												      		    			$objResponse->assign("Contenido","innerHTML",$objResponse->setTildes($html));			$objResponse->call("MostrarSpan");						return $objResponse;		}					function Verificar($Formulario)		{			$objResponse = new xajaxResponse();			$sql = AutoCarga::factory("FacturacionProveedorSQL", "classes", "app", "Inv_AuditoriaFacturasProveedor");			$url .= "&datos[empresa]=".$_REQUEST['datos']['empresa']."&codigo_proveedor_id=".$_REQUEST['codigo_proveedor_id']."&numero_factura=".$_REQUEST['numero_factura']."";			$UrlVerFactura=ModuloGetURL("app", "Inv_AuditoriaFacturasProveedor", "controller", "VerFactura")."".$url;			$TokenFactura = $sql->RegistrarVerificacionFacturaProveedor($Formulario);				if($TokenFactura)								{								$html .= "<center>\n";						        $html .= "  <label class=\"label_error\">Exito En El Ingreso!!!</label>\n";						        $html .= "</center>\n";								$url = ModuloGetURL("app", "Compras_Orden_Compras", "controller", "Empresas");								$objResponse->Alert("Documento Verificado!!!");								$objResponse->script("								var pagina='".$UrlVerFactura."';								document.location.href=pagina;");								}								else									{									$objResponse->alert("Error En La Verificacion!!");									}			return $objResponse;		}	function ListarFacturasProveedor($EmpresaId,$CodigoProveedorId,$fecha_Inicio,$Fecha_Final,$offset)		{    		$objResponse = new xajaxResponse();			$sql = AutoCarga::factory("FacturacionProveedorSQL", "classes", "app", "Inv_AuditoriaFacturasProveedor");			$datos =$sql->ListarFacturasProveedor($EmpresaId,$CodigoProveedorId,$fecha_Inicio,$Fecha_Final,$offset);			//$url  .= "&datos[empresa]=".$_REQUEST['datos']['empresa']."&codigo_proveedor_id=".$_REQUEST['codigo_proveedor_id']."";				$UrlVerFactura=ModuloGetURL("app", "Inv_AuditoriaFacturasProveedor", "controller", "VerFactura");			$pghtml = AutoCarga::factory("ClaseHTML");										if(!empty($datos))					      {							$action['paginador'] = "Paginador('".$EmpresaId."','".$CodigoProveedorId."','".$fecha_Inicio."','".$Fecha_Final."'";							$html .= $pghtml->ObtenerPaginadoXajax($sql->conteo,$sql->pagina,$action['paginador']);  					        $html .= "	<table align=\"center\" border=\"0\" width=\"60%\" class=\"modulo_table_list\">\n";					        $html .= "  </table>\n";					  		$html .= "  <br>\n";					        					        $html .= "	<table align=\"center\" border=\"0\" width=\"50%\" class=\"modulo_table_list\">\n";					        //print_r($request);					        if($fecha_Inicio != "" && $Fecha_Final!="")					        {					        $html .= "		<tr class=\"formulacion_table_list\" aling=\"center\">\n";					  		$html .= "			<td width=\"20%\" colspan=\"5\">Entre ".$fecha_Inicio." Y ".$Fecha_Final."</td>\n";					        $html .= "		</tr>\n";					        }					        							$html .= "		<tr class=\"formulacion_table_list\" >\n";							$html .= "			<td width=\"20%\">#FACTURA</td>\n";					  		$html .= "			<td width=\"30%\">FECHA</td>\n";					  		$html .= "			<td width=\"30%\">USUARIO</td>\n";					  		$html .= "			<td width=\"30%\">VERIFICAR</td>\n";					        $html .= "		</tr>\n";					        									        foreach($datos as $k1 => $dtl)									        {									          $est = ($est == 'modulo_list_oscuro')?'modulo_list_claro':'modulo_list_oscuro'; 									          $bck = ($bck == "#CCCCCC")? "#DDDDDD":"#CCCCCC";									    	$url  .= "&datos[empresa]=".$_REQUEST['datos']['empresa']."&codigo_proveedor_id=".$_REQUEST['codigo_proveedor_id']."&numero_factura=".$dtl['numero_factura']."";												$Url=$UrlVerFactura."".$url;											$html .= "		<tr ".$clase." onmouseout=mOut(this,\"".$bck."\"); onmouseover=\"mOvr(this,'#FFFFFF');\" >\n";							  				$html .= "			<td align=\"center\"><b>".$dtl['numero_factura']."</b></td>\n";									  		$html .= "			<td align=\"center\">".$dtl['fecha_registro']."</td>\n";									  		$html .= "			<td align=\"center\">".$dtl['nombre']."</td>\n";									  		$html .= "			<td align=\"center\">";											$html .= "					<a href=\"".$Url."\">";											$html .="					<img title=\"VER DETALLE DE LA FACTURA\" src=\"".GetThemePath()."/images/fileopen.png\" border=\"0\"></a>\n";											$html .= "			</td>\n";									  		$html .= "		</tr>\n";									        }					        $html .= "		</table>\n";							$html .= "		<br>\n";												      }					      else					      {					        $html .= "<center>\n";					        $html .= "  <label class=\"label_error\">NO SE ENCONTRARON REGISTROS PARA LA BUSQUEDA REALIZADA</label>\n";					        $html .= "</center>\n";					      }																$objResponse->assign("OrdenesCompra","innerHTML",$objResponse->setTildes($html));		return $objResponse;		}?>