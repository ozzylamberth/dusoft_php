<?php/** * @package IPSOFT-SIIS * @version $Id: app_Inv_FacturacionProveedor_controller.php,v 1.14 2010/01/26 22:40:55 sandra Exp $Revision: 1.14 $ * @copyright (C) 2009 IPSOFT - SA (www.ipsoft-sa.com) * @author Sandra Viviana Pantoja Torres  *//** * Clase Control: Inv_FacturacionProveedor * Clase encargada del control de llamado de metodos en el modulo * * @package IPSOFT-SIIS * @version $Revision: 1.14 $request = $_REQUEST;  / *///include '../../includes/WsCuentasxPagar.inc.php';class app_Inv_FacturacionProveedor_controller extends classModulo {    /**     * Constructor de la clase     */    function app_Inv_FacturacionProveedor_controller() {            }    /**     * Funcion principal del modulo     * @return boolean     */    function Main() {        $request = $_REQUEST;        $contratacion = AutoCarga::factory('PermisosSQL', '', 'app', 'Inv_FacturacionProveedor');        $action['volver'] = ModuloGetURL('system', 'Menu');        $permisos = $contratacion->ObtenerPermisos();        $ttl_gral = "FACTURACION PROVEEDOR (POR RECEPCION DE ORDEN DE COMPRA)";        $titulo[0] = 'EMPRESAS';        $url[0] = 'app';        $url[1] = 'Inv_FacturacionProveedor';        $url[2] = 'controller';        $url[3] = 'TercerosProveedores';        $url[4] = 'datos';        $this->salida = gui_theme_menu_acceso($ttl_gral, $titulo, $permisos, $url, $action['volver']);        return true;    }    /**     * Funcion Menu del modulo     * Funcion Menu para Todas Las Opciones Principales del Modulo     * @return boolean     */    function TercerosProveedores() {        $request = $_REQUEST;        $action['volver'] = ModuloGetURL("app", "Inv_FacturacionProveedor", "controller", "Main");        $Obj_Menu = AutoCarga::factory("FacturacionProveedorHTML", "views", "app", "Inv_FacturacionProveedor");        IncludeFileModulo("RemotosFacturacionProveedor", "RemoteXajax", "app", "Inv_FacturacionProveedor");        $this->SetXajax(array("ListadoTerceros"), null, "ISO-8859-1");        $sql = AutoCarga::factory("FacturacionProveedorSQL", "classes", "app", "Inv_FacturacionProveedor");        $tipos_id = $sql->ConsultarTipoId();        $this->salida = $Obj_Menu->Formabusquedaproveedores($action, $tipos_id);        return true;    }    /**     * Funcion Menu Principal De Contratacion Proveedores     * @return boolean     */    function MenuPrincipal() {        $request = $_REQUEST;                        $this->IncludeJS("CrossBrowser");        $this->IncludeJS("CrossBrowserEvent");        $this->IncludeJS("CrossBrowserDrag");        if ($_REQUEST['movimiento_bodega'] == "1") {            $url = "&bodegax=" . $_REQUEST['bodegax'] . "&utility=" . $_REQUEST['utility'];            $action['volver'] = ModuloGetURL('app', 'Inv_MovimientosBodegas', 'user', 'DocumentosBodega') . "" . $url;        } else {            $action['volver'] = ModuloGetURL("app", "Inv_FacturacionProveedor", "controller", "TercerosProveedores") . "&datos[empresa]=" . $_REQUEST['datos']['empresa'] . "";        }        $act = AutoCarga::factory("FacturacionProveedorHTML", "views", "app", "Inv_FacturacionProveedor");        $this->salida = $act->FormaMenu($action);        return true;    }    function RecepcionesParciales() {        $request = $_REQUEST;                        IncludeFileModulo("RemotosFacturacionProveedor", "RemoteXajax", "app", "Inv_FacturacionProveedor");        $this->SetXajax(array("BuscarOrdenDeCompra", "RecepcionesParcialesPorOC", "VerDetalleRecepcionParcial",            "FacturarRecepcionesParciales", "Facturar"), null, "ISO-8859-1");        $this->IncludeJS("CrossBrowser");        $this->IncludeJS("CrossBrowserEvent");        $this->IncludeJS("CrossBrowserDrag");        $this->IncludeJS("TabPaneLayout");        $this->IncludeJS("TabPaneApi");        $this->IncludeJS("TabPane");        /* if(=="1")          {          $url  .= ""."";          $action['volver']=ModuloGetURL('app','Inv_MovimientosBodegas','user','DocumentosBodega')."".$url;          }          else          { */        $url .= "&datos[empresa]=" . $_REQUEST['datos']['empresa'] . "&codigo_proveedor_id=" . $_REQUEST['codigo_proveedor_id'] . "&bodegax=" . $_REQUEST['bodegax'] . "&utility=" . $_REQUEST['utility'] . "&movimiento_bodega=" . $_REQUEST['movimiento_bodega'] . "";        $action['volver'] = ModuloGetURL("app", "Inv_FacturacionProveedor", "controller", "MenuPrincipal") . "" . $url;        //}        $act = AutoCarga::factory("FacturacionProveedorHTML", "views", "app", "Inv_FacturacionProveedor");        $sql = AutoCarga::factory("FacturacionProveedorSQL", "classes", "app", "Inv_FacturacionProveedor");        $TerceroProveedor = $sql->ConsultarTerceroProveedor($_REQUEST['codigo_proveedor_id']);        //print_r($TerceroProveedor);        $this->salida = $act->FormaOrdenesCompra($action, $TerceroProveedor);        //print_r($_REQUEST);        return true;    }    function ListarFacturas() {        $request = $_REQUEST;        IncludeFileModulo("RemotosFacturacionProveedor", "RemoteXajax", "app", "Inv_FacturacionProveedor");        $this->SetXajax(array("ListarFacturasProveedor", "sincronizar_facturas_pendientes_ws_fi"), null, "ISO-8859-1");        $this->IncludeJS("CrossBrowser");        $this->IncludeJS("CrossBrowserEvent");        $this->IncludeJS("CrossBrowserDrag");        $url .= "&datos[empresa]=" . $_REQUEST['datos']['empresa'] . "&codigo_proveedor_id=" . $_REQUEST['codigo_proveedor_id'] . "&bodegax=" . $_REQUEST['bodegax'] . "&utility=" . $_REQUEST['utility'] . "&movimiento_bodega=" . $_REQUEST['movimiento_bodega'] . "";        $action['volver'] = ModuloGetURL("app", "Inv_FacturacionProveedor", "controller", "MenuPrincipal") . "" . $url;        $act = AutoCarga::factory("FacturacionProveedorHTML", "views", "app", "Inv_FacturacionProveedor");        $sql = AutoCarga::factory("FacturacionProveedorSQL", "classes", "app", "Inv_FacturacionProveedor");        $TerceroProveedor = $sql->ConsultarTerceroProveedor($_REQUEST['codigo_proveedor_id']);        $this->salida = $act->ListarFacturasProveedor($action, $TerceroProveedor);        return true;    }    function VerFactura() {        $request = $_REQUEST;        $url .= "&datos[empresa]=" . $_REQUEST['datos']['empresa'] . "&codigo_proveedor_id=" . $_REQUEST['codigo_proveedor_id'] . "&bodegax=" . $_REQUEST['bodegax'] . "&utility=" . $_REQUEST['utility'] . "&movimiento_bodega=" . $_REQUEST['movimiento_bodega'] . "";        $action['volver'] = ModuloGetURL("app", "Inv_FacturacionProveedor", "controller", "ListarFacturas") . "" . $url;        $act = AutoCarga::factory("FacturacionProveedorHTML", "views", "app", "Inv_FacturacionProveedor");        $sql = AutoCarga::factory("FacturacionProveedorSQL", "classes", "app", "Inv_FacturacionProveedor");        $sql_2 = AutoCarga::factory("FacturasDespachoSQL", "classes", "app", "FacturasDespacho");        $TerceroProveedor = $sql->ConsultarTerceroProveedor($_REQUEST['codigo_proveedor_id']);        $FacturaProveedorCabecera = $sql->FacturaProveedorCabecera($_REQUEST['datos']['empresa'], $_REQUEST['codigo_proveedor_id'], $_REQUEST['numero_factura']);        $FacturaProveedorDetalle = $sql->FacturaProveedorDetalle($_REQUEST['datos']['empresa'], $_REQUEST['codigo_proveedor_id'], $_REQUEST['numero_factura']);        $Empresa = $sql->DatosEmpresa($FacturaProveedorCabecera[0]['empresa_id']);        $Parametros_Retencion = $sql_2->Parametros_Retencion($FacturaProveedorCabecera[0]['empresa_id'], $FacturaProveedorCabecera[0]['anio_factura']);        //print_r($Empresa);        $this->salida = $act->VerFacturaProveedor($action, $TerceroProveedor, $FacturaProveedorCabecera, $FacturaProveedorDetalle, $Empresa, $Parametros_Retencion);        return true;    }    function cuentas_x_pagar_fi() {        $request = $_REQUEST;                $dusoft_fi = AutoCarga::factory("SincronizacionDusoftFI", "SincronizacionDusoftFI", "", "");                $resultado_sincronizacion_ws = $dusoft_fi->cuentas_x_pagar_fi($request['empresa_id'], $request['codigo_proveedor_id'], $request['numero_factura']);                $params = "&mensaje_ws={$resultado_sincronizacion_ws['mensaje_ws']}&mensaje_bd={$resultado_sincronizacion_ws['mensaje_bd']}&datos[empresa]=" . $request['empresa_id'] . "&codigo_proveedor_id=" . $request['codigo_proveedor_id'] . "&bodegax=" . $_REQUEST['bodegax'] . "&utility=" . $_REQUEST['utility'] . "&movimiento_bodega=" . $_REQUEST['movimiento_bodega'] . "";        $url = ModuloGetURL('app', 'Inv_FacturacionProveedor', 'controller', 'RecepcionesParciales').$params;                        $html = "                <script>                    window.location='{$url}'                </script>                                ";                             $this->salida = $html;        return true;    }        }?>