/*   
-- 1. Creacion de pedidos
-- 2. Codificacion de productos
-- 3. Ordenes de compra
-- 4. Contratacion Productos Proveedor
-- 5. Contratacion
-- 6. Contratacion Productos Clientes
-- 7. Creacion Terceros
-- 8. Cuentas
** 9. Documentos Bodega
-- 10. Facturas Despacho
-- 11. Facturas Proveedores
-- 12. Formulacion Externa
-- 13. Ventas
-- 14. Devolucion Venta
-- 15. Bodegas Empresa
-- 16. Inventario Empresa
-- 17. Creacion Medicos
-- 18. Notas Proveedores
* 19. Parametros Iniciales*/

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_26 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_26 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_26 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_27 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_27 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_27 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_28 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_28 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_28 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_29 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_29 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_29 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_30 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_30 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_30 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_31 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_31 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_31 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_32 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_32 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_32 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_33 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_33 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_33 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_34 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_34 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_34 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_35 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_35 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_35 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_36 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_36 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_36 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_37 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_37 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_37 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_38 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_38 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_38 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_39 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_39 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_39 text;
  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_40 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_40 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_40 text;

ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_41 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_41 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_41 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_42 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_42 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_42 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_43 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_43 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_43 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_44 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_44 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_44 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_45 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_45 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_45 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_46 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_46 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_46 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_47 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_47 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_47 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_48 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_48 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_48 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_49 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_49 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_49 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_50 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_50 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_50 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_51 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_51 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_51 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_52 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_52 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_52 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_53 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_53 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_53 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_54 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_54 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_54 text;

  
ALTER TABLE public.auditorias_generales
  ADD COLUMN campo_55 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN nuevo_valor_55 text;
ALTER TABLE public.auditorias_generales
  ADD COLUMN antiguo_valor_55 text;

CREATE OR REPLACE FUNCTION public.au_codificacion_productos()
RETURNS trigger AS
$$
DECLARE

  indicador RECORD;
  columnas RECORD;
  
  old_codigo_producto 	character varying(50);
  old_grupo_id 	character varying(3);
  old_clase_id 	character varying(10);
  old_subclase_id character varying(10);
  old_producto_id character varying(4);
  old_descripcion 	character varying(120);
  old_descripcion_abreviada 	text;
  old_fabricante_id 	integer;
  old_unidad_id 	character varying(30);
  old_porc_iva 	numeric(5,3);
  old_estado character varying(1);
  old_codigo_invima 	character varying(30);
  old_contenido_unidad_venta 	character varying(60);
  old_sw_solicita_autorizacion 	character(1);
  old_codigo_barras 	character varying(30);
  old_vencimiento_codigo_invima 	date;
  old_codigo_mindefensa 	character varying(15);
  old_cod_acuerdo228_id 	character varying(20);
  old_mensaje_id 	character varying(6);
  old_codigo_alterno 	character varying(30);
  old_cantidad 	character varying(10);
  old_sw_generico 	character varying(1);
  old_cod_anatofarmacologico 	character varying(15);
  old_sw_pos 	character varying(1);
  old_sw_venta_directa 	character varying(1);
  old_cod_forma_farmacologica character varying(10);	
  old_codigo_cum character varying(40);	
  old_titular_reginvima_id 	character varying(4);
  old_tipo_producto_id character varying(1);	
  old_sw_control_fecha_vencimiento character varying(1);	
  old_cod_ihosp character varying(18);	
  old_sw_requiereautorizacion_despachospedidos character varying(1);
  old_tipo_pais_id character varying(4);	
  old_presentacioncomercial_id 	character varying(3);
  old_tratamiento_id integer;
  old_sw_ajusteautomatico integer;
  usuario_registro_ integer;
  fecha_registro timestamp;
  
  new_codigo_producto 	character varying(50);
  new_grupo_id 	character varying(3);
  new_clase_id 	character varying(10);
  new_subclase_id character varying(10);
  new_producto_id character varying(4);
  new_descripcion 	character varying(120);
  new_descripcion_abreviada 	text;
  new_fabricante_id 	integer;
  new_unidad_id 	character varying(30);
  new_porc_iva 	numeric(5,3);
  new_estado character varying(1);
  new_codigo_invima 	character varying(30);
  new_contenido_unidad_venta 	character varying(60);
  new_sw_solicita_autorizacion 	character(1);
  new_codigo_barras 	character varying(30);
  new_vencimiento_codigo_invima 	date;
  new_codigo_mindefensa 	character varying(15);
  new_cod_acuerdo228_id 	character varying(20);
  new_mensaje_id 	character varying(6);
  new_codigo_alterno 	character varying(30);
  new_cantidad 	character varying(10);
  new_sw_generico 	character varying(1);
  new_cod_anatofarmacologico 	character varying(15);
  new_sw_pos 	character varying(1);
  new_sw_venta_directa 	character varying(1);
  new_cod_forma_farmacologica character varying(10);	
  new_codigo_cum character varying(40);	
  new_titular_reginvima_id 	character varying(4);
  new_tipo_producto_id character varying(1);	
  new_sw_control_fecha_vencimiento character varying(1);	
  new_cod_ihosp character varying(18);	
  new_sw_requiereautorizacion_despachospedidos character varying(1);
  new_tipo_pais_id character varying(4);	
  new_presentacioncomercial_id 	character varying(3);
  new_tratamiento_id integer;
  new_sw_ajusteautomatico integer;
  
BEGIN
  SELECT * INTO indicador
  FROM   acciones AC,
         novedad_x_acciones NA
  WHERE  AC.descripcion = TG_OP
  AND    NA.accion_id = AC.accion_id
  AND    NA.table_name = 'inventarios_productos';
 
 /* Inicializar Variables */
 
  IF TG_OP = 'DELETE' THEN
   
  old_codigo_producto := OLD.codigo_producto;
  old_grupo_id := OLD.grupo_id;	
  old_clase_id := OLD.clase_id;	 
  old_subclase_id  := OLD.subclase_id;
  old_producto_id  := OLD.producto_id;
  old_descripcion 	:= OLD.descripcion;
  old_descripcion_abreviada 	:= OLD.descripcion_abreviada;
  old_fabricante_id := OLD.fabricante_id;
  old_unidad_id := OLD.unidad_id;
  old_porc_iva 	:= OLD.porc_iva;
  old_estado  := OLD.estado;
  old_codigo_invima 	:= OLD.codigo_invima;
  old_contenido_unidad_venta 	:= OLD.contenido_unidad_venta;
  old_sw_solicita_autorizacion := OLD.sw_solicita_autorizacion;
  old_codigo_barras 	:= OLD.codigo_barras;
  old_vencimiento_codigo_invima := OLD.vencimiento_codigo_invima;
  old_codigo_mindefensa := OLD.codigo_mindefensa;
  old_cod_acuerdo228_id := OLD.cod_acuerdo228_id;
  old_mensaje_id := OLD.mensaje_id;
  old_codigo_alterno := OLD.codigo_alterno;
  old_cantidad 	:= OLD.cantidad;
  old_sw_generico := OLD.sw_generico;
  old_cod_anatofarmacologico := OLD.cod_anatofarmacologico;
  old_sw_pos := OLD.sw_pos;
  old_sw_venta_directa := OLD.sw_venta_directa;
  old_cod_forma_farmacologica  := OLD.cod_forma_farmacologica;
  old_codigo_cum  := OLD.codigo_cum;
  old_titular_reginvima_id 	:= OLD.titular_reginvima_id;
  old_tipo_producto_id := OLD.tipo_producto_id;
  old_sw_control_fecha_vencimiento := OLD.sw_control_fecha_vencimiento;
  old_cod_ihosp := OLD.cod_ihosp;
  old_sw_requiereautorizacion_despachospedidos := OLD.sw_requiereautorizacion_despachospedidos;
  old_tipo_pais_id  := OLD.tipo_pais_id;
  old_presentacioncomercial_id 	:= OLD.presentacioncomercial_id;
  old_tratamiento_id := OLD.tratamiento_id;
  old_sw_ajusteautomatico := OLD.sw_ajusteautomatico;
  usuario_registro_ := OLD.usuario_id;
  fecha_registro := OLD.fecha_registro;
  END IF; 
  
  IF TG_OP = 'UPDATE' THEN
  new_codigo_producto := NEW.codigo_producto;
  new_grupo_id := NEW.grupo_id;	
  new_clase_id := NEW.clase_id;	 
  new_subclase_id  := NEW.subclase_id;
  new_producto_id  := NEW.producto_id;
  new_descripcion 	:= NEW.descripcion;
  new_descripcion_abreviada 	:= NEW.descripcion_abreviada;
  new_fabricante_id := NEW.fabricante_id;
  new_unidad_id := NEW.unidad_id;
  new_porc_iva 	:= NEW.porc_iva;
  new_estado  := NEW.estado;
  new_codigo_invima 	:= NEW.codigo_invima;
  new_contenido_unidad_venta 	:= NEW.contenido_unidad_venta;
  new_sw_solicita_autorizacion := NEW.sw_solicita_autorizacion;
  new_codigo_barras 	:= NEW.codigo_barras;
  new_vencimiento_codigo_invima := NEW.vencimiento_codigo_invima;
  new_codigo_mindefensa := NEW.codigo_mindefensa;
  new_cod_acuerdo228_id := NEW.cod_acuerdo228_id;
  new_mensaje_id := NEW.mensaje_id;
  new_codigo_alterno := NEW.codigo_alterno;
  new_cantidad 	:= NEW.cantidad;
  new_sw_generico := NEW.sw_generico;
  new_cod_anatofarmacologico := NEW.cod_anatofarmacologico;
  new_sw_pos := NEW.sw_pos;
  new_sw_venta_directa := NEW.sw_venta_directa;
  new_cod_forma_farmacologica  := NEW.cod_forma_farmacologica;
  new_codigo_cum  := NEW.codigo_cum;
  new_titular_reginvima_id 	:= NEW.titular_reginvima_id;
  new_tipo_producto_id := NEW.tipo_producto_id;
  new_sw_control_fecha_vencimiento := NEW.sw_control_fecha_vencimiento;
  new_cod_ihosp := NEW.cod_ihosp;
  new_sw_requiereautorizacion_despachospedidos := NEW.sw_requiereautorizacion_despachospedidos;
  new_tipo_pais_id  := NEW.tipo_pais_id;
  new_presentacioncomercial_id 	:= NEW.presentacioncomercial_id;
  new_tratamiento_id := NEW.tratamiento_id;
  new_sw_ajusteautomatico := NEW.sw_ajusteautomatico;
  usuario_registro_ := NEW.usuario_id;
  fecha_registro := NEW.fecha_registro;
  
  old_codigo_producto := OLD.codigo_producto;
  old_grupo_id := OLD.grupo_id;	
  old_clase_id := OLD.clase_id;	 
  old_subclase_id  := OLD.subclase_id;
  old_producto_id  := OLD.producto_id;
  old_descripcion 	:= OLD.descripcion;
  old_descripcion_abreviada 	:= OLD.descripcion_abreviada;
  old_fabricante_id := OLD.fabricante_id;
  old_unidad_id := OLD.unidad_id;
  old_porc_iva 	:= OLD.porc_iva;
  old_estado  := OLD.estado;
  old_codigo_invima 	:= OLD.codigo_invima;
  old_contenido_unidad_venta 	:= OLD.contenido_unidad_venta;
  old_sw_solicita_autorizacion := OLD.sw_solicita_autorizacion;
  old_codigo_barras 	:= OLD.codigo_barras;
  old_vencimiento_codigo_invima := OLD.vencimiento_codigo_invima;
  old_codigo_mindefensa := OLD.codigo_mindefensa;
  old_cod_acuerdo228_id := OLD.cod_acuerdo228_id;
  old_mensaje_id := OLD.mensaje_id;
  old_codigo_alterno := OLD.codigo_alterno;
  old_cantidad 	:= OLD.cantidad;
  old_sw_generico := OLD.sw_generico;
  old_cod_anatofarmacologico := OLD.cod_anatofarmacologico;
  old_sw_pos := OLD.sw_pos;
  old_sw_venta_directa := OLD.sw_venta_directa;
  old_cod_forma_farmacologica  := OLD.cod_forma_farmacologica;
  old_codigo_cum  := OLD.codigo_cum;
  old_titular_reginvima_id 	:= OLD.titular_reginvima_id;
  old_tipo_producto_id := OLD.tipo_producto_id;
  old_sw_control_fecha_vencimiento := OLD.sw_control_fecha_vencimiento;
  old_cod_ihosp := OLD.cod_ihosp;
  old_sw_requiereautorizacion_despachospedidos := OLD.sw_requiereautorizacion_despachospedidos;
  old_tipo_pais_id  := OLD.tipo_pais_id;
  old_presentacioncomercial_id 	:= OLD.presentacioncomercial_id;
  old_tratamiento_id := OLD.tratamiento_id;
  old_sw_ajusteautomatico := OLD.sw_ajusteautomatico;
  END IF; 
  
  IF TG_OP = 'INSERT' THEN
  new_codigo_producto := NEW.codigo_producto;
  new_grupo_id := NEW.grupo_id;	
  new_clase_id := NEW.clase_id;	 
  new_subclase_id  := NEW.subclase_id;
  new_producto_id  := NEW.producto_id;
  new_descripcion 	:= NEW.descripcion;
  new_descripcion_abreviada 	:= NEW.descripcion_abreviada;
  new_fabricante_id := NEW.fabricante_id;
  new_unidad_id := NEW.unidad_id;
  new_porc_iva 	:= NEW.porc_iva;
  new_estado  := NEW.estado;
  new_codigo_invima 	:= NEW.codigo_invima;
  new_contenido_unidad_venta 	:= NEW.contenido_unidad_venta;
  new_sw_solicita_autorizacion := NEW.sw_solicita_autorizacion;
  new_codigo_barras 	:= NEW.codigo_barras;
  new_vencimiento_codigo_invima := NEW.vencimiento_codigo_invima;
  new_codigo_mindefensa := NEW.codigo_mindefensa;
  new_cod_acuerdo228_id := NEW.cod_acuerdo228_id;
  new_mensaje_id := NEW.mensaje_id;
  new_codigo_alterno := NEW.codigo_alterno;
  new_cantidad 	:= NEW.cantidad;
  new_sw_generico := NEW.sw_generico;
  new_cod_anatofarmacologico := NEW.cod_anatofarmacologico;
  new_sw_pos := NEW.sw_pos;
  new_sw_venta_directa := NEW.sw_venta_directa;
  new_cod_forma_farmacologica  := NEW.cod_forma_farmacologica;
  new_codigo_cum  := NEW.codigo_cum;
  new_titular_reginvima_id 	:= NEW.titular_reginvima_id;
  new_tipo_producto_id := NEW.tipo_producto_id;
  new_sw_control_fecha_vencimiento := NEW.sw_control_fecha_vencimiento;
  new_cod_ihosp := NEW.cod_ihosp;
  new_sw_requiereautorizacion_despachospedidos := NEW.sw_requiereautorizacion_despachospedidos;
  new_tipo_pais_id  := NEW.tipo_pais_id;
  new_presentacioncomercial_id 	:= NEW.presentacioncomercial_id;
  new_tratamiento_id := NEW.tratamiento_id;
  new_sw_ajusteautomatico := NEW.sw_ajusteautomatico;
  usuario_registro_ := NEW.usuario_id;
  fecha_registro := NEW.fecha_registro;
  END IF;
  IF indicador.accion_id IS NOT NULL THEN
    INSERT INTO auditorias_generales
    (
      accion_id,
      novedad_indicador_id,
      table_name,
      
      campo_1, 
      nuevo_valor_1,
      antiguo_valor_1 ,    
      
      campo_2, 
      nuevo_valor_2,
      antiguo_valor_2,
      
      campo_3, 
      nuevo_valor_3,
      antiguo_valor_3,
      
      campo_4, 
      nuevo_valor_4,
      antiguo_valor_4,
      
      campo_5, 
      nuevo_valor_5,
      antiguo_valor_5,
      
      campo_6, 
      nuevo_valor_6,
      antiguo_valor_6,
      
      campo_7, 
      nuevo_valor_7,
      antiguo_valor_7,
      
      campo_8, 
      nuevo_valor_8,
      antiguo_valor_8,
 
      campo_9, 
      nuevo_valor_9,
      antiguo_valor_9,

      campo_10, 
      nuevo_valor_10,
      antiguo_valor_10,

      campo_11, 
      nuevo_valor_11,
      antiguo_valor_11,

      campo_12, 
      nuevo_valor_12,
      antiguo_valor_12,

      campo_13, 
      nuevo_valor_13,
      antiguo_valor_13,

      campo_14, 
      nuevo_valor_14,
      antiguo_valor_14,

      campo_15, 
      nuevo_valor_15,
      antiguo_valor_15,

      campo_16, 
      nuevo_valor_16,
      antiguo_valor_16,

      campo_17, 
      nuevo_valor_17,
      antiguo_valor_17,

      campo_18, 
      nuevo_valor_18,
      antiguo_valor_18,

      campo_19, 
      nuevo_valor_19,
      antiguo_valor_19,

      campo_20, 
      nuevo_valor_20,
      antiguo_valor_20,

      campo_21, 
      nuevo_valor_21,
      antiguo_valor_21,

      campo_22, 
      nuevo_valor_22,
      antiguo_valor_22,

      campo_23, 
      nuevo_valor_23,
      antiguo_valor_23,

      campo_24, 
      nuevo_valor_24,
      antiguo_valor_24,

      campo_25, 
      nuevo_valor_25,
      antiguo_valor_25,

      campo_26, 
      nuevo_valor_26,
      antiguo_valor_26,

      campo_27, 
      nuevo_valor_27,
      antiguo_valor_27,

      campo_28, 
      nuevo_valor_28,
      antiguo_valor_28,

      campo_29, 
      nuevo_valor_29,
      antiguo_valor_29,

      campo_30, 
      nuevo_valor_30,
      antiguo_valor_30,

      campo_31, 
      nuevo_valor_31,
      antiguo_valor_31,
      
      campo_32, 
      nuevo_valor_32,
      antiguo_valor_32,

      campo_33, 
      nuevo_valor_33,
      antiguo_valor_33,

      campo_34, 
      nuevo_valor_34,
      antiguo_valor_34,

      campo_35, 
      nuevo_valor_35,
      antiguo_valor_35,

      campo_36, 
      nuevo_valor_36,
      antiguo_valor_36,

     usuario_registro

    )
    VALUES
    (
      indicador.accion_id,
      indicador.novedad_indicador_id,
      'inventarios_productos',
      
      'codigo_producto',
      new_codigo_producto,
      old_codigo_producto,
      
      'grupo_id',    
      new_grupo_id,
      old_grupo_id,
      
      'clase_id',
      new_clase_id,
      old_clase_id,
      
      'subclase_id',
      new_subclase_id,
      old_subclase_id,
      
      'producto_id',
      new_producto_id,
      old_producto_id,
      
      'descripcion',
      new_descripcion,
      old_descripcion,
      
      'descripcion_abreviada',
      new_descripcion_abreviada,
      old_descripcion_abreviada,
      
      'fabricante_id',
      new_fabricante_id,
      old_fabricante_id,

      'unidad_id',
      new_unidad_id,
      old_unidad_id,

      'porc_iva',
      new_porc_iva,
      old_porc_iva,

      'estado',
      new_estado,
      old_estado,

      'codigo_invima',
      new_codigo_invima,
      old_codigo_invima,

      'contenido_unidad_venta',
      new_contenido_unidad_venta,
      old_contenido_unidad_venta,

      'sw_solicita_autorizacion',
      new_sw_solicita_autorizacion,
      old_sw_solicita_autorizacion,

      'codigo_barras',
      new_codigo_barras,
      old_codigo_barras,

      'vencimiento_codigo_invima',
      new_vencimiento_codigo_invima,
      old_vencimiento_codigo_invima,

      'codigo_mindefensa',
      new_codigo_mindefensa,
      old_codigo_mindefensa,

      'cod_acuerdo228_id',
      new_cod_acuerdo228_id,
      old_cod_acuerdo228_id,

      'mensaje_id',
      new_mensaje_id,
      old_mensaje_id,

      'codigo_alterno',
      new_codigo_alterno,
      old_codigo_alterno,

      'cantidad',
      new_cantidad,
      old_cantidad,

      'sw_generico',
      new_sw_generico,
      old_sw_generico,

      'cod_anatofarmacologico',
      new_cod_anatofarmacologico,
      old_cod_anatofarmacologico,

      'sw_pos',
      new_sw_pos,
      old_sw_pos,

      'sw_venta_directa',
      new_sw_venta_directa,
      old_sw_venta_directa,

      'cod_forma_farmacologica',
      new_cod_forma_farmacologica,
      old_cod_forma_farmacologica,

      'codigo_cum',
      new_codigo_cum,
      old_codigo_cum,

      'titular_reginvima_id',
      new_titular_reginvima_id,
      old_titular_reginvima_id,

      'tipo_producto_id',
      new_tipo_producto_id,
      old_tipo_producto_id,
      
      'sw_control_fecha_vencimiento',
      new_sw_control_fecha_vencimiento,
      old_sw_control_fecha_vencimiento,
      
      'cod_ihosp',
      new_cod_ihosp,
      old_cod_ihosp,
      
      'sw_requiereautorizacion_despachospedidos',
      new_sw_requiereautorizacion_despachospedidos,
      old_sw_requiereautorizacion_despachospedidos,
      
      'tipo_pais_id',
      new_tipo_pais_id,
      old_tipo_pais_id,
      
      'presentacioncomercial_id',
      new_presentacioncomercial_id,
      old_presentacioncomercial_id,
      
      'tratamiento_id',
      new_tratamiento_id,
      old_tratamiento_id,
	  
      'sw_ajusteautomatico',
      new_sw_ajusteautomatico,
      old_sw_ajusteautomatico,
      
     usuario_registro_
    );
  END IF;
    
RETURN NEW;
END
$$
LANGUAGE 'plpgsql'
VOLATILE
CALLED ON NULL INPUT
SECURITY INVOKER;

ALTER FUNCTION public.au_codificacion_productos()
  OWNER TO "admin";

  
  CREATE TRIGGER aut_auditoria_producto
  AFTER INSERT OR UPDATE OR DELETE
  ON public.inventarios_productos
  FOR EACH ROW
  EXECUTE PROCEDURE au_codificacion_productos();

  
  /*
  * Tabla de Medicamentos Trigger
  */

CREATE OR REPLACE FUNCTION public.au_codificacion_productos_medicamentos()
RETURNS trigger AS
$$
DECLARE
indicador RECORD;
columnas RECORD;

old_codigo_medicamento 	character varying(40);
old_sw_liquidos_electrolitos 	character (1);
old_cod_anatomofarmacologico character varying(15);	
old_cod_principio_activo character varying(10);	
old_cod_forma_farmacologica character varying(10);	
old_cod_concentracion character varying(10);	
old_sw_uso_controlado character varying(1);	
old_sw_antibiotico character(1);	
old_sw_pos character(1);	
old_sw_fotosensible character varying(1);	
old_sw_refrigerado character varying(1);	
old_unidad_medida_medicamento_id character varying(30);
old_factor_conversion numeric(5,2);
old_factor_equivalente_mg numeric(5,2);
old_concentracion_forma_farmacologica character varying(200);	
old_sw_alimento_parenteral character varying(1);	
old_sw_alimento_enteral 	character varying(1);
old_cod_ihosp 	character varying(18);
old_dias_previos_vencimiento smallint;	
old_codigo_cum character varying(40);	
old_cant_presentacion 	integer;
old_nivel_autorizador_id character varying(1);	
old_sw_farmacovigilancia character varying(1);	
old_descripcion_alerta text;	
old_sw_manejo_luz character(1);

new_codigo_medicamento 	character varying(40);
new_sw_liquidos_electrolitos 	character (1);
new_cod_anatomofarmacologico character varying(15);	
new_cod_principio_activo character varying(10);	
new_cod_forma_farmacologica character varying(10);	
new_cod_concentracion character varying(10);	
new_sw_uso_controlado character varying(1);	
new_sw_antibiotico character(1);	
new_sw_pos character(1);	
new_sw_fotosensible character varying(1);	
new_sw_refrigerado character varying(1);	
new_unidad_medida_medicamento_id character varying(30);
new_factor_conversion numeric(5,2);
new_factor_equivalente_mg numeric(5,2);
new_concentracion_forma_farmacologica character varying(200);	
new_sw_alimento_parenteral character varying(1);	
new_sw_alimento_enteral 	character varying(1);
new_cod_ihosp 	character varying(18);
new_dias_previos_vencimiento smallint;	
new_codigo_cum character varying(40);	
new_cant_presentacion 	integer;
new_nivel_autorizador_id character varying(1);	
new_sw_farmacovigilancia character varying(1);	
new_descripcion_alerta text;	
new_sw_manejo_luz character(1);

usuario_registro_ integer;
BEGIN

  SELECT * INTO indicador
  FROM   acciones AC,
         novedad_x_acciones NA
  WHERE  AC.descripcion = TG_OP
  AND    NA.accion_id = AC.accion_id
  AND    NA.table_name = 'medicamentos';
 
 /* Inicializar Variables */
 
  IF TG_OP = 'DELETE' THEN
   
  old_codigo_medicamento 	:= OLD.codigo_medicamento;
old_sw_liquidos_electrolitos := OLD.sw_liquidos_electrolitos;
old_cod_anatomofarmacologico := OLD.cod_anatomofarmacologico;
old_cod_principio_activo := OLD.cod_principio_activo;
old_cod_forma_farmacologica := OLD.cod_forma_farmacologica;
old_cod_concentracion := OLD.cod_concentracion;
old_sw_uso_controlado := OLD.sw_uso_controlado;
old_sw_antibiotico := OLD.sw_antibiotico;
old_sw_pos := OLD.sw_pos;
old_sw_fotosensible := OLD.sw_fotosensible;
old_sw_refrigerado := OLD.sw_refrigerado;
old_unidad_medida_medicamento_id := OLD.unidad_medida_medicamento_id;
old_factor_conversion := OLD.factor_conversion;
old_factor_equivalente_mg := OLD.factor_equivalente_mg;
old_concentracion_forma_farmacologica := OLD.concentracion_forma_farmacologica;
old_sw_alimento_parenteral := OLD.sw_alimento_parenteral;
old_sw_alimento_enteral 	:= OLD.sw_alimento_enteral;
old_cod_ihosp 	:= OLD.cod_ihosp;
old_dias_previos_vencimiento := OLD.dias_previos_vencimiento;
old_codigo_cum:= OLD.codigo_cum;
old_cant_presentacion := OLD.cant_presentacion;
old_nivel_autorizador_id := OLD.nivel_autorizador_id;
old_sw_farmacovigilancia := OLD.sw_farmacovigilancia;
old_descripcion_alerta := OLD.descripcion_alerta;
old_sw_manejo_luz := OLD.sw_manejo_luz;
  END IF; 
  IF TG_OP = 'UPDATE' THEN
	new_codigo_medicamento 	:= NEW.codigo_medicamento;
	new_sw_liquidos_electrolitos := NEW.sw_liquidos_electrolitos;
	new_cod_anatomofarmacologico := NEW.cod_anatomofarmacologico;
	new_cod_principio_activo := NEW.cod_principio_activo;
	new_cod_forma_farmacologica := NEW.cod_forma_farmacologica;
	new_cod_concentracion := NEW.cod_concentracion;
	new_sw_uso_controlado := NEW.sw_uso_controlado;
	new_sw_antibiotico := NEW.sw_antibiotico;
	new_sw_pos := NEW.sw_pos;
	new_sw_fotosensible := NEW.sw_fotosensible;
	new_sw_refrigerado := NEW.sw_refrigerado;
	new_unidad_medida_medicamento_id := NEW.unidad_medida_medicamento_id;
	new_factor_conversion := NEW.factor_conversion;
	new_factor_equivalente_mg := NEW.factor_equivalente_mg;
	new_concentracion_forma_farmacologica := NEW.concentracion_forma_farmacologica;
	new_sw_alimento_parenteral := NEW.sw_alimento_parenteral;
	new_sw_alimento_enteral 	:= NEW.sw_alimento_enteral;
	new_cod_ihosp 	:= NEW.cod_ihosp;
	new_dias_previos_vencimiento := NEW.dias_previos_vencimiento;
	new_codigo_cum:= NEW.codigo_cum;
	new_cant_presentacion := NEW.cant_presentacion;
	new_nivel_autorizador_id := NEW.nivel_autorizador_id;
	new_sw_farmacovigilancia := NEW.sw_farmacovigilancia;
	new_descripcion_alerta := NEW.descripcion_alerta;
	new_sw_manejo_luz := NEW.sw_manejo_luz;
    
	old_codigo_medicamento 	:= OLD.codigo_medicamento;
	old_sw_liquidos_electrolitos := OLD.sw_liquidos_electrolitos;
	old_cod_anatomofarmacologico := OLD.cod_anatomofarmacologico;
	old_cod_principio_activo := OLD.cod_principio_activo;
	old_cod_forma_farmacologica := OLD.cod_forma_farmacologica;
	old_cod_concentracion := OLD.cod_concentracion;
	old_sw_uso_controlado := OLD.sw_uso_controlado;
	old_sw_antibiotico := OLD.sw_antibiotico;
	old_sw_pos := OLD.sw_pos;
	old_sw_fotosensible := OLD.sw_fotosensible;
	old_sw_refrigerado := OLD.sw_refrigerado;
	old_unidad_medida_medicamento_id := OLD.unidad_medida_medicamento_id;
	old_factor_conversion := OLD.factor_conversion;
	old_factor_equivalente_mg := OLD.factor_equivalente_mg;
	old_concentracion_forma_farmacologica := OLD.concentracion_forma_farmacologica;
	old_sw_alimento_parenteral := OLD.sw_alimento_parenteral;
	old_sw_alimento_enteral 	:= OLD.sw_alimento_enteral;
	old_cod_ihosp 	:= OLD.cod_ihosp;
	old_dias_previos_vencimiento := OLD.dias_previos_vencimiento;
	old_codigo_cum:= OLD.codigo_cum;
	old_cant_presentacion := OLD.cant_presentacion;
	old_nivel_autorizador_id := OLD.nivel_autorizador_id;
	old_sw_farmacovigilancia := OLD.sw_farmacovigilancia;
	old_descripcion_alerta := OLD.descripcion_alerta;
	old_sw_manejo_luz := OLD.sw_manejo_luz;
	usuario_registro_ = NEW.usuario_id;
  END IF; 
  IF TG_OP = 'INSERT' THEN
	new_codigo_medicamento 	:= NEW.codigo_medicamento;
	new_sw_liquidos_electrolitos := NEW.sw_liquidos_electrolitos;
	new_cod_anatomofarmacologico := NEW.cod_anatomofarmacologico;
	new_cod_principio_activo := NEW.cod_principio_activo;
	new_cod_forma_farmacologica := NEW.cod_forma_farmacologica;
	new_cod_concentracion := NEW.cod_concentracion;
	new_sw_uso_controlado := NEW.sw_uso_controlado;
	new_sw_antibiotico := NEW.sw_antibiotico;
	new_sw_pos := NEW.sw_pos;
	new_sw_fotosensible := NEW.sw_fotosensible;
	new_sw_refrigerado := NEW.sw_refrigerado;
	new_unidad_medida_medicamento_id := NEW.unidad_medida_medicamento_id;
	new_factor_conversion := NEW.factor_conversion;
	new_factor_equivalente_mg := NEW.factor_equivalente_mg;
	new_concentracion_forma_farmacologica := NEW.concentracion_forma_farmacologica;
	new_sw_alimento_parenteral := NEW.sw_alimento_parenteral;
	new_sw_alimento_enteral 	:= NEW.sw_alimento_enteral;
	new_cod_ihosp 	:= NEW.cod_ihosp;
	new_dias_previos_vencimiento := NEW.dias_previos_vencimiento;
	new_codigo_cum:= NEW.codigo_cum;
	new_cant_presentacion := NEW.cant_presentacion;
	new_nivel_autorizador_id := NEW.nivel_autorizador_id;
	new_sw_farmacovigilancia := NEW.sw_farmacovigilancia;
	new_descripcion_alerta := NEW.descripcion_alerta;
	new_sw_manejo_luz := NEW.sw_manejo_luz;
    usuario_registro_ = NEW.usuario_id;
  END IF;
  IF indicador.accion_id IS NOT NULL THEN
    INSERT INTO auditorias_generales
    (
      accion_id,
      novedad_indicador_id,
      table_name,
      
      campo_1, 
      nuevo_valor_1,
      antiguo_valor_1 ,    
      
      campo_2, 
      nuevo_valor_2,
      antiguo_valor_2,
      
      campo_3, 
      nuevo_valor_3,
      antiguo_valor_3,
      
      campo_4, 
      nuevo_valor_4,
      antiguo_valor_4,
      
      campo_5, 
      nuevo_valor_5,
      antiguo_valor_5,
      
      campo_6, 
      nuevo_valor_6,
      antiguo_valor_6,
      
      campo_7, 
      nuevo_valor_7,
      antiguo_valor_7,
      
      campo_8, 
      nuevo_valor_8,
      antiguo_valor_8,
 
      campo_9, 
      nuevo_valor_9,
      antiguo_valor_9,

      campo_10, 
      nuevo_valor_10,
      antiguo_valor_10,

      campo_11, 
      nuevo_valor_11,
      antiguo_valor_11,

      campo_12, 
      nuevo_valor_12,
      antiguo_valor_12,

      campo_13, 
      nuevo_valor_13,
      antiguo_valor_13,

      campo_14, 
      nuevo_valor_14,
      antiguo_valor_14,

      campo_15, 
      nuevo_valor_15,
      antiguo_valor_15,

      campo_16, 
      nuevo_valor_16,
      antiguo_valor_16,

      campo_17, 
      nuevo_valor_17,
      antiguo_valor_17,

      campo_18, 
      nuevo_valor_18,
      antiguo_valor_18,

      campo_19, 
      nuevo_valor_19,
      antiguo_valor_19,

      campo_20, 
      nuevo_valor_20,
      antiguo_valor_20,

      campo_21, 
      nuevo_valor_21,
      antiguo_valor_21,

      campo_22, 
      nuevo_valor_22,
      antiguo_valor_22,

      campo_23, 
      nuevo_valor_23,
      antiguo_valor_23,

      campo_24, 
      nuevo_valor_24,
      antiguo_valor_24,

      campo_25, 
      nuevo_valor_25,
      antiguo_valor_25,
      
      usuario_registro

    )
    VALUES
    (
      indicador.accion_id,
      indicador.novedad_indicador_id,
      'medicamentos',
      
      'codigo_medicamento',
      new_codigo_medicamento,
      old_codigo_medicamento,
      
      'sw_liquidos_electrolitos',    
      new_sw_liquidos_electrolitos,
      old_sw_liquidos_electrolitos,
      
      'cod_anatomofarmacologico',
      new_cod_anatomofarmacologico,
      old_cod_anatomofarmacologico,
      
      'cod_principio_activo',
      new_cod_principio_activo,
      old_cod_principio_activo,
      
      'cod_forma_farmacologica',
      new_cod_forma_farmacologica,
      old_cod_forma_farmacologica,
      
      'cod_concentracion',
      new_cod_concentracion,
      old_cod_concentracion,
      
      'sw_uso_controlado',
      new_sw_uso_controlado,
      old_sw_uso_controlado,
      
      'sw_antibiotico',
      new_sw_antibiotico,
      old_sw_antibiotico,

      'sw_pos',
      new_sw_pos,
      old_sw_pos,

      'sw_fotosensible',
      new_sw_fotosensible,
      old_sw_fotosensible,

      'sw_refrigerado',
      new_sw_refrigerado,
      old_sw_refrigerado,

      'unidad_medida_medicamento_id',
      new_unidad_medida_medicamento_id,
      old_unidad_medida_medicamento_id,

      'factor_conversion',
      new_factor_conversion,
      old_factor_conversion,

      'factor_equivalente_mg',
      new_factor_equivalente_mg,
      old_factor_equivalente_mg,

      'concentracion_forma_farmacologica',
      new_concentracion_forma_farmacologica,
      old_concentracion_forma_farmacologica,

      'sw_alimento_parenteral',
      new_sw_alimento_parenteral,
      old_sw_alimento_parenteral,

      'sw_alimento_enteral',
      new_sw_alimento_enteral,
      old_sw_alimento_enteral,

      'cod_ihosp',
      new_cod_ihosp,
      old_cod_ihosp,

      'dias_previos_vencimiento',
      new_dias_previos_vencimiento,
      old_dias_previos_vencimiento,

      'codigo_cum',
      new_codigo_cum,
      old_codigo_cum,

      'cant_presentacion',
      new_cant_presentacion,
      old_cant_presentacion,

      'nivel_autorizador_id',
      new_nivel_autorizador_id,
      old_nivel_autorizador_id,

      'sw_farmacovigilancia',
      new_sw_farmacovigilancia,
      old_sw_farmacovigilancia,

      'descripcion_alerta',
      new_descripcion_alerta,
      old_descripcion_alerta,

      'sw_manejo_luz',
      new_sw_manejo_luz,
      old_sw_manejo_luz,
      
     usuario_registro_
    );
  END IF;
    
RETURN NEW;
END
$$
LANGUAGE 'plpgsql'
VOLATILE
CALLED ON NULL INPUT
SECURITY INVOKER;


ALTER FUNCTION public.au_codificacion_productos_medicamentos()
  OWNER TO "admin";

  
CREATE TRIGGER aut_auditoria_medicamento
AFTER INSERT OR UPDATE OR DELETE
ON public.medicamentos
FOR EACH ROW
EXECUTE PROCEDURE au_codificacion_productos_medicamentos();


CREATE OR REPLACE FUNCTION public.au_moleculas()
RETURNS trigger AS
$$
DECLARE
  
  indicador RECORD;
  columnas RECORD;
    
  old_molecula_id character varying(10);
  old_descripcion 	character varying(100);
  old_sw_medicamento character varying(1);
  old_estado character(1);  
  
  new_molecula_id character varying(10);
  new_descripcion 	character varying(100);
  new_sw_medicamento character varying(1);
  new_estado character(1);
  
  usuario_registro_ integer;
  fecha_registro timestamp;
  
BEGIN
  SELECT * INTO indicador
  FROM   acciones AC,
         novedad_x_acciones NA
  WHERE  AC.descripcion = TG_OP
  AND    NA.accion_id = AC.accion_id
  AND    NA.table_name = 'inv_moleculas';
 
 /* Inicializar Variables */
 
  IF TG_OP = 'DELETE' THEN
   
	old_molecula_id := OLD.molecula_id;
	old_descripcion 	:= OLD.descripcion;
	old_sw_medicamento := OLD.sw_medicamento;
	old_estado := OLD.estado;
  
  usuario_registro_ := OLD.usuario_id;
  fecha_registro := OLD.fecha_registro;
  END IF; 
  
  IF TG_OP = 'UPDATE' THEN
	old_molecula_id := OLD.molecula_id;
	old_descripcion 	:= OLD.descripcion;
	old_sw_medicamento := OLD.sw_medicamento;
	old_estado := OLD.estado;

	new_molecula_id := NEW.molecula_id;
	new_descripcion 	:= NEW.descripcion;
	new_sw_medicamento := NEW.sw_medicamento;
	new_estado := NEW.estado;
  usuario_registro_ := NEW.usuario_id;
  fecha_registro := NEW.fecha_registro;
  
  END IF; 
  
  IF TG_OP = 'INSERT' THEN
  

	new_molecula_id := NEW.molecula_id;
	new_descripcion 	:= NEW.descripcion;
	new_sw_medicamento := NEW.sw_medicamento;
	new_estado := NEW.estado;
  
  usuario_registro_ := NEW.usuario_id;
  fecha_registro := NEW.fecha_registro;
  END IF;
  
  IF indicador.accion_id IS NOT NULL THEN
    INSERT INTO auditorias_generales
    (
      accion_id,
      novedad_indicador_id,
      table_name,
      
      campo_1, 
      nuevo_valor_1,
      antiguo_valor_1 ,    
      
      campo_2, 
      nuevo_valor_2,
      antiguo_valor_2,
      
      campo_3, 
      nuevo_valor_3,
      antiguo_valor_3,
      
      campo_4, 
      nuevo_valor_4,
      antiguo_valor_4,
   
     usuario_registro

    )
    VALUES
    (
      indicador.accion_id,
      indicador.novedad_indicador_id,
      'inv_moleculas',
      
      'molecula_id',
      new_molecula_id,
      old_molecula_id,
      
      'descripcion',    
      new_descripcion,
      old_descripcion,
      
      'sw_medicamento',
      new_sw_medicamento,
      old_sw_medicamento,
      
      'estado',
      new_estado,
      old_estado,
         
     usuario_registro_
    );
  END IF;
    
RETURN NEW;
END
$$
LANGUAGE 'plpgsql'
VOLATILE
CALLED ON NULL INPUT
SECURITY INVOKER;

ALTER FUNCTION public.au_moleculas()
  OWNER TO "admin";
  
  CREATE TRIGGER aut_auditoria_molecula
  AFTER INSERT OR UPDATE OR DELETE
  ON public.inv_moleculas
  FOR EACH ROW
  EXECUTE PROCEDURE au_moleculas();

  
  
CREATE OR REPLACE FUNCTION public.au_laboratorios()
RETURNS trigger AS
$$
DECLARE
  
  indicador RECORD;
  columnas RECORD;
    
  old_laboratorio_id character varying(4);
  old_descripcion character varying(30);
  old_direccion character varying(30);
  old_telefono character varying(20)	;
  old_tipo_pais_id character varying(4);	
  old_estado character varying(1);
  
  new_laboratorio_id character varying(4);
  new_descripcion character varying(30);
  new_direccion character varying(30);
  new_telefono character varying(20);	
  new_tipo_pais_id character varying(4);	
  new_estado character varying(1);
  
  usuario_registro_ integer;
  fecha_registro timestamp;
  
BEGIN
  SELECT * INTO indicador
  FROM   acciones AC,
         novedad_x_acciones NA
  WHERE  AC.descripcion = TG_OP
  AND    NA.accion_id = AC.accion_id
  AND    NA.table_name = 'inv_laboratorios';
 
 /* Inicializar Variables */
 
  IF TG_OP = 'DELETE' THEN
   
	old_laboratorio_id := OLD.laboratorio_id;
	old_descripcion := OLD.descripcion;
	old_direccion := OLD.direccion;
	old_telefono := OLD.telefono;
	old_tipo_pais_id := OLD.tipo_pais_id;
	old_estado := OLD.estado;
  
  usuario_registro_ := OLD.usuario_id;
  fecha_registro := OLD.fecha_registro;
  END IF; 
  
  IF TG_OP = 'UPDATE' THEN
	old_laboratorio_id := OLD.laboratorio_id;
	old_descripcion := OLD.descripcion;
	old_direccion := OLD.direccion;
	old_telefono := OLD.telefono;
	old_tipo_pais_id := OLD.tipo_pais_id;
	old_estado := OLD.estado;

	new_laboratorio_id := NEW.laboratorio_id;
	new_descripcion := NEW.descripcion;
	new_direccion := NEW.direccion;
	new_telefono := NEW.telefono;
	new_tipo_pais_id := NEW.tipo_pais_id;
	new_estado := NEW.estado;
	usuario_registro_ := NEW.usuario_id;
	fecha_registro := NEW.fecha_registro;
  
  END IF; 
  
  IF TG_OP = 'INSERT' THEN
	new_laboratorio_id := NEW.laboratorio_id;
	new_descripcion := NEW.descripcion;
	new_direccion := NEW.direccion;
	new_telefono := NEW.telefono;
	new_tipo_pais_id := NEW.tipo_pais_id;
	new_estado := NEW.estado;
  
  usuario_registro_ := NEW.usuario_id;
  fecha_registro := NEW.fecha_registro;
  END IF;
  
  IF indicador.accion_id IS NOT NULL THEN
    INSERT INTO auditorias_generales
    (
      accion_id,
      novedad_indicador_id,
      table_name,
      
      campo_1, 
      nuevo_valor_1,
      antiguo_valor_1 ,    
      
      campo_2, 
      nuevo_valor_2,
      antiguo_valor_2,
      
      campo_3, 
      nuevo_valor_3,
      antiguo_valor_3,
      
      campo_4, 
      nuevo_valor_4,
      antiguo_valor_4,
      
      campo_5, 
      nuevo_valor_5,
      antiguo_valor_5,
	  
      campo_6, 
      nuevo_valor_6,
      antiguo_valor_6,
   
     usuario_registro

    )
    VALUES
    (
      indicador.accion_id,
      indicador.novedad_indicador_id,
      'inv_laboratorios',
      
      'laboratorio_id',
      new_laboratorio_id,
      old_laboratorio_id,
      
      'descripcion',    
      new_descripcion,
      old_descripcion,
     
      'direccion',
      new_direccion,
      old_direccion,
      
      'telefono',
      new_telefono,
      old_telefono,
      
      'tipo_pais_id',
      new_tipo_pais_id,
      old_tipo_pais_id,
      
      'estado',
      new_estado,
      old_estado,
         
     usuario_registro_
    );
  END IF;
    
RETURN NEW;
END
$$
LANGUAGE 'plpgsql'
VOLATILE
CALLED ON NULL INPUT
SECURITY INVOKER;

ALTER FUNCTION public.au_laboratorios()
  OWNER TO "admin";
  
  CREATE TRIGGER aut_auditoria_laboratorio
  AFTER INSERT OR UPDATE OR DELETE
  ON public.inv_laboratorios
  FOR EACH ROW
  EXECUTE PROCEDURE au_laboratorios();
