<?php  /**  * @package IPSOFT-SIIS  * @version $Id: app_ParametrizacionInicial_controller.php,v 1.5 2009/12/10 14:40:52 hugo Exp $Revision: 1.5 $  * @copyright (C) 2005 IPSOFT - SA (www.ipsoft-sa.com)  * @author Johanna Alarcon Duque  */    class app_ParametrizacionInicial_controller extends classModulo  {    /**    * Constructor de la clase    */    function app_ParametrizacionInicial_controller(){}      /**    * Funcion principal del modulo    * @return boolean    */    function Main()    {      $request = $_REQUEST;      $parametrizacionI = AutoCarga::factory('ParametrizacionInicialSQL', '', 'app', 'ParametrizacionInicial');      $action['volver'] = ModuloGetURL('system', 'Menu');      $permisos = $parametrizacionI->ObtenerPermisos();                $ttl_gral = "PARAMETRIZACION TIEMPO DE CITA";      $titulo[0] = 'EMPRESAS';      $url[0] = 'app';      $url[1] = 'ParametrizacionInicial';       $url[2] = 'controller';      $url[3] = 'Menu';       $url[4] = 'permiso_parametrizacionI';       $this->salida = gui_theme_menu_acceso($ttl_gral, $titulo, $permisos, $url, $action['volver']);           return true;    }         /**    * Funcion de control para el menu inicial    */    function Menu()    {      $request = $_REQUEST;	        $action['parametrizar_tiempo_cita_planes'] = ModuloGetURL("app", "ParametrizacionInicial", "controller", "BuscarPlanes");      $action['parametrizar_especialidades'] = ModuloGetURL("app","ParametrizacionInicial","controller","BuscarEspecialidades");      $action['parametrizar_usuariosplanes'] = ModuloGetURL("app","ParametrizacionInicial","controller","BuscarUsuariosplanes");      $action['parametrizar_servicios'] = ModuloGetURL("app","ParametrizacionInicial","controller","ParametrizacionServicios");      $action['volver'] = ModuloGetURL("app", "ParametrizacionInicial", "controller", "Main");            if($request['permiso_parametrizacionI']['empresa'])        SessionSetVar("empresa_id",$request['permiso_parametrizacionI']['empresa']);            $act = AutoCarga::factory("ParametrizacionInicialHTML", "views", "app", "ParametrizacionInicial");      $this->salida = $act->formaMenu($action);            return true;          }        /**    * Funcion que busca los planes    */    function BuscarPlanes()    {      $this->SetXajax(array("MostrarDCitas"),"app_modules/ParametrizacionInicial/RemoteXajax/EventosTiempoCita.php");      $request = $_REQUEST;            $action['volver'] = ModuloGetURL("app", "ParametrizacionInicial", "controller", "Menu");      $action['guardarTiempoC'] = ModuloGetURL("app","ParametrizacionInicial","controller","IngresarTiempoC");            $mdl = AutoCarga::factory("ParametrizacionInicialSQL","","app","ParametrizacionInicial");      $buscar_planes = $mdl->ConsultarPlanes();            $act = AutoCarga::factory("ParametrizacionInicialHTML", "views", "app", "ParametrizacionInicial");      $this->salida = $act->formaBuscarPlanes($buscar_planes,$action);            return true;     }        /**    * Funcion que busca los tipos de consulta - especialidades    */    function BuscarEspecialidades()    {      $this->SetXajax(array("MostrarCargo"),"app_modules/ParametrizacionInicial/RemoteXajax/EventosTiempoCita.php");      $request = $_REQUEST;		      $action['volver'] = ModuloGetURL("app", "ParametrizacionInicial", "controller", "Menu");      $action['guardarCargo'] = ModuloGetURL("app","ParametrizacionInicial","controller","IngresarEspecialidad");      $empresa_id = SessionGetVar("empresa_id");           $mdl = AutoCarga::factory("ParametrizacionInicialSQL","","app","ParametrizacionInicial");      $buscar_tipoConsulta = $mdl->ConsultarTipoConsulta();            $act = AutoCarga::factory("ParametrizacionInicialHTML", "views", "app", "ParametrizacionInicial");      $this->salida = $act->formaBuscarCargos($buscar_tipoConsulta,$action,$empresa_id);            return true;    }        /**    * Funcion que busca los usuarios - permisos    */    function BuscarUsuariosplanes()    {      $request = $_REQUEST;            $action['volver'] = ModuloGetURL("app", "ParametrizacionInicial", "controller", "Menu");      $action['asignarplanes'] = ModuloGetURL("app", "ParametrizacionInicial", "controller", "Asignarplanes");            $mdl = AutoCarga::factory("ParametrizacionInicialSQL","","app","ParametrizacionInicial");      $todos_usuarios = $mdl->ConsultarpermisosUsuarios();            $act = AutoCarga::factory("ParametrizacionInicialHTML", "views", "app", "ParametrizacionInicial");      $this->salida = $act->formaBuscarUsuariosplanes($todos_usuarios,$action);      return true;    }        /**    * Funcion donde se asigna al usuario el plan elegido    */    function Asignarplanes()    {      $request = $_REQUEST;      $empresa_id = SessionGetVar("empresa_id");            $action['volver'] = ModuloGetURL("app", "ParametrizacionInicial", "controller", "BuscarUsuariosplanes");      $action['guardarAsignacionPlanes'] = ModuloGetURL("app","ParametrizacionInicial","controller","IngresarAsignacionPlanes",array("usuario_id"=>$_REQUEST['usuario_id']));            $mdl = AutoCarga::factory("ParametrizacionInicialSQL","","app","ParametrizacionInicial");            $todos_planes = $mdl->ConsultarPlanes();      $consultar_usuarios = $mdl->ConsultarUsuariosAsigacion($empresa_id,$request['usuario_id']);      $act = AutoCarga::factory("ParametrizacionInicialHTML", "views", "app", "ParametrizacionInicial");      $this->salida = $act->formaAsignarplanes($todos_planes,$action,$consultar_usuarios);      return true;    }        /**    * Funcion que ingresa la asignacion de los planes a cada usuario    */    function IngresarAsignacionPlanes()    {      $request = $_REQUEST;	  $empresa_id = SessionGetVar("empresa_id");            $mdl = AutoCarga::factory("ParametrizacionInicialSQL","","app","ParametrizacionInicial");      $act = AutoCarga::factory("ParametrizacionInicialHTML","views","app","ParametrizacionInicial");            $action['volver'] = ModuloGetURL("app", "ParametrizacionInicial", "controller", "Asignarplanes",array("usuario_id"=>$_REQUEST['usuario_id']));      $actu_asigplanes = $mdl->ActualizacionAsignacionPlanes($request['usuario_id'],$request['TodosPlanes']);      if($request['TodosPlanes'] != '1')        $ingresar_asigplanes = $mdl->IngresarAsignacionPlanes($request['todosplanest'],$empresa_id,$request['usuario_id']);            $mensaje = "EL INGRESO O ACTUALIZACION DE LOS DATOS DEL TIEMPO, SE REALIZO CORRECTAMENTE";      if(!$ingresar_asigplanes && !$actu_asigplanes)      {        $mensaje = $ing->error."<br>ERROR EN EL MOMENTO DE INGRESAR LOS DATOS ".$ing->mensajeDeError;      }             $this->salida = $act->formaMensajeInTc($action,$mensaje);            return true;     }        /**    * Funcion que ingresa el tiempo de las citas    */    function IngresarTiempoC()    {      $request = $_REQUEST;            $mdl = AutoCarga::factory("ParametrizacionInicialSQL","","app","ParametrizacionInicial");      $act = AutoCarga::factory("ParametrizacionInicialHTML","views","app","ParametrizacionInicial");            $cant = count($request['DiaCita']);            $action['volver'] = ModuloGetURL("app", "ParametrizacionInicial", "controller", "BuscarPlanes");      $ingresar_tiempoc = $mdl->IngresarTiempoDeCitas($request);      $mensaje = "EL INGRESO O ACTUALIZACION DE LOS DATOS DEL TIEMPO, SE REALIZO CORRECTAMENTE";      if(!$ingresar_tiempoc)      {        $mensaje = $ing->error."<br>ERROR EN EL MOMENTO DE INGRESAR LOS DATOS ".$ing->mensajeDeError;      }             $this->salida = $act->formaMensajeInTc($action,$mensaje);            return true;     }        /**    * Funcion que ingresa la especialidad    */    function IngresarEspecialidad()    {      $request = $_REQUEST;            $mdl = AutoCarga::factory("ParametrizacionInicialSQL","","app","ParametrizacionInicial");      $act = AutoCarga::factory("ParametrizacionInicialHTML","views","app","ParametrizacionInicial");      $empresa_id = SessionGetVar("empresa_id");            $ingresar_especialidad = $mdl->IngresarPrioridad($request,$empresa_id);            $mensaje = "EL INGRESO O ACTUALIZACION DE LOS DATOS DE LAS ESPECIALIDADES, SE REALIZO CORRECTAMENTE";      if(!$ingresar_especialidad)      {        $mensaje = $ing->error."<br>ERROR EN EL MOMENTO DE INGRESAR LOS DATOS ".$ing->mensajeDeError;      }                $action['volver'] = ModuloGetURL("app", "ParametrizacionInicial", "controller", "BuscarEspecialidades");      $this->salida = $act->formaMensajeInTc($action,$mensaje);            return true;    }    /**    * Funcion de control para la parametrizacion de servicios    *    * @return boolean    */    function ParametrizacionServicios()    {      IncludeFileModulo("EventosTiempoCita","RemoteXajax","app","ParametrizacionInicial");      $this->SetXajax(array("ActivarFechaIncapacidad"),null,"ISO-8859-1");      $srv = AutoCarga::factory("Servicios","classes","app","ParametrizacionInicial");      $mdl = AutoCarga::factory("ParametrizacionInicialHTML","views","app","ParametrizacionInicial");      $servicios = $srv->ObtenerServicios();      $action['volver'] = ModuloGetURL("app", "ParametrizacionInicial", "controller", "Menu");            $this->salida = $mdl->FormaParametrizarServicios($action,$servicios);      return true;    }  }?>