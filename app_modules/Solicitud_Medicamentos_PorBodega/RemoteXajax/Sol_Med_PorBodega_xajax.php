<?php	function Solicitudes($empresa,$centro_utilidad,$bodega)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if(!($solicitudes=$objClass->GetSolicitudes($empresa,$centro_utilidad,$bodega,'0')))			$objResponse->assign("mensaje_error","innerHTML",$objClass->error."<br>".$objClass->mensajeDeError);		//$objResponse->assign("mensaje_error","innerHTML",$objClass->GetSolicitudes($empresa,$centro_utilidad,$bodega));		if(empty($solicitudes))		{			$objResponse->assign("capa_sol","innerHTML","<center><label class=\"label_error\">NO HAY SOLICITUDES</label></center>");		}		else		{			$salida = explode("ç",Generar_HTML($solicitudes,"0"));			$objResponse->assign("capa_sol","innerHTML",$salida[0]);		}		if(!$salida[1])			$c="0";		else			$c="<label class=\"label_error\">".$salida[1]."</label>";				$objResponse->assign("cont_sol","innerHTML","($c)");		return $objResponse;	}		function Despachos($empresa,$centro_utilidad,$bodega)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if(($despachos=$objClass->GetSolicitudes($empresa,$centro_utilidad,$bodega,'1'))==false)			$objResponse->assign("mensaje_error","innerHTML",$objClass->error."<br>".$objClass->mensajeDeError);		//$objResponse->assign("mensaje_error","innerHTML",$objClass->GetSolicitudes($empresa,$centro_utilidad,$bodega));		if(empty($despachos))		{			$objResponse->assign("capa_des","innerHTML","<center><label class=\"label_error\">NO HAY DESPACHOS SIN CONFIRMAR</label></center>");		}		else		{			$salida = explode("ç",Generar_HTML($despachos,"1"));			$objResponse->assign("capa_des","innerHTML",$salida[0]);		}		if(!$salida[1]) 			$c="0";		else			$c="<label class=\"label_error\">".$salida[1]."</label>";				$objResponse->assign("cont_des","innerHTML","($c)");				return $objResponse;	}		function Devoluciones($empresa,$centro_utilidad,$bodega)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if(($devoluciones=$objClass->GetDevolucionesMedicamentos($empresa,$centro_utilidad,$bodega))==false)			$objResponse->assign("mensaje_error","innerHTML",$objClass->error."<br>".$objClass->mensajeDeError);		//$objResponse->assign("mensaje_error","innerHTML",$objClass->GetDevolucionesMedicamentos($empresa,$centro_utilidad,$bodega));		if(empty($devoluciones))		{			$objResponse->assign("capa_dev","innerHTML","<center><label class=\"label_error\">NO HAY DEVOLUCIONES POR CONFIRMAR</label></center>");		}		else		{			$salida = explode("ç",Generar_HTML($devoluciones,"3"));			$objResponse->assign("capa_dev","innerHTML",$salida[0]);		}				if(!$salida[1]) 			$c="0";		else			$c="<label class=\"label_error\">".$salida[1]."</label>";					$objResponse->assign("cont_dev","innerHTML","($c)");				return $objResponse;	}		function ExistenciasMinimas($pagina,$empresa,$centro_utilidad,$bodega)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if(($existencias_min=$objClass->GetExistenciasMinimas($pagina,$empresa,$centro_utilidad,$bodega))==false)			$objResponse->assign("mensaje_error","innerHTML",$objClass->error."<br>".$objClass->mensajeDeError);				$count=$objClass->conteo;				if(empty($existencias_min))		{			$objResponse->assign("capa_exi","innerHTML","<center><label class=\"label_error\">NO HAY EXISTENCIAS MINIMAS EN LA BODEGA</label></center>");		}		else		{			$limite=20;			$salida = ExistenciasMinimas_HTML($pagina,$existencias_min,$count,$limite,$empresa,$centro_utilidad,$bodega);			$objResponse->assign("capa_exi","innerHTML",$objResponse->setTildes($salida));		}				if(!$salida[1]) 			$c="0";		else			$c="<label class=\"label_error\">".$count."</label>";					$objResponse->assign("cont_exi","innerHTML","($c)");				return $objResponse;	}		function ConfirmacionTransferencias($empresa,$centro_utilidad,$bodega)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if(($confir_trans=$objClass->GetConfirmacionTransferencias($empresa,$centro_utilidad,$bodega))==false)			$objResponse->assign("mensaje_error","innerHTML",$objClass->error."<br>".$objClass->mensajeDeError);				if(empty($confir_trans))		{			$objResponse->assign("capa_contrans","innerHTML","<center><label class=\"label_error\">NO HAY TRANSFERENCIAS SIN CONFIRMAR</label></center>");		}		else		{			$salida = explode("ç",ConfirmacionTransferencias_HTML($confir_trans,$empresa,$centro_utilidad,$bodega));			$objResponse->assign("capa_contrans","innerHTML",$objResponse->setTildes($salida[0]));		}		if(!$salida[1])			$c="0";		else			$c="<label class=\"label_error\">".$salida[1]."</label>";					$objResponse->assign("cont_contrans","innerHTML","($c)");				return $objResponse;	}		function ConfirmacionTransferencias_HTML($confir_trans)	{		$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				$salida .= "	<table border=\"0\" width=\"100%\" align=\"center\" class=\"modulo_table_list\">";		$salida .= "		<tr class=\"modulo_table_list_title\" align=\"center\">";		$salida .= "			<td width=\"35%\">BODEGA ORIGEN</td>";		$salida .= "				<td>CODIGO</td>";		$salida .= "				<td width=\"28%\">FECHA</td>";		$salida .= "			  <td width=\"15%\">DETALLE</td>";		$y=0;				foreach($confir_trans as $key=>$valor)		{			if($y % 2)			{				$estilo='modulo_list_claro';			}			else			{				$estilo='modulo_list_oscuro';			}			$salida .= "	<tr class=\"$estilo\">\n";			$NombreBodega=$objClass->NombreBodegasInventario($valor['bodega'],$valor['centro_utilidad']);			$salida .= "	 	<td>".$valor['bodega']." - ".$NombreBodega['descripcion']."</td>";			$salida .= "	 	<td>".$valor['inv_documento_transferencia_id']."</td>";			$salida .= "	 	<td>".$valor['fecha_transferencia']."</td>";			$actionh = "javascript:Iniciar();MostrarSpan('d2Container');DetConfirmarTrans('".$valor['inv_documento_transferencia_id']."','".$valor['bodega']." - ".$NombreBodega['descripcion']."','".$valor['fecha_transferencia']."','".$valor['centro_utilidad']."');";			$salida .= "	 	<td width=\"15%\" align=\"center\"><a href=\"$actionh\"><img border=\"0\" src=\"".GetThemePath()."/images/pconsultar.png\" title=\"CONFIRMACION DE TRANSFERENCIA\"></a></td>";			$salida .= "	</tr>\n";			$y++;		}		$salida .= "	</table>";				return $salida."ç".$y;	}		function DetConfirmarTrans($codigo,$bodega_o,$fecha,$centro_o)	{		$objResponse=new xajaxResponse();				$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if(($productos=$objClass->ConsultaProductosDocumentoTransaccion($codigo))==false)			$objResponse->assign("mensaje_error","innerHTML",$objClass->error."<br>".$objClass->mensajeDeError);		else			$salida=DetConfirmarTrans_HTML($productos,$codigo,$bodega_o,$fecha,$centro_o);				$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes($salida));				return $objResponse;	}		function DetConfirmarTrans_HTML($productos,$codigo,$bodega_o,$fecha,$centro_o)	{		$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				$salidaX .= "<table class=\"modulo_table_list\" border=\"0\"  width=\"100%\" align=\"center\">";		$salidaX .= "	<tr>";		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">BODEGA ORIGEN</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" colspan=\"3\">".utf8_decode($bodega_o)."</td>";		$salidaX .= "	</tr>";		$salidaX .= "	<tr>";		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">FECHA SOLICITUD</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" width=\"45%\">".$fecha."</td>";                 		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">CODIGO</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" width=\"15%\">$codigo</td>";		$salidaX .= "	</tr>";		$salidaX .= "</table>";				$salidaX .= "	<br><table border=\"0\" width=\"100%\" align=\"center\" class=\"modulo_table_list\">";		$salidaX .= "		<tr class=\"modulo_table_list_title\" align=\"center\">";    $salidaX .= "			<td>COD PRODUCTO</td>";		$salidaX .= "			<td>DESCRIPCION</td>";		$salidaX .= "			<td>CANTIDAD TOTAL</td>";		$salidaX .= "			<td>&nbsp;</td>";		$salidaX .= "			<td width=\"20%\">FECHA VENCIMIENTO</td>";		$salidaX .= "			<td width=\"15%\">LOTE</td>";		$salidaX .= "			<td width=\"15%\">CANTIDAD LOTE</td>";		$salidaX .= "			<td>&nbsp;</td>";		$salidaX .= "		</tr>";				$y=0;		$z=1;		foreach($productos as $key=>$valor)		{			if($y % 2)			{				$estilo='modulo_list_claro';			}			else			{				$estilo='modulo_list_oscuro';			}						if($z % 2)			{				$estilo1='modulo_list_claro';			}			else			{				$estilo1='modulo_list_oscuro';			}			$salidaX .= "	 <tr class=\"$estilo\">\n";			$Pr=$valor['codigo_producto'];						$salidaX .= "	 <td>".$valor['codigo_producto']."</td>";			$salidaX .= "	 <td>".$valor['descripcion']."</td>";			$salidaX .= "	 <td>".$valor['cantidad']."</td>";			$sumaTotal=$objClass->SumaFechasLotesProductosDevol($codigo,$valor['codigo_producto']);			$DatosLotes=$objClass->FechasLotesProductosDevol($codigo,$valor['codigo_producto']);						if($valor['sw_control_fecha_vencimiento']=='1')			{				$style="style=\"display:block\"";			}			else			{				$style="style=\"display:none\"";			}			$salidaX .= "     <td align=\"center\"><center><table $style id=\"InsLote$y\" border=\"0\" cellpadding=\"0\" cellspancing=\"0\"><tr><td><a href=\"javascript:MostrarLotesPtosDevols('$EstacionId','$NombreEstacion','$Documento','$Ingreso','$observaciones','".$valor['codigo_producto']."','".$valor['descripcion']."','".$valor['cantidad']."','".$codigo."','".$tipo_id_paciente."','".$paciente_id."','".$nombrepac."','".$cama."','".$pieza."','".$parametro."','".$departamento."','$Fecha','$usuarioestacion','$descripcionDpto','1');\"><img border=\"0\" src=\"".GetThemePath()."/images/pparamed.png\"></a></td></tr></table></center></td>";			if($DatosLotes)			{				$salidaX .= "     <td align=\"center\" colspan=\"3\">";				$salidaX .= "	     <table  id=\"ElimLote$y\" cellspacing=\"2\"  cellpadding=\"3\"border=\"0\" width=\"99%\" align=\"center\">";				$z=0;				foreach($DatosLotes as $keyL=>$valorL)				{					if($z % 2)					{						$estilo1='modulo_list_oscuro';					}					else					{						$estilo1='modulo_list_claro';					}										$salidaX .= "		<tr class=\"$estilo1\">\n";					$salidaX .= "			<td width=\"32%\">".$valorL['fecha_vencimiento']."</td>";					$salidaX .= "			<td width=\"35%\">".$valorL['lote']."</td>";					$salidaX .= "			<td>".$valorL['cantidad']."</td>";					$salidaX .= "			<td width=\"5%\"><a href=\"javascript:FuncionEliminar('".$valorL['fecha_vencimiento']."','".$valorL['lote']."','".$valorL['cantidad']."','".$codigo."','".$valor['codigo_producto']."','InsLote$y','ElimLote$y');\"><img border=\"0\" src=\"".GetThemePath()."/images/elimina.png\"></a></td>";					$salidaX .= "		</tr>";					$z++;				}				$salidaX .= "		</table>";				$salidaX .= "</td>";			}			else			{				$salidaX .= "     <td colspan=\"3\" align=\"center\">&nbsp;</td>";			}			$salidaX .= "	 <td width=\"5%\" align=\"center\"><input type=\"checkbox\" id=\"checkboxDevol$y\" name=\"checkboxDevol[]\" value=\"".$valor['codigo_producto']."__".$valor['cantidad']."__".$valor['consecutivo']."\"></td>";			$salidaX .= "	 </tr>\n";			$y++;		}		$salidaX .= "	 <tr>\n";		$salidaX .= "	</table>";				$salidaX .= "	<br><table align=\"center\" width=\"100%\">";		$salidaX .= "	 <tr>\n";		$salidaX .= "		<td align=\"right\" width=\"100%\">\n";		$salidaX .= "			<input type=\"button\" class=\"input-submit\" name=\"confirmar\" value=\"CONFIRMAR\" onclick=\"ConfirmarTransferenciasBodegas();\">\n";		$salidaX .= "	 	</td>\n";		$salidaX .= "	 </tr>\n";    $salidaX .= "	</table>";						return $salidaX;		}		function DetalleSolicitudInd($solicitud,$sw,$Ingreso,$EstacionId,$NombreEstacion,$Fecha,$usuarioestacion,$nombrepac,$tipo_id_paciente,$paciente_id,$cama,$departamento,$descripcionDpto,$estado)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				$Tiposolicitud = $objClass->GetTipoSolicitudBodega($solicitud);				if($Tiposolicitud==false)			$objResponse->assign("error","innerHTML",$objClass->error."<br>".$objClass->mensajeDeError);				if($Tiposolicitud['tipo_solicitud']=='M')		{			$Vector = $objClass->GetMedicamentosSolicitud($solicitud);			$palabra='MEDICAMENTOS';		}		elseif($Tiposolicitud['tipo_solicitud']=='Z')		{			$Vector = $objClass->GetMezclasSolicitud($solicitud);			$palabra='MEZCLAS';		}		elseif($Tiposolicitud['tipo_solicitud']=='I')		{			$Vector = $objClass->GetInsumosSolicitud($solicitud);			$palabra='INSUMOS';		}		    elseif($Tiposolicitud['tipo_solicitud']=='D')		{			$Vector = $objClass->GetInsumosYMedicamentosSolicitud($solicitud);			$palabra='INSUMOS Y/O MEDICAMENTOS';		}				$objResponse->assign("titulo","innerHTML","<center>DESPACHO DE SOLICITUD DE ".$palabra."</center>");				$salida = DetalleSolicitudInd_HTML($Vector,$sw,$Tiposolicitud,$solicitud,$Ingreso,$EstacionId,$NombreEstacion,$Fecha,$usuarioestacion,$nombrepac,    $tipo_id_paciente,$paciente_id,$cama,$departamento,$descripcionDpto,$estado);		$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes($salida));				return $objResponse;	}		function Despachar($datos,$sw,$tipoSolicitud,$SolicitudId,$Ingreso,$EstacionId,$NombreEstacion,$Fecha,$usuarioestacion,$nombrepac,$tipo_id_paciente,$paciente_id,$cama,$departamento,$descripcionDpto,$estado)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if(($concepto=$objClass->ValidarDocumentoBodega())==false)		{			$objResponse->assign("error","innerHTML","<center>NO EXISTE EL TIPO DE DOCUMENTO PARA REALIZAR EL MOVIMIENTO AUTOMATICO EN LA BODEGA</center>");		}		else		{			$objResponse->assign("titulo","innerHTML","<center>CONFIRMACION DESPACHO DE SOLICITUD DE ".$palabra."</center>");						$vector=$objClass->ConfirmacionDespachoDetalleSolicitud($SolicitudId,$tipoSolicitud);						$motivos_can=$objClass->MotivosCancelacionDespacho();			$objResponse->assign("error","innerHTML","");			$salida=Despachar_HTML($datos,$vector,$motivos_can,$concepto,$sw,$tipoSolicitud,$SolicitudId,$Ingreso,$EstacionId,$NombreEstacion,$Fecha,$usuarioestacion,$nombrepac,			$tipo_id_paciente,$paciente_id,$cama,$departamento,$descripcionDpto,$estado);						$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes(utf8_decode($salida)));		}				return $objResponse;	}		function ConfirmarDespacho($tipoSolicitud,$SolicitudId,$EstacionId,$NombreEstacion,$Ingreso,$Fecha,$Concepto,$usuarioestacion,$datos)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				list($usuario_id,$usuario)=explode(" - ",$usuarioestacion);		$medicaSol =SessionGetVar("MedicamentosSolicitadosPr");    		if(($confirm=$objClass->ConfirmarDespachoSol($tipoSolicitud,$SolicitudId,$EstacionId,$Ingreso,$Fecha,$Concepto,$usuario_id,$datos,$medicaSol))==false)			$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");		else		{			$objResponse->assign("error","innerHTML","");			$salida=ConfirmarDespacho_HTML($EstacionId,$NombreEstacion,$SolicitudId,1);			$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes(utf8_decode($salida)));		}		return $objResponse;	}		function DetalleSolicitudDev($documento,$Ingreso,$EstacionId,$NombreEstacion,$Fecha,$usuarioestacion,$nombrepac,    $tipo_id_paciente,$paciente_id,$cama,$pieza,$departamento,$descripcionDpto,$estado,$observacion,$parametro)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if(($datosDev=$objClass->ProductosDevolucion($documento))==false)			$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");		else		{			$objResponse->assign("titulo","innerHTML","<center>DEVOLUCION DE MEDICAMENTOS</center>");			$salida=DetalleSolicitudDev_HTML($datosDev,$documento,$Ingreso,$EstacionId,$NombreEstacion,$Fecha,$usuarioestacion,$nombrepac,$tipo_id_paciente,$paciente_id,$cama,$pieza,$departamento,$descripcionDpto,$estado,$observacion,$parametro);			$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes($salida));		}		return $objResponse;	}		function RealizarDevolucion($SelectDatos,$EstacionId,$NombreEstacion,$Documento,$Fecha,$Ingreso,$observaciones)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if(($confirm=$objClass->RealizarDevolucionMedicamentos($SelectDatos,$EstacionId,$NombreEstacion,$Documento,$Fecha,$Ingreso,$observaciones))==false)		{			if($objClass->frmError['MensajeError'])				$objResponse->assign("error","innerHTML","<center>".$objClass->frmError['MensajeError']."</center>");			else				$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");		}		else		{			$salida = RealizarDevolucion_HTML();			$objResponse->assign("error","innerHTML","");			$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes($salida));		}		return $objResponse;	}		function CancelarProDevolucion($SelectDatos,$EstacionId,$NombreEstacion,$Fecha,$Documento,$Ingreso,$observaciones,$tipo_id_paciente,$paciente_id,$nombrepac,$cama,$pieza,$departamento,$dpto,$estado,$parametro,$usuarioestacion)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				$Motivos=$objClass->MotivosCancelacionDevolucion();				$salida=CancelarSolicitudesDevoluciones_HTML($Motivos,$SelectDatos,$EstacionId,$NombreEstacion,$Fecha,$Documento,$Ingreso,$observaciones,$tipo_id_paciente,$paciente_id,$nombrepac,$cama,$pieza,$departamento,$dpto,$estado,$parametro,$usuarioestacion);				$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes($salida));				return $objResponse;	}	function CancelarProDev($SelectDatos,$Documento,$motivo,$observacion)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if(!$motivo)			$objResponse->assign("error","innerHTML","<center>DEBE SELECCIONAR UN MOTIVO</center>");		elseif(!$observacion)			$objResponse->assign("error","innerHTML","<center>DEBE INGRESAR UNA OBSERVACION</center>");		else		{			if(($objClass->GuardarCancelacionDevoluciones($SelectDatos,$Documento,$motivo,$observacion))==false)				$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");			else			{				$objResponse->assign("error","innerHTML","");				$salida=CancelacionDevolucion_HTML();				$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes($salida));			}		}				return $objResponse;	}	function DespacharDpto($departamento,$descripcion)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if(($Datos=$objClass->DatosSolicitudesDepartamento($departamento))==false)			$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");		else		{			$objResponse->assign("error","innerHTML","");						if(($concepto=$objClass->ValidarDocumentoBodega())==false)				$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");			else			{				$objResponse->assign("titulo","innerHTML","<center>DESPACHO DE SOLICITUDES POR DEPARTAMENTO</center>");				$salida=DespacharDpto_HTML($Datos,$departamento,$descripcion,$concepto);				$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes($salida));			}		}				return $objResponse;	}		function DevolucionDpto($departamento,$descripcion)	{		$objResponse=new xajaxResponse();				$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if(($Datos=$objClass->ProductosTotalesDevolucion($departamento))==false)			$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");		else		{			$objResponse->assign("error","innerHTML","");						if(($concepto=$objClass->ValidarDocumentoBodega())==false)				$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");			else			{				$objResponse->assign("titulo","innerHTML","<center>DEVOLUCION DE SOLICITUDES POR DEPARTAMENTO</center>");				$salida=DevolucionDpto_HTML($Datos,$departamento,$descripcion,$concepto);				$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes($salida));			}		}		return $objResponse;	}			function DespacharDptoSC($DatosCheck,$departamento,$descripcionDpto,$concepto)	{		$objResponse=new xajaxResponse();				$objClass=new app_Solicitud_Medicamentos_PorBodega_user;		$objResponse->assign("error","innerHTML","");		$salida=DespacharDptoSC_HTML($DatosCheck,$departamento,$descripcionDpto,$concepto);		$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes($salida));				return $objResponse;	}		function ConfirmarDespachoDpto($DatosCheck,$DatosPen,$DatosCancel,$motivo,$observacion,$departamento,$descripcionDpto,$concepto)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				for($i=0; $i<sizeof($DatosCheck); $i++)		{			$y= explode(".-.",$DatosCheck[$i]);			$datos[$y[0]][] = $y;		}				if(($confirm=$objClass->GuardaDespachoMedDepartamentoConfirmacion($datos,$DatosPen,$DatosCancel,$motivo,$observacion,$departamento,$descripcionDpto,$concepto))==false)			$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");		else		{			$objResponse->assign("error","innerHTML","");			$salida=ConfirmarDespacho_HTML();			$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes($salida));		}		return $objResponse;	}	function ConfirmarDevolucionDpto($DatosCheck,$departamento,$concepto)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				for($i=0; $i<sizeof($DatosCheck); $i++)		{			$y= explode("||//",$DatosCheck[$i]);			$datos[$y[0]] = $y[1]."||//".$y[2];		}				if(($confirm=$objClass->RealizarDevolucionMedicamentosDpto($datos,$departamento,$concepto))==false)		{			if($objClass->frmError['MensajeError'])				$objResponse->assign("error","innerHTML","<center>".$objClass->frmError['MensajeError']."</center>");			else				$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");		}		else		{			$salida=RealizarDevolucion_HTML();			$objResponse->assign("error","innerHTML","");			$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes($salida));		}		return $objResponse;	}				function MostrarLotesPtosDevols($EstacionId,$NombreEstacion,$Documento,$Ingreso,$observaciones,$codigo_producto,$descripcion,$cantidad,$consecutivo,$tipo_id_paciente,$paciente_id,$nombrepac,$cama,$pieza,$parametro,$departamento,$Fecha,$usuarioestacion,$descripcionDpto,$sw)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				if($sw==1)		{			$sumaTotal=$objClass->SumaFechasLotesProductosDevol($consecutivo,$codigo_producto);		}		else		{			$sumaTotal=$objClass->SumaFechasLotesProductosDevolDpto($departamento,$codigo_producto);		}				$objResponse->assign("error","innerHTML","");		$salida=MostrarLotesPtosDevols_HTML($sumaTotal,$cantidad,$EstacionId,$NombreEstacion,$Documento,$Ingreso,$observaciones,$codigo_producto,$descripcion,$cantidad,$consecutivo,$tipo_id_paciente,$paciente_id,$nombrepac,$cama,$pieza,$parametro,$departamento,$Fecha,$usuarioestacion,$descripcionDpto,$sw);		$objResponse->assign("d2Contents","innerHTML",$objResponse->setTildes($salida));			return $objResponse;	}		function InsertarFechaVenLotedev($fecha_ven,$CantidadLote,$cantidad,$lote,$consecutivo,$codigo_pro,$departamento,$sw)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;		if(!$fecha_ven)		{			$objResponse->assign("error","innerHTML","<center>DEBE INGRESAR LA FECHA DE VENCIMIENTO</center>");		}		elseif(!$lote)		{			$objResponse->assign("error","innerHTML","<center>DEBE INGRESAR EL LOTE</center>");		}		elseif(!$CantidadLote)		{			$objResponse->assign("error","innerHTML","<center>DEBE INGRESAR LA CANTIDAD</center>");		}		elseif($sw==1)		{			if(($objClass->InsertarFechaVencimientoLoteDevol($fecha_ven,$CantidadLote,$cantidad,$lote,$consecutivo,$codigo_pro))==false)			{				if($objClass->frmError['MensajeError'])					$objResponse->assign("error","innerHTML","<center>".$objClass->frmError['MensajeError']."</center>");				else				$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");			}		}		else		{			if(($objClass->InsertarFechaVencimientoLoteDevolDpto($fecha_ven,$CantidadLote,$cantidad,$lote,$consecutivo,$codigo_pro,$departamento))==false)			{				if($objClass->frmError['MensajeError'])					$objResponse->assign("error","innerHTML","<center>".$objClass->frmError['MensajeError']."</center>");				else					$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");			}		}		return $objResponse;	}			function EliminarFechaVDevol($consecutivo,$codigo_pro,$CantidadLote,$fecha_ven,$lote,$InsLote,$ElimLote)	{		$objResponse=new xajaxResponse();			$objClass=new app_Solicitud_Medicamentos_PorBodega_user;		if(($objClass->LlamaEliminarFechaVDevol($consecutivo,$codigo_pro,$CantidadLote,$fecha_ven,$lote))==false)		{			if($objClass->frmError['MensajeError'])				$objResponse->assign("error","innerHTML","<center>".$objClass->frmError['MensajeError']."</center>");			else				$objResponse->assign("error","innerHTML","<center>".$objClass->error."<br>".$objClass->mensajeDeError."</center>");		}		else		{			$objResponse->assign($InsLote,"style.display","");			$objResponse->assign($ElimLote,"style.display","none");		}				return $objResponse;	}		function MostrarLotesPtosDevols_HTML($sumaTotal,$cantidad,$EstacionId,$NombreEstacion,$Documento,$Ingreso,$observaciones,$codigo_producto,$descripcion,$cantidad,$consecutivo,$tipo_id_paciente,$paciente_id,$nombrepac,$cama,$pieza,$parametro,$departamento,$Fecha,$usuarioestacion,$descripcionDpto,$sw)	{		$cantidadFalta=$cantidad-$sumaTotal['suma'];		$salidaX .= "	<form name=\"formaUno\" action=\"\" method=\"\">";		$salidaX .= "	<table border=\"0\" width=\"100%\" align=\"center\" class=\"modulo_table_list\">";		$salidaX .= "  <tr class=\"modulo_table_list_title\" align=\"center\"><td align=\"center\" colspan=\"6\">$codigo_producto&nbsp&nbsp&nbsp;$descripcion</td></tr>";		$salidaX .= "  <tr class=\"modulo_table_list_title\" align=\"center\"><td align=\"center\" colspan=\"6\">CANTIDAD QUE FALTA PARA ALCANZAR EL TOTAL&nbsp&nbsp&nbsp;$cantidadFalta</td></tr>";		$salidaX .= "	 <tr class=\"modulo_list_claro\">";		$salidaX .= "	 		<td class=\"label\">FECHA VENCIMIENTO</td>";		$salidaX .= "	 		<td align=\"center\"><input type=\"text\" readonly id=\"fecha\" name=\"fechaVencimiento\" value=\"\" class=\"input-text\" >";		$salidaX .= "	 		<a href=\"javascript:LlamarCalendariofechaVencimiento();\"><img onmouseover=\"window.status='Calendario';return true;\" onmouseout=\"window.status=''; return true;\" src=\"".GetThemePath()."/images/calendario/calendario.png\" alt=\"Ver Calendario\" border=\"0\"></a> [dd/mm/aaaa]</td>";		$salidaX .= "	 		<td class=\"label\">No. LOTE</td>";		$salidaX .= "	 		<td align=\"center\"><input class=\"input-text\" type=\"text\" id=\"lote\" name=\"lote\" value=\"\"></td>";		$salidaX .= "			<td class=\"label\">CANTIDAD</td>";		$salidaX .= "			<td align=\"center\"><input class=\"input-text\" type=\"text\" id=\"cantid\" name=\"cantidadLote\" value=\"\" onkeyup=\"ValidarCantidad('cantid',xGetElementById('cantid').value,'');\" onkeypress=\"ValidarCantidad('cantid',xGetElementById('cantid').value,'');\"></td>";		if($sw==1)		{			$salidaX .= "		<tr><td class=\"modulo_list_oscuro\" colspan=\"6\" align=\"center\"><input type=\"button\" class=\"input-submit\" name=\"cancelar\" value=\"CANCELAR\" onclick=\"Iniciar();MostrarSpan('d2Container');FuncionDetalleDev('$Documento','$Ingreso','$EstacionId','$NombreEstacion','$Fecha','$usuarioestacion','$nombrepac','$tipo_id_paciente','$paciente_id','$cama','$pieza','$departamento','$descripcionDpto','$estado','$observaciones','$parametro');\">";			$salidaX .= "		<input type=\"button\" class=\"input-submit\" name=\"insertar\" value=\"INSERTAR\" onclick=\"xajax_InsertarFechaVenLotedev(xGetElementById('fecha').value,xGetElementById('cantid').value,'$cantidad',xGetElementById('lote').value,'$consecutivo','$codigo_producto','$departamento','$sw'); Iniciar();MostrarSpan('d2Container');FuncionDetalleDev('$Documento','$Ingreso','$EstacionId','$NombreEstacion','$Fecha','$usuarioestacion','$nombrepac','$tipo_id_paciente','$paciente_id','$cama','$pieza','$departamento','$descripcionDpto','$estado','$observaciones','$parametro');\"></td></tr>";		}		else		{			$salidaX .= "		<tr><td class=\"modulo_list_oscuro\" colspan=\"6\" align=\"center\"><input type=\"button\" class=\"input-submit\" name=\"cancelar\" value=\"CANCELAR\" onclick=\"Iniciar();MostrarSpan('d2Container');DevolucionDpto('$departamento','$descripcionDpto');\">";			$salidaX .= "		<input type=\"button\" class=\"input-submit\" name=\"insertar\" value=\"INSERTAR\" onclick=\"xajax_InsertarFechaVenLotedev(xGetElementById('fecha').value,xGetElementById('cantid').value,'$cantidad',xGetElementById('lote').value,'$consecutivo','$codigo_producto','$departamento','$sw'); Iniciar();MostrarSpan('d2Container');DevolucionDpto('$departamento','$descripcionDpto');\"></td></tr>";		}		$salidaX .= "	</table>";		$salidaX .= "	</form>";		return $salidaX;	}		function Generar_HTML($info,$sw)	{		$objClass=new app_Solicitud_Medicamentos_PorBodega_user;		$salidaX  = "	<table border=\"0\" width=\"100%\" align=\"center\">";    		$salidaX .= "    <tr class=\"modulo_table_list_title\" align=\"center\">";		$salidaX .= "    	<td witdh=\"5%\"></td>";		$salidaX .= "    	<td witdh=\"5%\">ESTACION</td>";		$salidaX .= "    	<td witdh=\"95%\" colspan=\"5\">SOLICITUDES</td>";		$salidaX .= "    </tr>";		$i=0;		$salida="";		$c=0;		foreach($info as $key=>$valor)		{			if($i%2==0)			{				$estilo="modulo_list_oscuro";			}			else			{				$estilo="modulo_list_claro";			}			$j=0;			$salida0="";			foreach($valor as $key1=>$valor1)			{				if($estilo=="modulo_list_oscuro")				{					$estilo0="modulo_list_claro";				}				else				{					$estilo0="modulo_list_oscuro";				}				$l=0;				$salidaR="";				foreach($valor1 as $key2=>$valor2)				{					$k=0;					$salida1="";					$soli="";					foreach($valor2 as $key3=>$valor3)					{						if($estilo0=="modulo_list_oscuro")						{							$estilo1="modulo_list_claro";						}						else						{							$estilo1="modulo_list_oscuro";						}						if($sw==0 OR $sw==1)							$cama=$objClass->ObtenerCamaDespacho($valor3['ingreso'],$valor3['codigo']);						elseif($sw==3)							$cama=$objClass->ObtenerCamaDevolucion($valor3['ingreso'],$valor3['codigo']);												$salida1 .= "			<tr class=\"$estilo1\" align=\"center\">";						$salida1 .= "				<td>".$valor3['codigo']."</td>";						$salida1 .= "				<td>".$cama['cama']."&nbsp;</td>";						$salida1 .= "				<td>".$valor3['usuarioestacion']."</td>";						$salida1 .= "				<td>".$valor3['fecha']."</td>";						$salida1 .= "				<td>".substr(substr($valor3['fecha_solicitud'],10,18),0,6)."</td>";												$medicamentos=$objClass->medicamentosReportImprimir($valor3['codigo'],$sw);						if($sw!=3)						{							$direccion="app_modules/Solicitud_Medicamentos_PorBodega/reports/html/SolicitudesDespachosDpto_html.report.php?estacion_id=".$valor3['estacion_id']."&estacion=".$key1."&SolicitudId=".$valor3['codigo']."&sw=".$sw;							$actionB=ModuloGetURL('app','Solicitud_Medicamentos_PorBodega','user','ImprimirSolicitudMed',array("EstacionId"=>$valor3['estacion_id'],							"NombreEstacion"=>$valor3['estacion'],"SolicitudId"=>$valor3['codigo'],							"Fecha"=>$valor3['fecha_solicitud'],"usuarioestacion"=>$valor3['usuarioestacion'],							"usuarioId"=>$valor3['usuario_id'],"deptoestacion"=>$valor3['deptoestacion'],							"medicamentos"=>$medicamentos,"rango"=>$valor3['rango'],"tipoafil"=>$valor3['tipo_afiliado_id'],							"cama"=>$cama['cama'],"pieza"=>$cama['pieza'],"plan"=>$valor3['plan_descripcion'],"tipoidPac"=>$valor3['tipo_id_paciente'],							"paciente"=>$valor3['paciente_id'],"nombrepac"=>$valor3['nombrepac'],"sw"=>$sw));						}						else						{							$direccion="app_modules/Solicitud_Medicamentos_PorBodega/reports/html/SolicitudesDevolucionesDpto_html.report.php?estacion_id=".$valor3['estacion_id']."&estacion=".$key1."&SolicitudId=".$valor3['codigo'];													$actionB=ModuloGetURL('app','Solicitud_Medicamentos_PorBodega','user','ImprimirDevolucionIndividual',array("EstacionId"=>$valor3['estacion_id'],							"NombreEstacion"=>$valor3['estacion'],"documento"=>$valor3['codigo'],							"Fecha"=>$valor3['fecha_solicitud'],"usuarioestacion"=>$valor3['usuarioestacion'],							"usuarioId"=>$valor3['usuario_id'],"deptoestacion"=>$valor3['dpto'],							"rango"=>$valor3['rango'],"tipoafil"=>$valor3['tipo_afiliado_id'],							"cama"=>$cama['cama'],"pieza"=>$cama['pieza'],"plan"=>$valor3['plan_descripcion'],"tipoidPac"=>$valor3['tipo_id_paciente'],							"paciente"=>$valor3['paciente_id'],"nombrepac"=>$valor3['nombrepac']));						}												if($sw==0)							$salida1 .= "				<td><a href=\"javascript:Iniciar();MostrarSpan('d2Container');FuncionDetalleInd('".$valor3['codigo']."','$sw','".$valor3['ingreso']."','".$valor3['estacion_id']."','".$valor3['estacion']."','".$valor3['fecha_solicitud']."','".$valor3['usuario_id']." - ".$valor3['usuarioestacion']."','".$valor3['nombrepac']."','".$valor3['tipo_id_paciente']."','".$valor3['paciente_id']."','".$cama['cama']."','".$valor3['departamento']."','".$valor3['dpto']."','".$valor3['estado']."');\"><img src=\"".GetThemePath()."/images/pconsultar.png\" border=\"0\"></a></td>";						elseif($sw==3)							$salida1 .= "				<td><a href=\"javascript:Iniciar();MostrarSpan('d2Container');FuncionDetalleDev('".$valor3['codigo']."','".$valor3['ingreso']."','".$valor3['estacion_id']."','".$valor3['estacion']."','".$valor3['fecha_solicitud']."','".$valor3['usuario_id']." - ".$valor3['usuarioestacion']."','".$valor3['nombrepac']."','".$valor3['tipo_id_paciente']."','".$valor3['paciente_id']."','".$cama['cama']."','".$cama['pieza']."','".$valor3['departamento']."','".$valor3['dpto']."','".$valor3['estado']."','".$valor3['observacion']."','".$valor3['parametro']."');\"><img src=\"".GetThemePath()."/images/pconsultar.png\" border=\"0\"></a></td>";												$salida1 .= "				<td><a href=\"javascript:AbrirVentanaImpresion('$direccion');\"><img src=\"".GetThemePath()."/images/imprimir.png\" border=\"0\"></a></td>";						$salida1 .= "				<td><a href=\"$actionB\"><img src=\"".GetThemePath()."/images/imprimir.png\" border=\"0\"></a></td>";    						$salida1 .= "			</tr>";						$k++;						$c++;						if($k==sizeof($valor2))							$soli.="".$valor3['codigo']."";						else							$soli.="".$valor3['codigo'].".-.";					}										if($sw!=3)					{						$direccionA="app_modules/Solicitud_Medicamentos_PorBodega/reports/html/SolicitudesDespachosDpto_html.report.php?estacion_id=".$valor1[$key2][$key3]['estacion_id']."&estacion=".$key1."&sw=".$sw."&solicitudes=".$soli."&sw_imp=".$key2;						$direccionB="app_modules/Solicitud_Medicamentos_PorBodega/reports/html/SolicDespachosTotalizadas_html.report.php?estacion_id=".$valor1[$key2][$key3]['estacion_id']."&estacion=".$key1."&sw=".$sw."&solicitudes=".$soli."&sw_imp=".$key2;						if($sw==0)							$act="Recargar('F1');";						elseif($sw==1)							$act="Recargar('F2');";					}					else					{						$direccionA="app_modules/Solicitud_Medicamentos_PorBodega/reports/html/SolicitudesDevolucionesDpto_html.report.php?estacion_id=".$valor1[$key2][$key3]['estacion_id']."&estacion=".$key1."&solicitudes=".$soli."&sw_imp=".$key2;						$direccionB="app_modules/Solicitud_Medicamentos_PorBodega/reports/html/SolicDevolucionesTotalizadas_html.report.php?estacion_id=".$valor1[$key2][$key3]['estacion_id']."&estacion=".$key1."&solicitudes=".$soli."&sw_imp=".$key2;												$act="Recargar('F3');";								}					$salidaR .= "	<table width=\"100%\" border=\"0\" align=\"center\" class=\"modulo_table_list\">";					$salidaR .= "		<tr>";					$salidaR .= "				<td width=\"10%\">";					$salidaR .= "					<a href=\"javascript:AbrirVentanaImpresion('$direccionA');$act\"><img src=\"".GetThemePath()."/images/imprimir.png\" border=\"0\" title=\"Impresion Todas Solicitudes Estacion\"> HTML </a>";					if($sw!=3)						$actionT=ModuloGetURL('app','Solicitud_Medicamentos_PorBodega','user','ImprimirTotalesSolicitudesDpto',array("estacion_id"=>$valor1[$key2][$key3]['estacion_id'],"estacion"=>$key1,"sw"=>$sw,"solicitudes"=>$soli,"sw_imp"=>$key2));					else						$actionT=ModuloGetURL('app','Solicitud_Medicamentos_PorBodega','user','ImprimirTotalesDevolucionesDpto',array("estacion_id"=>$valor1[$key2][$key3]['estacion_id'],"estacion"=>$key1,"solicitudes"=>$soli,"sw_imp"=>$key2));					$salidaR .= "					<br><a href=\"$actionT\"><img src=\"".GetThemePath()."/images/imprimir.png\" border=\"0\" title=\"Impresion Todas Solicitudes Estacion\"> POS </a>";					$salidaR .= "					<br><a href=\"javascript:AbrirVentanaImpresion('$direccionB');$act\"><img src=\"".GetThemePath()."/images/imprimir.png\" border=\"0\" title=\"Impresion Medicamentos Totalizados\"> MED </a>";										$usuario=$objClass->GetInfoUsuario($valor1[$key2][$key3]['usuario_imp']);					if($key2)						$salidaR .= "					<br><a class=\"label_mark\" title=\"".$usuario['usuario_id']."-".$usuario['nombre']."\">IMP# : $key2</a>";					$salidaR .= "				</td>";					$salidaR .= "				<td width=\"90%\">";					$salidaR .= "					<table width=\"100%\" border=\"0\">";					$salidaR .= "						<tr class=\"modulo_table_list_title\">";					$salidaR .= "    					<td witdh=\"15%\">CODIGO</td>";					$salidaR .= "							<td witdh=\"15%\">CAMA</td>";					$salidaR .= "    					<td witdh=\"20%\">USUARIO</td>";					$salidaR .= "    					<td witdh=\"15%\">FECHA</td>";					$salidaR .= "    					<td witdh=\"15%\">HORA</td>";					if($sw==0 OR $sw==3)						$salidaR .= "    					<td witdh=\"10%\">DETALLE</td>";					$salidaR .= "    					<td witdh=\"10%\">HTML</td>";					$salidaR .= "    					<td witdh=\"10%\">POS</td>";					$salidaR .= "						</tr>";					$salidaR .= "					".$salida1;					$salidaR .= "					</table>";					$salidaR .= "				</td>";					$salidaR .= "			</tr>";					$salidaR .= "		</table>";										if(sizeof($valor1)>1 AND $l<sizeof($valor1)-1)						$salidaR .= "		<br>";					$l++;				}				$salida0 .= "			<tr class=\"$estilo0\">";				$salida0 .= "				<td align=\"center\" rowspan=\"".sizeof($l+1)."\" class=\"modulo_table_list\">".strtoupper($key1)."</td>";				$salida0 .= "				<td align=\"left\" rowspan=\"".sizeof($l+1)."\">";				$salida0 .= "				".$salidaR;				$salida0 .= "				</td>";				$salida0 .= "			</tr>";								$j++;			}			$salida .= "		<tr class=\"$estilo\">";			$salida .= "			<td align=\"center\" rowspan=\"".($j+1)."\" class=\"modulo_table_list\">".strtoupper($key)."";						if($sw==0)				$salida .= "				<br><a href=\"javascript:Iniciar();MostrarSpan('d2Container');DespachoDpto('".$valor[$key1][$key2][$key3]['departamento']."','$key');\"><img src=\"".GetThemePath()."/images/producto.png\" border=\"0\" title=\"Despachar Todas Las Solicitudes\"></a>";							if($sw==3)				$salida .= "				<br><a href=\"javascript:Iniciar();MostrarSpan('d2Container');DevolucionDpto('".$valor[$key1][$key2][$key3]['departamento']."','$key');\"><img src=\"".GetThemePath()."/images/producto.png\" border=\"0\" title=\"Devolver Todas Las Solicitudes\"></a>";					/*if($sw!=3)				$direccionA="app_modules/Solicitud_Medicamentos_PorBodega/reports/html/SolicitudesDespachosDpto_html.report.php?departamento=".$valor[$key1][$key2]['departamento']."&descripcionDpto=".$key."&sw=".$sw;			else				$direccionA="app_modules/Solicitud_Medicamentos_PorBodega/reports/html/SolicitudesDevolucionesDpto_html.report.php?departamento=".$valor[$key1][$key2]['departamento']."&descripcionDpto=".$key;								$salida .= "				<br><a href=\"javascript:AbrirVentanaImpresion('$direccionA');\"><img src=\"".GetThemePath()."/images/imprimir.png\" border=\"0\" title=\"ImpresionTodasSolicitudesDpto\"> HTML </a>";			if($sw!=3)				$actionT=ModuloGetURL('app','Solicitud_Medicamentos_PorBodega','user','ImprimirTotalesSolicitudesDpto',array("departamento"=>$valor[$key1][$key2]['departamento'],"descripcionDpto"=>$key,"sw"=>$sw));			else				$actionT=ModuloGetURL('app','Solicitud_Medicamentos_PorBodega','user','ImprimirTotalesDevolucionesDpto',array("departamento"=>$valor[$key1][$key2]['departamento'],"descripcionDpto"=>$key));			$salida .= "				&nbsp; <a href=\"$actionT\"><img src=\"".GetThemePath()."/images/imprimir.png\" border=\"0\" title=\"ImpresionTodasSolicitudesDpto\"> POS </a>";						if($sw==0)				$salida .= "			&nbsp; <a href=\"javascript:Iniciar();MostrarSpan('d2Container');DespachoDpto('".$valor[$key1][$key2]['departamento']."','$key');\"><img src=\"".GetThemePath()."/images/producto.png\" border=\"0\" title=\"Despachar Todas Las Solicitudes\"></a>";						if($sw==3)				$salida .= "			&nbsp; <a href=\"javascript:Iniciar();MostrarSpan('d2Container');DevolucionDpto('".$valor[$key1][$key2]['departamento']."','$key');\"><img src=\"".GetThemePath()."/images/producto.png\" border=\"0\" title=\"Devolver Todas Las Solicitudes\"></a>";				*/			$salida .= "			</td>";			$salida .= "		</tr>";			$salida .= "		".$salida0;			$i++;		}		$salidaX .= "".$salida;		$salidaX .= "	</table>";				return $salidaX."ç".$c;	}			function ExistenciasMinimas_HTML($pagina,$info,$count,$limite,$empresa,$centro_utilidad,$bodega)	{		$salidaX  = "	<table border=\"0\" width=\"100%\" align=\"center\" class=\"modulo_table_list\">";    		$salidaX .= "		<tr class=\"modulo_table_list_title\" align=\"center\">";		$salidaX .= "			<td witdh=\"10%\">CODIGO PRODUCTO</td>";		$salidaX .= "			<td witdh=\"20%\">DESCRIPCION</td>";		$salidaX .= "			<td witdh=\"5%\">EXISTENCIA</td>";		$salidaX .= "			<td witdh=\"5%\">EXISTENCIA MINIMA</td>";		$salidaX .= "			<td witdh=\"10%\">USUARIO</td>";		$salidaX .= "			<td witdh=\"10%\">FECHA</td>";		$salidaX .= "			<td witdh=\"10%\">HORA</td>";		$salidaX .= "		</tr>";		$i=0;		foreach($info as $key=>$valor)		{			if($i%2==0)			{				$estilo="modulo_list_oscuro";			}			else			{				$estilo="modulo_list_claro";			}						$salidaX .= "		<tr class=\"$estilo\" align=\"center\">";			$salidaX .= "			<td>".$valor['codigo_producto']."</td>";			$salidaX .= "			<td align=\"left\">".$valor['desprod']."</td>";			$salidaX .= "			<td>".$valor['existencia']."</td>";			$salidaX .= "			<td>".$valor['existencia_minima']."</td>";			$salidaX .= "			<td>".$valor['nombre_usuario']."</td>";			$salidaX .= "			<td>".$valor['fecha']."</td>";			$salidaX .= "			<td>".substr(substr($valor['fecha_registro'],10,18),0,6)."</td>";			$salidaX .= "		</tr>";			$i++;		}		$salidaX .= "</table>";		$op="1";				$salidaX .= "".ObtenerPaginado($pagina,GetThemePath(),$count,$op,$limite,$empresa,$centro_utilidad,$bodega);				return $salidaX;	}		function ObtenerPaginado($pagina,$path,$slc,$op,$limite,$empresa,$centro_utilidad,$bodega)	{		$TotalRegistros = $slc;		$TablaPaginado = "";				if($limite == null)		{			$uid = UserGetUID();			$LimitRow = intval(GetLimitBrowser());		}		else		{			$LimitRow = $limite;		}		if ($TotalRegistros > 0)		{			$columnas = 1;			$NumeroPaginas = intval($TotalRegistros/$LimitRow);						if($TotalRegistros%$LimitRow > 0)			{				$NumeroPaginas++;			}								$Inicio = $pagina;			if($NumeroPaginas - $pagina < 9 )			{				$Inicio = $NumeroPaginas - 9;			}			elseif($pagina > 1)			{				$Inicio = $pagina - 1;			}						if($Inicio <= 0)			{				$Inicio = 1;			}							$estilo = " style=\"font-family: sans_serif, Verdana, helvetica, Arial; font-weight:bold;font-size:11pt;\" "; 				$TablaPaginado .= "<tr>\n";			if($NumeroPaginas > 1)			{				$TablaPaginado .= "   <td class=\"label\" bgcolor=\"#D3DCE3\">Paginas:</td>\n";				if($pagina > 1)				{					$TablaPaginado .= "   <td class=\"label\" bgcolor=\"#D3DCE3\">\n";					$TablaPaginado .= "     <a class=\"label_error\" href=\"javascript:Busqueda('1','".$empresa."','".$centro_utilidad."','".$bodega."')\" title=\"primero\"><img src=\"".$path."/images/primero.png\" border=\"0\" width=\"15\" height=\"15\"></a>\n";					$TablaPaginado .= "   </td><td bgcolor=\"#D3DCE3\">\n";					$TablaPaginado .= "     <a class=\"label_error\" href=\"javascript:Busqueda('".($pagina-1)."','".$empresa."','".$centro_utilidad."','".$bodega."')\" title=\"anterior\"><img src=\"".$path."/images/anterior.png\" border=\"0\" width=\"15\" height=\"15\"></a>\n";					$TablaPaginado .= "   </td>\n";					$columnas +=2;				}				$Fin = $NumeroPaginas + 1;				if($NumeroPaginas > 10)				{					$Fin = 10 + $Inicio;				}									for($i=$Inicio; $i< $Fin ; $i++)				{					if ($i == $pagina )					{						$TablaPaginado .="    <td class=\"modulo_list_oscuro\" $estilo align=\"center\"><b>".$i."</b></td>\n";					}					else					{						$TablaPaginado .="    <td class=\"modulo_list_claro\" $estilo align=\"center\"><a href=\"javascript:Busqueda('".$i."','".$empresa."','".$centro_utilidad."','".$bodega."')\">".$i."</a></td>\n";					}					$columnas++;				}			}			if($pagina <  $NumeroPaginas )			{				$TablaPaginado .= "   <td class=\"label\" bgcolor=\"#D3DCE3\">\n";				$TablaPaginado .= "     <a class=\"label_error\" href=\"javascript:Busqueda('".($pagina+1)."','".$empresa."','".$centro_utilidad."','".$bodega."')\" title=\"siguiente\"><img src=\"".$path."/images/siguiente.png\" border=\"0\" width=\"15\" height=\"15\"></a>\n";				$TablaPaginado .= "   </td><td bgcolor=\"#D3DCE3\">\n";				$TablaPaginado .= "     <a class=\"label_error\"  href=\"javascript:Busqueda('".$NumeroPaginas."','".$empresa."','".$centro_utilidad."','".$bodega."')\" title=\"ultimo\"><img src=\"".$path."/images/ultimo.png\" border=\"0\" width=\"15\" height=\"15\"></a>\n";				$TablaPaginado .= "   </td>\n";				$columnas +=2;			}			$aviso .= "   <tr><td class=\"label\"  colspan=".$columnas." align=\"center\">\n";			$aviso .= "     Pagina&nbsp;".$pagina." de ".$NumeroPaginas."</td>\n";			$aviso .= "   </tr>\n";						if($op == 2)			{				$TablaPaginado .= $aviso;			}			else			{				$TablaPaginado = $aviso.$TablaPaginado;			}		}		$Tabla .= "<table align=\"center\" cellspacing=\"3\" >\n";		$Tabla .= $TablaPaginado;		$Tabla .= "</table>";				return $Tabla;	}		function GetMedicamentoSimil($codigo_producto,$canSol,$pos)	{		$objResponse=new xajaxResponse();				$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				$codigo_pro=explode(" => ",$codigo_producto);				if($existencia=$objClass->GetCantidadExistenteBodega($codigo_pro[0]))		{			$objResponse->assign("CheckDespachar$pos","style.display","");						if(!$existencia['existencia'])			{				$existencia['existencia']="0";				$objResponse->assign("CheckDespachar$pos","style.display","none");			}			$objResponse->assign("CantExistente$pos","value",$existencia['existencia']);			$objResponse->assign("CantDespachar$pos","value",$canSol);		}				return $objResponse;	}		function DetalleSolicitudInd_HTML($vector,$sw,$tipoSolicitud,$SolicitudId,$Ingreso,$EstacionId,$NombreEstacion,$Fecha,$usuarioestacion,$nombrepac,$tipo_id_paciente,$paciente_id,$cama,$departamento,$descripcionDpto,$estado)	{		$objClass=new app_Solicitud_Medicamentos_PorBodega_user;		(list($fecha,$HoraTot)=explode(' ',$Fecha));		(list($ano,$mes,$dia)=explode('-',$fecha));		(list($hora,$min)=explode(':',$HoraTot));				$salidaX .= "<form name=\"Solicitud\" action=\"\" method=\"post\">";		$salidaX .= "<table class=\"modulo_table_list\" border=\"0\"  width=\"100%\" align=\"center\">";		$salidaX .= "	<tr>";		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">SOLICITANTE</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" colspan=\"3\">$NombreEstacion</td>";		$salidaX .= "	</tr>";		$salidaX .= "	<tr>";		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">FECHA SOLICITUD</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" width=\"45%\">".strftime('%b %d de %Y  %H:%M',mktime($hora,$min,0,$mes,$dia,$ano))."</td>";                 		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">CODIGO SOLICITUD</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" width=\"15%\">$SolicitudId</td>";		$salidaX .= "	</tr>";		$salidaX .= "	<tr class=\"modulo_list_oscuro\">";		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">PACIENTE</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" width=\"45%\">".$tipo_id_paciente."-".$paciente_id."  ".utf8_decode($nombrepac)."</td>";		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">CAMA</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" width=\"15%\">$cama</td>";		$salidaX .= "	</tr>";		$salidaX .= "</table>";		if($tipoSolicitud['tipo_solicitud']=='Z')		{			if($ValueMed[mezcla_recetada_id])			{				$salidaX .= "          <td>MEZCLA</td>\n";			}		}				$salidaX .= "<br><table width=\"100%\" class=\"modulo_table_list\" border=\"0\" align=\"center\" cellspacing=\"2\" cellpadding=\"2\"> \n";		$salidaX .= "		<tr class=\"modulo_table_list_title\">\n";		$salidaX .= "			<td>MEDICAMENTO</td>";		$salidaX .= "			<td>CANT EXISTENTE</td>";		$salidaX .= "			<td>CANT SOLICITADA</td>";		$salidaX .= "			<td>CANT A DESPACHAR</td>";		$salidaX .= "			<td><input type=\"checkbox\" name=\"Todos\" value=\"1\" onclick=\"SeleccionarTodos(this.form,this.checked);\"></td>";		$salidaX .= "		</tr>\n";		$i=0;    $medSolicitados = array();		foreach($vector as $keyMed => $ValueMed)		{			$medSolicitados[$ValueMed['medicamento_id']] = $ValueMed['tipo_producto'];      if(($l++) % 2)  				$estilo = "modulo_list_claro";  			else 				$estilo = "modulo_list_oscuro";						$CodigoProd=$ValueMed[medicamento_id];			$salidaX .= "				<tr align=\"center\" class=\"$estilo\">\n";			$Existencia=$objClass->GetCantidadExistenteBodega($ValueMed[medicamento_id]);			$cantidadExistente=$Existencia['existencia'];			if($tipoSolicitud['tipo_solicitud']!='I')			{				$MedSimilares = $objClass->GetMedicamentosSimilares($ValueMed[medicamento_id],$ValueMed[cant_solicitada]);			}			else			{				unset($MedSimilares);			}			if($cantidadExistente)			{				if($tipoSolicitud['tipo_solicitud']=='Z')				{					if($ValueMed[mezcla_recetada_id] && $ValueMed[mezcla_recetada_id]!=$mezclaAnterior)					{						$contadorRowSpan1=$objClass->rowspanMezclas($SolicitudId,$ValueMed[mezcla_recetada_id]);						$salidaX .= "					<td rowspan=\"".$contadorRowSpan1['contador']."\">".$ValueMed[mezcla_recetada_id]."</td>\n";						$mezclaAnterior=$ValueMed[mezcla_recetada_id];					}				}				if(sizeof($MedSimilares)<2 || !$MedSimilares)				{					$salidaX .= "					<td>".$ValueMed[medicamento_id]." => ".$ValueMed[nommedicamento]." ".$ValueMed[ff]."</td>\n";					$salidaX .= "						<input type=\"hidden\" name=\"SelectMedicamentos[".$i."]\" id=\"SelectMedicamentos$i\">\n";				}				else				{					$salidaX .= "					<td>\n";					$salidaX .= "						<select name=\"SelectMedicamentos[".$i."]\" id=\"SelectMedicamentos$i\" class=\"select\" onchange=\"xajax_GetMedicamentoSimil(xGetElementById('SelectMedicamentos$i').value,xGetElementById('CantSolicitada$i').value,'$i');\">\n";					for($j=0; $j<sizeof($MedSimilares); $j++)					{            $medSolicitados[$MedSimilares[$j]['codigo_producto']] = "M";						if($MedSimilares[$j][codigo_producto] == $ValueMed[medicamento_id]){ $selected = "selected"; } else{$selected = ""; }						$salidaX .= "						<option value=\"".$MedSimilares[$j][codigo_producto]." => ".str_replace("'","",$MedSimilares[$j][nommedicamento])."\" $selected >".$MedSimilares[$j][codigo_producto]." => ".$MedSimilares[$j][nommedicamento]." ".$MedSimilares[$j][concentracion]." ".$MedSimilares[$j][ff]."</option> \n";					}					$salidaX .= "						</select>\n";					$salidaX .= "					</td>\n";				}				$salidaX .= "					<td><input type=\"text\" name=\"CantExistente[]\" id=\"CantExistente$i\" class=\"input-text\" value=\"".$cantidadExistente."\" size=\"10\" READONLY></td>\n";				$salidaX .= "					<td>\n";        $salidaX .= "           <input type=\"hidden\" name=\"CantSolicitada[]\" id=\"CantSolicitada$i\" value=\"".$ValueMed[cant_solicitada]."\">".$ValueMed[cant_solicitada]."\n";        $salidaX .= "         </td>\n";				if($ValueMed[cant_solicitada] <= $cantidadExistente)				{					$cantidad=$ValueMed[cant_solicitada];				}				else				{					if($cantidadExistente<0)					{						$cantidad=0;					}					else					{						$cantidad=$cantidadExistente;					}				}				$salidaX .= "					<td><input type=\"text\" id=\"CantDespachar$i\" name=\"CantDespachar[]\" value=\"".$cantidad."\" size=\"10\" class=\"input-text\" onkeyup=\"ValidarCantidad('CantDespachar$i',xGetElementById('CantDespachar$i').value,xGetElementById('CantSolicitada$i').value);\" onkeypress=\"ValidarCantidad('CantDespachar$i',xGetElementById('CantDespachar$i').value,xGetElementById('CantSolicitada$i').value);\"></td>\n";				$salidaX .= "					<td><input type=\"checkbox\" id=\"CheckDespachar$i\" name=\"CheckDespachar[]\" value=\"".$ValueMed[medicamento_id]."__".$cantidad."__".$ValueMed[consecutivo_d]."__".$ValueMed[codigo_producto]."\"></td>\n";				$contadorRowSpan--;			}			else			{				$salidaX .= "					<td>".$ValueMed[medicamento_id]." => ".$ValueMed[nommedicamento]." ".$ValueMed[ff]."</td>";				$salidaX .= "					<td colspan=\"4\" class=\"label_error\">PRODUCTO NO EXISTE EN LA BODEGA</td>";				$contadorRowSpan--;			}			$salidaX .= "				</tr>\n";			$i++;		}		$contadorJs=$i;		$salidaX .= "			<input type=\"hidden\" name=\"ContadorJs\" value=\"$contadorJs\">\n";		$salidaX .= "				</tr>\n";		$salidaX .= "				<tr class=\"modulo_list_claro\">\n";		$salidaX .= "					<td colspan=\"5\" align=\"right\"><input type=\"button\" class=\"input-submit\" name=\"despachar\" value=\"DESPACHAR\" onclick=\"DespacharNC('$contadorJs','$sw','".$tipoSolicitud['tipo_solicitud']."','$SolicitudId','$Ingreso','$EstacionId','$NombreEstacion','$Fecha','$usuarioestacion','$nombrepac','$tipo_id_paciente','$paciente_id','$cama','$departamento','$descripcionDpto','$estado');\"></td>\n";		$salidaX .= "				</tr>\n";		$salidaX .= "		</table>\n";		$salidaX .= "</form>";    SessionSetVar("MedicamentosSolicitadosPr",$medSolicitados);		return $salidaX;	}		function Despachar_HTML($datos,$vector,$motivos_can,$concepto,$sw,$tipoSolicitud,$SolicitudId,$Ingreso,$EstacionId,$NombreEstacion,$Fecha,$usuarioestacion,$nombrepac,$tipo_id_paciente,$paciente_id,$cama,$departamento,$descripcionDpto,$estado)	{		$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				$salidaX .= "<table class=\"modulo_table_list\" border=\"0\"  width=\"100%\" align=\"center\">";		$salidaX .= "	<tr>";		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">SOLICITANTE</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" colspan=\"3\">$NombreEstacion</td>";		$salidaX .= "	</tr>";		$salidaX .= "	<tr>";		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">FECHA SOLICITUD</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" width=\"45%\">".strftime('%b %d de %Y  %H:%M',mktime($hora,$min,0,$mes,$dia,$ano))."</td>";                 		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">CODIGO SOLICITUD</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" width=\"15%\">$SolicitudId</td>";		$salidaX .= "	</tr>";		$salidaX .= "	<tr class=\"modulo_list_oscuro\">";		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">PACIENTE</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" width=\"45%\">".$tipo_id_paciente." - ".$paciente_id." ".utf8_decode($nombrepac)."</td>";		$salidaX .= "		<td class=\"modulo_table_list_title\" width=\"20%\">CAMA</td>";		$salidaX .= "		<td class=\"modulo_list_oscuro\" width=\"15%\">$cama</td>";		$salidaX .= "	</tr>";		$salidaX .= "</table>";		$salidaX .= "<br><table width=\"100%\" class=\"modulo_table_list\" border=\"0\" align=\"center\" cellspacing=\"2\" cellpadding=\"2\"> \n";		$salidaX .= "		<tr class=\"modulo_table_list_title\">\n";		$salidaX .= "			<td width=\"30%\">MEDICAMENTO/INSUMO</td>\n";		$salidaX .= "			<td width=\"8%\">CANT<BR>SOLICITADA</td>\n";		$salidaX .= "			<td width=\"8%\">CANT A<BR>DESPACHAR</td>\n";		$salidaX .= "			<td width=\"8%\">CANT<BR>PENDIENTE</td>\n";		$salidaX .= "			<td width=\"8%\">DEJAR<BR>PENDIENTE</td>\n";		$salidaX .= "			<td width=\"8%\">CANCELAR</td>\n";		$salidaX .= "			<td width=\"15%\">MOTIVO<br>CANCELACION</td>\n";		$salidaX .= "			<td width=\"15%\">OBSERVACIONES</td>\n";		$salidaX .= "		</tr>\n";		$i=0;				//var_dump($vector);		//var_dump($datos);				foreach($vector as $key => $valor)		{			if(($l++) % 2)  				$estilo = "modulo_list_claro";  			else 				$estilo = "modulo_list_oscuro";							$Cantpendiente=$valor['cantidad'];			$cantidadDespachar=0;			$equiMed="";			foreach($datos as $valorD)			{				list($medicamento,$cantidadSol,$conse,$codigo_pro,$cantidadDes,$selectMed)=explode("__",$valorD);								if($medicamento==$valor['codigo_producto'] AND $conse==$valor['consecutivo_d'])				{					$cantidadDespachar=$cantidadDes;					$equiMed=$selectMed;					break;				}			}			if($equiMed==" => ")				$equiMed="";						$salidaX .= "<tr align=\"center\" class=\"$estilo\">\n";			$salidaX .= "		<td>".$valor['codigo_producto']." => ".$valor['descripcion']."\n";			if($equiMed)				$salidaX .= "<br><b>Equivalente:<b> ".$equiMed."\n";						$salidaX .= "		</td>";			$salidaX .= "		<td>".$valor['cantidad']."</td>\n";			$salidaX .= "				<td>".$cantidadDespachar."</td>\n";			$Cantpendiente=$valor['cantidad']-$cantidadDespachar;			$salidaX .= "				<td>".$Cantpendiente."</td>\n";			if($Cantpendiente > 0)			{				$salidaX .= "		<td><input type=\"radio\" id=\"pendiente$i\" name=\"decision$i\" value=\"1@".$valor['codigo_producto']."\" checked onclick=\"xGetElementById('motivo$i').disabled=true;xGetElementById('observa$i').disabled=true;xGetElementById('motivo$i').value='';xGetElementById('observa$i').value='';\"></td>\n";				$salidaX .= "		<td><input type=\"radio\" id=\"cancela$i\" name=\"decision$i\" value=\"2@".$valor['codigo_producto']."\" onclick=\"xGetElementById('motivo$i').disabled=false;xGetElementById('observa$i').disabled=false;\"></td>\n";				$salidaX .= "		<td>\n";				$salidaX .= "			<select id=\"motivo$i\" name=\"motivo$i\" class=\"select\" disabled>\n";				$salidaX .= "				<option value=\"\">--SELECCIONE--</option>\n";				foreach($motivos_can as $keyM=>$valorM)				{					$salidaX .= "				<option value=\"".$valorM['motivo_id']."\">".$valorM['descripcion']."</option>\n";				}				$salidaX .= "			</select>\n";				$salidaX .= "		<td><textarea id=\"observa$i\" name=\"observa$i\" class=\"textarea\" rows=\"2\" cols=\"15\" disabled></textarea></td>\n";			}			else			{				$salidaX .= "		<td>&nbsp;</td>\n";				$salidaX .= "		<td>&nbsp;</td>\n";				$salidaX .= "		<td>&nbsp;</td>\n";				$salidaX .= "		<td>&nbsp;</td>\n";								$salidaX .= "		<input type=\"hidden\" id=\"cancela$i\" value=\"\">";				$salidaX .= "		<input type=\"hidden\" id=\"pendiente$i\" value=\"\">";				$salidaX .= "		<input type=\"hidden\" id=\"motivo$i\" name=\"motivo$i\" value=\"\">";				$salidaX .= "		<input type=\"hidden\" id=\"observa$i\" name=\"observa$i\" value=\"\">";			}			$salidaX .= "</tr>\n";			$codigo = $valor['codigo_producto'];			if($equiMed)			{				list($codigo,$nombre)=explode(" => ",$equiMed);			}						$costoProducto=$objClass->HallarCostoProducto($_SESSION['Bodegas']['empresa_id'],$codigo);						$datosConfirm.="".$codigo."__".$cantidadDespachar."__".$Cantpendiente."__".$costoProducto."__".$valor['consecutivo_d']."||";			$i++;		}		$salidaX .= "				</tr>\n";		$salidaX .= "				<tr class=\"modulo_list_claro\">\n";		$salidaX .= "					<td colspan=\"8\" align=\"right\"><input type=\"button\" class=\"input-submit\" name=\"despachar\" value=\"CONFIRMAR\" onclick=\"ConfirmacionDespacho('$tipoSolicitud','$SolicitudId','$EstacionId','$NombreEstacion','$Ingreso','$Fecha','$concepto','$usuarioestacion','$datosConfirm','$i');\">\n";		$salidaX .= "					</td>\n";		$salidaX .= "				</tr>\n";		$salidaX .= "		</table>\n";				$salidaX .= "		<center><br><input type=\"button\" class=\"input-submit\" name=\"volver\" value=\"VOLVER\" onclick=\"Iniciar();MostrarSpan('d2Container');FuncionDetalleInd('$SolicitudId','$sw','$Ingreso','$EstacionId','$NombreEstacion','$Fecha','$usuarioestacion','".utf8_decode($nombrepac)."','$tipo_id_paciente','$paciente_id','$cama','$departamento','$descripcionDpto','$estado');\"></center>\n";		return $salidaX;	}		function ConfirmarDespacho_HTML($estacion_id,$NombreEstacion,$Solicitud,$sw)	{		$empresa=$_SESSION['Bodegas']['empresa_id'];		$centro=$_SESSION['Bodegas']['centro_id'];		$bodega=$_SESSION['Bodegas']['bodega'];				$salidaX .= "		<center><br><label class=\"label_error\">SE REALIZO EL DESPACHO/CANCELACION DE LA SOLICITUD SATISFACTORIAMENTE</label>";		$salidaX .= "		<br><br><input type=\"button\" class=\"input-submit\" name=\"aceptar\" value=\"ACEPTAR\" onclick=\"xajax_Solicitudes('$empresa','$centro','$bodega');xajax_Despachos('$empresa','$centro','$bodega');Cerrar('d2Container');\">";		$direccion="app_modules/Solicitud_Medicamentos_PorBodega/reports/html/SolicitudesDespachosDpto_html.report.php?estacion_id=".$estacion_id."&estacion=".$NombreEstacion."&SolicitudId=".$Solicitud."&sw=".$sw;		$salidaX .= "		&nbsp;&nbsp;&nbsp;&nbsp;<a href=\"javascript:AbrirVentanaImpresion('$direccion');\"><img src=\"".GetThemePath()."/images/imprimir.png\" border=\"0\">IMPRIMIR DESPACHO</a></center>";				return $salidaX;	}		function RealizarDevolucion_HTML()	{		$empresa=$_SESSION['Bodegas']['empresa_id'];		$centro=$_SESSION['Bodegas']['centro_id'];		$bodega=$_SESSION['Bodegas']['bodega'];				$salidaX.= "		<center><br><label class=\"label_error\">SE REALIZÓ LA DEVOLUCION DE LOS PRODUCTOS A LA BODEGA</label>";		$salidaX.= "		<br><br><input type=\"button\" class=\"input-submit\" name=\"aceptar\" value=\"ACEPTAR\" onclick=\"xajax_Devoluciones('$empresa','$centro','$bodega');Cerrar('d2Container');\"></center>";				return $salidaX;	}		function CancelacionDevolucion_HTML()	{		$empresa=$_SESSION['Bodegas']['empresa_id'];		$centro=$_SESSION['Bodegas']['centro_id'];		$bodega=$_SESSION['Bodegas']['bodega'];				$salidaX .= "		<center><br><label class=\"label_error\">SE CANCELARON TODOS LOS PRODUCTO DE LA SOLICITUD DE DEVOLUCION</label>";		$salidaX .= "		<br><br><input type=\"button\" class=\"input-submit\" name=\"aceptar\" value=\"ACEPTAR\" onclick=\"xajax_Devoluciones('$empresa','$centro','$bodega');Cerrar('d2Container');\"></center>";				return $salidaX;	}		function CancelarSolicitudesDevoluciones_HTML($Motivos,$SelectDatos,$EstacionId,$NombreEstacion,$Fecha,$Documento,$Ingreso,$observaciones,$tipo_id_paciente,$paciente_id,$nombrepac,$cama,$pieza,$departamento,$dpto,$estado,$parametro,$usuarioestacion)	{		$salidaX .= "	<table class=\"modulo_table_list\" border=\"0\" width=\"100%\" align=\"center\">";		$salidaX .= "		<tr class=\"modulo_list_claro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"15%\">PACIENTE</td>";		$salidaX .= "			<td>$tipo_id_paciente - $paciente_id   $nombrepac</td>";		$salidaX .= "		</tr>";		$salidaX .= "		<tr class=\"modulo_list_claro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"20%\">CAMA</td>";		$salidaX .= "			<td>".$cama." - ".$pieza."</td>";		$salidaX .= "		</tr>";		$salidaX .= "		<tr class=\"modulo_list_claro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"20%\">SOLICITANTE</td>";		$salidaX .= "			<td>$NombreEstacion</td>";		$salidaX .= "		</tr>";		$salidaX .= "	  <tr class=\"modulo_list_oscuro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"20%\">FECHA SOLICITUD</td>";    (list($fecha,$HoraTot)=explode(' ',$Fecha));    (list($ano,$mes,$dia)=explode('-',$fecha));    (list($hora,$min)=explode(':',$HoraTot));    $salidaX .= "			<td>".strftime('%b %d de %Y  %H:%M',mktime($hora,$min,0,$mes,$dia,$ano))."</td>";				$salidaX .= "		</tr>";		$salidaX .= "		<tr class=\"modulo_list_claro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"20%\">CODIGO</td>";		$salidaX .= "			<td>$Documento</td>";		$salidaX .= "		</tr>";		$salidaX .= "		<tr class=\"modulo_list_oscuro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"20%\">OBSERVACIONES</td>";		$salidaX .= "			<td>$observaciones</td>\n";		$salidaX .= "		</tr>";    $salidaX .= "		<tr class=\"modulo_list_oscuro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"20%\">PARAMETRO DE DEVOLUCION</td>";		$salidaX .= "			<td>$parametro</td>\n";		$salidaX .= "		</tr>";		$salidaX .= "	</table><br>";				$salidaX .= "	<table border=\"0\" width=\"100%\" class=\"modulo_table_list\" align=\"center\">";		$salidaX .= "		<tr>";		$salidaX .= "			<td class=\"modulo_table_list_title\">";		$salidaX .= "				MOTIVO CANCELACION";		$salidaX .= "			</td>";		$salidaX .= "			<td class=\"modulo_list_claro\">";		$salidaX .= "				<select name=\"MotivoId\"  id=\"motivo_can\" class=\"select\">";		$salidaX .= "					<option value=\"\">--SELECCIONE--</option>";    foreach($Motivos as $key=>$valor)		{			$salidaX .=" <option value=\"".$valor['motivo_id']."\">".$valor['descripcion']."</option>";    }		$salidaX .= "        </select>";		$salidaX .= "			</td>";		$salidaX .= "		</tr>";		$salidaX .= "		<tr>";		$salidaX .= "			<td class=\"modulo_table_list_title\">";		$salidaX .= "				OBSERVACIONES";		$salidaX .= "			</td>";		$salidaX .= "			<td class=\"modulo_list_claro\">";		$salidaX .= "				<textarea name=\"observacion\" id=\"observacion\" cols=\"65\" rows=\"3\" class=\"input-text\"></textarea>";		$salidaX .= "			</td>";		$salidaX .= "		</tr>";		$salidaX .= "	</table>";				$vars="new Array(";		$b=true;				foreach($SelectDatos as $key=>$valor)		{			$b? $vars.="'".$valor."'":$vars.=",'".$valor."'";			$b=false;		}		$vars.=")";		$salidaX .= "				<br><center><input class=\"input-submit\" type=\"submit\" name=\"Aceptar\" value=\"ACEPTAR\" onclick=\"xajax_CancelarProDev($vars,'$Documento',xGetElementById('motivo_can').value,xGetElementById('observacion').value);\">";		$salidaX .= "				&nbsp; <input class=\"input-submit\" type=\"submit\" name=\"Salir\" value=\"VOLVER\" onclick=\"Iniciar();MostrarSpan('d2Container');FuncionDetalleDev('".$Documento."','".$Ingreso."','".$EstacionId."','".$NombreEstacion."','".$Fecha."','".$usuarioestacion."','".$nombrepac."','".$tipo_id_paciente."','".$paciente_id."','".$cama."','".$pieza."','".$departamento."','".$dpto."','".$estado."','".$observaciones."','".$parametro."');\"></center>";		return $salidaX;	}	function DetalleSolicitudDev_HTML($datos,$Documento,$Ingreso,$EstacionId,$NombreEstacion,$Fecha,$usuarioestacion,$nombrepac,	$tipo_id_paciente,$paciente_id,$cama,$pieza,$departamento,$descripcionDpto,$estado,$observaciones,$parametro)	{		$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				$salidaX .= "	<table class=\"modulo_table_list\" border=\"0\" width=\"100%\" align=\"center\">";		$salidaX .= "		<tr class=\"modulo_list_claro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"15%\">PACIENTE</td>";		$salidaX .= "			<td>$tipo_id_paciente - $paciente_id   $nombrepac</td>";		$salidaX .= "		</tr>";		$salidaX .= "		<tr class=\"modulo_list_claro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"20%\">CAMA</td>";		$salidaX .= "			<td>".$cama." - ".$pieza."</td>";		$salidaX .= "		</tr>";		$salidaX .= "		<tr class=\"modulo_list_claro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"20%\">SOLICITANTE</td>";		$salidaX .= "			<td>$NombreEstacion</td>";		$salidaX .= "		</tr>";		$salidaX .= "	  <tr class=\"modulo_list_oscuro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"20%\">FECHA SOLICITUD</td>";    (list($fecha,$HoraTot)=explode(' ',$Fecha));    (list($ano,$mes,$dia)=explode('-',$fecha));    (list($hora,$min)=explode(':',$HoraTot));    $salidaX .= "			<td>".strftime('%b %d de %Y  %H:%M',mktime($hora,$min,0,$mes,$dia,$ano))."</td>";				$salidaX .= "		</tr>";		$salidaX .= "		<tr class=\"modulo_list_claro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"20%\">CODIGO</td>";		$salidaX .= "			<td>$Documento</td>";		$salidaX .= "		</tr>";		$salidaX .= "		<tr class=\"modulo_list_oscuro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"20%\">OBSERVACIONES</td>";		$salidaX .= "			<td>$observaciones</td>\n";		$salidaX .= "		</tr>";    $salidaX .= "		<tr class=\"modulo_list_oscuro\">";		$salidaX .= "			<td class=\"modulo_table_list_title\" width=\"20%\">PARAMETRO DE DEVOLUCION</td>";		$salidaX .= "			<td>$parametro</td>\n";		$salidaX .= "		</tr>";		$salidaX .= "	</table><br>";				$salidaX .= "	<form name=\"forma_dev\" action=\"\" method=\"post\"> \n";		$salidaX .= "		<table width=\"100%\" class=\"modulo_table_list\" border=\"0\" align=\"center\"> \n";		$salidaX .= "			<tr class=\"modulo_table_list_title\">\n";		$salidaX .= "				<td width=\"10%\">CODIGO PRODUCTO</td>\n";		$salidaX .= "				<td>NOMBRE</td>\n";		$salidaX .= "				<td width=\"10%\">CANTIDAD DEVOLUCION</td>\n";		$salidaX .= "				<td>LOTES</td>\n";		$salidaX .= "				<td width=\"10%\">FECHA VENCIMIENTO</td>";		$salidaX .= "				<td width=\"10%\">LOTE</td>";		$salidaX .= "				<td width=\"10%\">CANTIDAD LOTE</td>";		$salidaX .= "				<td><input type=\"checkbox\" name=\"selectodo\" onclick=\"SeleccionarTodos(this.form,this.checked);\"></td>\n";		$salidaX .= "			</tr>\n";				$y=0;		foreach($datos as $key=>$valor)		{		  if($y % 2)			{				$estilo='modulo_list_claro';			}			else			{				$estilo='modulo_list_oscuro';			}						$salidaX .= "	<tr class=\"$estilo\">\n";			$salidaX .= "	 	<td>".$valor['codigo_producto']."</td>";			$salidaX .= "	 	<td>".$valor['descripcion']."</td>";			$salidaX .= "	 	<td>".FormatoValor($valor['cantidad'])."</td>";						$sumaTotal=$objClass->SumaFechasLotesProductosDevol($valor['consecutivo'],$valor['codigo_producto']);			$DatosLotes=$objClass->FechasLotesProductosDevol($valor['consecutivo'],$valor['codigo_producto']);						if($valor['sw_control_fecha_vencimiento']=='1')			{				$style="style=\"display:block\"";			}			else			{				$style="style=\"display:none\"";			}			$salidaX .= "     <td align=\"center\"><center><table $style id=\"InsLote$y\" border=\"0\" cellpadding=\"0\" cellspancing=\"0\"><tr><td><a href=\"javascript:MostrarLotesPtosDevols('$EstacionId','$NombreEstacion','$Documento','$Ingreso','$observaciones','".$valor['codigo_producto']."','".$valor['descripcion']."','".$valor['cantidad']."','".$valor['consecutivo']."','".$tipo_id_paciente."','".$paciente_id."','".$nombrepac."','".$cama."','".$pieza."','".$parametro."','".$departamento."','$Fecha','$usuarioestacion','$descripcionDpto','1');\"><img border=\"0\" src=\"".GetThemePath()."/images/pparamed.png\"></a></td></tr></table></center></td>";			if($DatosLotes)			{				$salidaX .= "     <td align=\"center\" colspan=\"3\">";				$salidaX .= "	     <table  id=\"ElimLote$y\" cellspacing=\"2\"  cellpadding=\"3\"border=\"0\" width=\"99%\" align=\"center\">";				$z=0;				foreach($DatosLotes as $keyL=>$valorL)				{					if($z % 2)					{						$estilo1='modulo_list_oscuro';					}					else					{						$estilo1='modulo_list_claro';					}										$salidaX .= "	      <tr class=\"$estilo1\">\n";					$salidaX .= "	      <td width=\"32%\">".$valorL['fecha_vencimiento']."</td>";					$salidaX .= "	      <td width=\"35%\">".$valorL['lote']."</td>";					$salidaX .= "	      <td>".$valorL['cantidad']."</td>";					$salidaX .= "	      <td width=\"5%\"><a href=\"javascript:FuncionEliminar('".$valorL['fecha_vencimiento']."','".$valorL['lote']."','".$valorL['cantidad']."','".$valor['consecutivo']."','".$valor['codigo_producto']."','InsLote$y','ElimLote$y');\"><img border=\"0\" src=\"".GetThemePath()."/images/elimina.png\"></a></td>";					$salidaX .= "	      </tr>";					$z++;				}				$salidaX .= "	     </table>";				$salidaX .= "</td>";			}			else			{				$salidaX .= "     <td colspan=\"3\" align=\"center\">&nbsp;</td>";			}			$salidaX .= "	 <td width=\"5%\" align=\"center\"><input type=\"checkbox\" id=\"checkboxDevol$y\" name=\"checkboxDevol[]\" value=\"".$valor['codigo_producto']."__".$valor['cantidad']."__".$valor['consecutivo']."\"></td>";			$salidaX .= "	 </tr>\n";			$y++;		}		$salidaX .= "	 		<tr class=\"modulo_list_oscuro\">\n";		$salidaX .= "	 			<td colspan=\"8\" align=\"right\"><input type=\"button\" class=\"input-submit\" name=\"CancelarProducto\" value=\"CANCELAR PRODUCTOS\" onclick=\"CancelarPro('$EstacionId','$NombreEstacion','$Documento','$Fecha','$Ingreso','$observaciones','$tipo_id_paciente','$paciente_id','$nombrepac','$cama','$pieza','$departamento','$descripcionDpto','$estado','$parametro','$usuarioestacion','$y');\"></td>";		$salidaX .= "	 		</tr>\n";		$salidaX .= "		</table>";				$salidaX .= "	 			<br><center><input type=\"button\" class=\"input-submit\" name=\"AceptarDevolucion\" value=\"ACEPTAR DEVOLUCION\" onclick=\"AceptarDev('$EstacionId','$NombreEstacion','$Documento','$Fecha','$Ingreso','$observaciones','$y');\"></center>";		$salidaX .= "	</form>";				return $salidaX;	}		function DespacharDpto_HTML($Datos,$departamento,$descripcionDpto,$concepto)	{		$objClass=new app_Solicitud_Medicamentos_PorBodega_user;		$salidaX .= "    <table border=\"0\" width=\"100%\" align=\"center\" class=\"modulo_table_list\">";		$salidaX .= "      <tr><td width=\"40%\" class=\"modulo_table_list_title\" align=\"center\"><b>DEPARTAMENTO</b></td>";		$salidaX .= "      <td class=\"modulo_list_claro\" align=\"center\"><b>".$descripcionDpto."</b></td></tr>";    $salidaX .= "		</table><BR>";				if($Datos)		{			$salidaX .= "			<form name=\"forma_dpto\" action=\"\" method=\"post\"> \n";			$salidaX .= "			<table width=\"100%\" border=\"0\" align=\"center\"> \n";			$i=0;			foreach($Datos as $paciente=>$vector)			{		  	$pacienteAnt=-1;      	foreach($vector as $solicitudId=>$vector1)				{			  	$solicitudIdAnt=-1;					foreach($vector1 as $consecutivoId=>$datos)					{						if($paciente!=$pacienteAnt)						{            	$pacienteAnt=$paciente;							$salidaX .= "			<tr><td colspan=\"2\">";							$salidaX .= "		  <table width=\"100%\" border=\"0\" align=\"center\"> \n";							if(!$ban)							{            		$salidaX .= "			<tr class=\"modulo_table_list_title\"><td colspan=\"2\" align=\"right\">SELECCIONAR TODOS&nbsp;&nbsp;&nbsp;<input type=\"checkbox\" name=\"SeleccionTodos\" onclick=\"SeleccionarTodos(this.form,this.checked)\"></td></tr>";								$ban=1;							}							$salidaX .= "			<tr class=\"modulo_table_list_title\">\n";							$salidaX .= "				<td width=\"80%\">PACIENTE</td>\n";							$salidaX .= "				<td width=\"20%\">PIEZA - CAMA</td>\n";							$salidaX .= "			</tr>";							$salidaX .= "			<tr class=\"modulo_list_claro\">";							$salidaX .= "				<td>$paciente ".$datos['nombrepac']."</td>\n";							$salidaX .= "			<td align=\"center\">".$datos['pieza']."&nbsp&nbsp&nbsp;".$datos['cama']."</td>\n";							$salidaX .= "			</tr>";							$salidaX .= "			</table>";							$salidaX .= "			</td></tr>";							if($solicitudId!=$solicitudIdAnt)							{								$solicitudIdAnt=$solicitudId;								$salidaX .= "			<tr><td colspan=\"2\">";								$salidaX .= "			<table width=\"100%\" border=\"0\" align=\"center\"> \n";								$salidaX .= "			<tr class=\"modulo_table_list_title\">";								$salidaX .= "			<td width=\"20%\">No. SOLICITUD</td>\n";								$salidaX .= "			<td width=\"30%\">FECHA</td>\n";								$salidaX .= "			<td width=\"30%\">ESTACION</td>\n";								$salidaX .= "			<td width=\"20%\">USUARIO</td>\n";								$salidaX .= "			</tr>";								$salidaX .= "			<tr class=\"modulo_list_claro\">";								$salidaX .= "			<td width=\"20%\">".$solicitudId."</td>\n";								$salidaX .= "			<td width=\"30%\">".$datos['fecha_solicitud']."</td>\n";								$cadenaestacion=substr($datos['estacion_id'].' - '.$datos['nomestacion'],0,31);								$salidaX .= "			<td width=\"30%\">".$cadenaestacion."</td>\n";								$cadenausuario=substr($datos['usuario_id'].' - '.$datos['usuarioestacion'],0,31);								$salidaX .= "			<td width=\"20%\">".$cadenausuario."</td>\n";								$salidaX .= "			</tr>";								$salidaX .= "			</table>";								$salidaX .= "			</td></tr>";								$salidaX .= "			<tr><td colspan=\"2\">";								$salidaX .= "			<table width=\"100%\" border=\"0\" align=\"center\"> \n";								$salidaX .= "			<tr class=\"modulo_table_list_title\">";								$salidaX .= "			<td align=\"center\" width=\"35%\">MEDICAMENTO</td>\n";								$salidaX .= "			<td align=\"center\" width=\"20%\">CANT EXISTENTE</td>\n";								$salidaX .= "			<td align=\"center\" width=\"20%\">CANT SOLICITADA</td>\n";								$salidaX .= "			<td align=\"center\" width=\"20%\">CANT A DESPACHAR</td>\n";								$salidaX .= "			<td width=\"5%\">&nbsp;</td>\n";								$salidaX .= "			</tr>";								$salidaX .= "			<tr class=\"modulo_list_claro\">";								if($datos['tipo_solicitud']!='I')								{									$MedSimilares = $objClass->GetMedicamentosSimilares($datos['codigo_producto'],$datos['cant_solicitada']);								}								else								{                	unset($MedSimilares);              	}								if(sizeof($MedSimilares)<2 || !$MedSimilares)								{									$salidaX .= "					<td align=\"center\">".$datos['codigo_producto']." => ".$datos['desmed']."</td>\n";									$salidaX .= "	<input type=\"hidden\" id=\"SelectMedicamentos$i\" value=\"\">";								}								else								{									$salidaX .= "					<td align=\"center\">\n";									$salidaX .= "						<select id=\"SelectMedicamentos$i\" name=\"SelectMedicamentos[".$i."]\" class=\"select\" onchange=\"xajax_GetMedicamentoSimil(xGetElementById('SelectMedicamentos$i').value,xGetElementById('CantSolicitada$i').value,'$i');\">\n";									for($j=0; $j<sizeof($MedSimilares); $j++)									{										if($MedSimilares[$j]['codigo_producto'] == $datos['codigo_producto'])										{ 											$selected = "selected"; 										} 										else										{											$selected = ""; 										}										$salidaX .= "						<option value=\"".$MedSimilares[$j]['codigo_producto']." => ".str_replace("'","",$MedSimilares[$j]['nommedicamento'])."\" $selected >".$MedSimilares[$j]['codigo_producto']." => ".$MedSimilares[$j]['nommedicamento']." ".$MedSimilares[$j]['concentracion']." ".$MedSimilares[$j]['ff']."</option> \n";									}									$salidaX .= "						</select>\n";									$salidaX .= "					</td>\n";								}								$cantidadExistente=$datos['existencia'];								$salidaX .= "			<td align=\"center\"><input type=\"text\" id=\"CantExistente$i\" name=\"CantExistente$i\" class=\"input-text\" value=\"".$cantidadExistente."\" size=\"10\" READONLY></td>\n";								$salidaX .= "			<td align=\"center\"><input type=\"hidden\" id=\"CantSolicitada$i\" name=\"CantSolicitada[]\" value=\"".$datos['cant_solicitada']."\">".$datos['cant_solicitada']."</td>\n";								if($datos['cant_solicitada'] <= $cantidadExistente)								{									$cantidad=$datos['cant_solicitada'];								}								else								{									if($cantidadExistente<0)									{										$cantidad=0;									}									else									{										$cantidad=$cantidadExistente;									}								}								$salidaX .= "			<td align=\"center\"><input type=\"text\" id=\"CantDespachar$i\" name=\"CantDespachar[]\" value=\"$cantidad\" size=\"10\" class=\"input-text\" onkeyup=\"ValidarCantidad('CantDespachar$i',xGetElementById('CantDespachar$i').value,xGetElementById('CantSolicitada$i').value);\" onkeypress=\"ValidarCantidad('CantDespachar$i',xGetElementById('CantDespachar$i').value,xGetElementById('CantSolicitada$i').value);\"></td>\n";								$salidaX .= "			<td align=\"right\"><input type=\"checkbox\" id=\"CheckDespachar$i\" name=\"CheckDespachar[]\" value=\"".$datos['solicitud_id'].".-.".$datos['codigo_producto'].".-.".$cantidad.".-.".$i.".-.".$datos['codigo_producto'].".-.".$datos['consecutivo_d'].".-.".$datos['tipo_solicitud'].".-.".$datos['usuario_id']."\"></td>\n";								$salidaX .= "			</tr>";								$salidaX .= "			</table>";								$salidaX .= "			</td></tr>";								$i++;							}							else							{								$salidaX .= "			<tr><td colspan=\"2\">";								$salidaX .= "			<table width=\"100%\" border=\"0\" align=\"center\" cellspacing=\"1\" cellpadding=\"1\"> \n";								$salidaX .= "			<tr class=\"modulo_list_claro\">";								if($datos['tipo_solicitud']!='I')								{									$MedSimilares = $objClass->GetMedicamentosSimilares($datos['codigo_producto'],$datos['cant_solicitada']);								}								else								{									unset($MedSimilares);								}								if(sizeof($MedSimilares)<2 || !$MedSimilares)								{									$salidaX .= "					<td align=\"center\" width=\"35%\">".$datos['codigo_producto']." => ".$datos['desmed']."</td>\n";									$salidaX .= "	<input type=\"hidden\" id=\"SelectMedicamentos$i\" value=\"\">";								}								else								{									$salidaX .= "					<td align=\"center\" width=\"35%\">\n";									$salidaX .= "						<select id=\"SelectMedicamentos$i\" name=\"SelectMedicamentos[".$i."]\" class=\"select\" onchange=\"xajax_GetMedicamentoSimil(xGetElementById('SelectMedicamentos$i').value,xGetElementById('CantSolicitada$i').value,'$i');\">\n";									for($j=0; $j<sizeof($MedSimilares); $j++)									{										if($MedSimilares[$j]['codigo_producto'] == $datos['codigo_producto'])										{ 											$selected = "selected"; 										}										else										{											$selected = ""; 										}										$salidaX .= "						<option value=\"".$MedSimilares[$j]['codigo_producto']." => ".str_replace("'","",$MedSimilares[$j]['nommedicamento'])."\" $selected >".$MedSimilares[$j]['codigo_producto']." => ".$MedSimilares[$j]['nommedicamento']." ".$MedSimilares[$j]['concentracion']." ".$MedSimilares[$j]['ff']."</option> \n";									}									$salidaX .= "						</select>\n";									$salidaX .= "					</td>\n";								}								$cantidadExistente=$datos['existencia'];								$salidaX .= "			<td align=\"center\" width=\"20%\"><input type=\"text\" id=\"CantExistente$i\" name=\"CantExistente$i\" class=\"input-text\" value=\"".$cantidadExistente."\" size=\"10\" READONLY></td>\n";								$salidaX .= "			<td align=\"center\" width=\"20%\"><input type=\"hidden\" id=\"CantSolicitada$i\" name=\"CantSolicitada[]\" value=\"".$datos['cant_solicitada']."\">".$datos['cant_solicitada']."</td>\n";								if($datos['cant_solicitada'] <= $cantidadExistente)								{									$cantidad=$datos['cant_solicitada'];								}								else								{									if($cantidadExistente<0)									{										$cantidad=0;									}									else									{										$cantidad=$cantidadExistente;									}								}								$salidaX .= "			<td align=\"center\" width=\"20%\"><input type=\"text\" id=\"CantDespachar$i\" name=\"CantDespachar[]\" value=\"$cantidad\" size=\"10\" class=\"input-text\" onkeyup=\"ValidarCantidad('CantDespachar$i',xGetElementById('CantDespachar$i').value,xGetElementById('CantSolicitada$i').value);\" onkeypress=\"ValidarCantidad('CantDespachar$i',xGetElementById('CantDespachar$i').value,xGetElementById('CantSolicitada$i').value);\"></td>\n";								$salidaX .= "			<td align=\"right\" width=\"5%\"><input type=\"checkbox\" id=\"CheckDespachar$i\" name=\"CheckDespachar[]\" value=\"".$datos['solicitud_id'].".-.".$datos['codigo_producto'].".-.".$cantidad.".-.".$i.".-.".$datos['codigo_producto'].".-.".$datos['consecutivo_d'].".-.".$datos['tipo_solicitud'].".-.".$datos['usuario_id']."\" ></td>\n";								$salidaX .= "			</tr>";								$salidaX .= "			</table>";								$salidaX .= "			</td></tr>";								$i++;							}						}						else						{							if($solicitudId!=$solicitudIdAnt)							{						  	$solicitudIdAnt=$solicitudId;								$salidaX .= "			<tr><td colspan=\"2\">";								$salidaX .= "			<table width=\"100%\" border=\"0\" align=\"center\"> \n";								$salidaX .= "			<tr class=\"modulo_table_list_title\">";								$salidaX .= "			<td width=\"20%\">No. SOLICITUD</td>\n";								$salidaX .= "			<td width=\"30%\">FECHA</td>\n";								$salidaX .= "			<td width=\"30%\">ESTACION</td>\n";								$salidaX .= "			<td width=\"20%\">USUARIO</td>\n";								$salidaX .= "			</tr>";								$salidaX .= "			<tr class=\"modulo_list_claro\">";								$salidaX .= "			<td width=\"20%\">".$solicitudId."</td>\n";								$salidaX .= "			<td width=\"30%\">".$datos['fecha_solicitud']."</td>\n";								$cadenaestacion=substr($datos['estacion_id'].' - '.$datos['nomestacion'],0,31);								$salidaX .= "			<td width=\"30%\">".$cadenaestacion."</td>\n";								$cadenausuario=substr($datos['usuario_id'].' - '.$datos['usuarioestacion'],0,31);								$salidaX .= "			<td width=\"20%\">".$cadenausuario."</td>\n";								$salidaX .= "			</tr>";								$salidaX .= "			</table>";								$salidaX .= "			</td></tr>";								$salidaX .= "			<tr><td colspan=\"2\">";								$salidaX .= "			<table width=\"100%\" border=\"0\" align=\"center\"> \n";								$salidaX .= "			<tr class=\"modulo_table_list_title\">";								$salidaX .= "			<td align=\"center\" width=\"35%\">MEDICAMENTO</td>\n";								$salidaX .= "			<td align=\"center\" width=\"20%\">CANT EXISTENTE</td>\n";								$salidaX .= "			<td align=\"center\" width=\"20%\">CANT SOLICITADA</td>\n";								$salidaX .= "			<td align=\"center\" width=\"20%\">CANT A DESPACHAR</td>\n";								$salidaX .= "			<td width=\"5%\">&nbsp;</td>\n";								$salidaX .= "			</tr>";								$salidaX .= "			<tr class=\"modulo_list_claro\">";																if($datos['tipo_solicitud']!='I')								{									$MedSimilares = $objClass->GetMedicamentosSimilares($datos['codigo_producto'],$datos['cant_solicitada']);								}								else								{									unset($MedSimilares);								}																if(sizeof($MedSimilares)<2 || !$MedSimilares)								{									$salidaX .= "					<td align=\"center\">".$datos['codigo_producto']." => ".$datos['desmed']."</td>\n";									$salidaX .= "	<input type=\"hidden\" id=\"SelectMedicamentos$i\" value=\"\">";								}								else								{									$salidaX .= "					<td align=\"center\">\n";									$salidaX .= "						<select id=\"SelectMedicamentos$i\" name=\"SelectMedicamentos[".$i."]\" class=\"select\" onchange=\"xajax_GetMedicamentoSimil(xGetElementById('SelectMedicamentos$i').value,xGetElementById('CantSolicitada$i').value,'$i');\">\n";									for($j=0; $j<sizeof($MedSimilares); $j++)									{										if($MedSimilares[$j]['codigo_producto'] == $datos['codigo_producto'])										{ 											$selected = "selected"; 										} 										else										{											$selected = ""; 										}										$salidaX .= "						<option value=\"".$MedSimilares[$j]['codigo_producto']." => ".str_replace("'","",$MedSimilares[$j]['nommedicamento'])."\" $selected >".$MedSimilares[$j]['codigo_producto']." => ".$MedSimilares[$j]['nommedicamento']." ".$MedSimilares[$j]['concentracion']." ".$MedSimilares[$j]['ff']."</option> \n";									}									$salidaX .= "						</select>\n";									$salidaX .= "					</td>\n";								}								$cantidadExistente=$datos['existencia'];								$salidaX .= "			<td align=\"center\"><input type=\"text\" id=\"CantExistente$i\" name=\"CantExistente$i\" class=\"input-text\" value=\"".$cantidadExistente."\" size=\"10\" READONLY></td>\n";								$salidaX .= "			<td align=\"center\"><input type=\"hidden\" id=\"CantSolicitada$i\" name=\"CantSolicitada[]\" value=\"".$datos['cant_solicitada']."\">".$datos['cant_solicitada']."</td>\n";								if($datos['cant_solicitada'] <= $cantidadExistente)								{									$cantidad=$datos['cant_solicitada'];								}								else								{									if($cantidadExistente<0)									{										$cantidad=0;									}									else									{										$cantidad=$cantidadExistente;									}								}								$salidaX .= "			<td align=\"center\"><input type=\"text\" id=\"CantDespachar$i\" name=\"CantDespachar[]\" value=\"$cantidad\" size=\"10\" class=\"input-text\" onkeyup=\"ValidarCantidad('CantDespachar$i',xGetElementById('CantDespachar$i').value,'$cantidad');\" onkeypress=\"ValidarCantidad('CantDespachar$i',xGetElementById('CantDespachar$i').value,xGetElementById('CantSolicitada$i').value);\"></td>\n";								$salidaX .= "			<td align=\"right\"><input type=\"checkbox\" id=\"CheckDespachar$i\" name=\"CheckDespachar[]\" value=\"".$datos['solicitud_id'].".-.".$datos['codigo_producto'].".-.".$cantidad.".-.".$i.".-.".$datos['codigo_producto'].".-.".$datos['consecutivo_d'].".-.".$datos['tipo_solicitud'].".-.".$datos['usuario_id']."\" ></td>\n";								$salidaX .= "			</tr>";								$salidaX .= "			</table>";								$salidaX .= "			</td></tr>";								$i++;							}							else							{								$salidaX .= "			<tr><td colspan=\"2\">";								$salidaX .= "			<table width=\"100%\" border=\"0\" align=\"center\"> \n";								$salidaX .= "			<tr class=\"modulo_list_claro\">";																if($datos['tipo_solicitud']!='I')								{									$MedSimilares = $objClass->GetMedicamentosSimilares($datos['codigo_producto'],$datos['cant_solicitada']);								}								else								{									unset($MedSimilares);								}																if(sizeof($MedSimilares)<2 || !$MedSimilares)								{									$salidaX .= "					<td align=\"center\" width=\"35%\">".$datos['codigo_producto']." => ".$datos['desmed']."</td>\n";									$salidaX .= "	<input type=\"hidden\" id=\"SelectMedicamentos$i\" value=\"\">";								}								else								{									$salidaX .= "					<td align=\"center\" width=\"35%\">\n";									$salidaX .= "						<select id=\"SelectMedicamentos$i\" name=\"SelectMedicamentos[".$i."]\" class=\"select\" onchange=\"xajax_GetMedicamentoSimil(xGetElementById('SelectMedicamentos$i').value,xGetElementById('CantSolicitada$i').value,'$i');\">\n";									for($j=0; $j<sizeof($MedSimilares); $j++)									{										if($MedSimilares[$j]['codigo_producto'] == $datos['codigo_producto'])										{ 											$selected = "selected"; 										}										else										{											$selected = ""; 										}										$salidaX .= "						<option value=\"".$MedSimilares[$j]['codigo_producto']." => ".str_replace("'","",$MedSimilares[$j]['nommedicamento'])."\" $selected >".$MedSimilares[$j]['codigo_producto']." => ".$MedSimilares[$j]['nommedicamento']." ".$MedSimilares[$j]['concentracion']." ".$MedSimilares[$j]['ff']."</option> \n";									}									$salidaX .= "						</select>\n";									$salidaX .= "					</td>\n";								}								$cantidadExistente=$datos['existencia'];								$salidaX .= "			<td align=\"center\" width=\"20%\"><input type=\"text\" id=\"CantExistente$i\" name=\"CantExistente$i\" class=\"input-text\" value=\"".$cantidadExistente."\" size=\"10\" READONLY></td>\n";								$salidaX .= "			<td align=\"center\" width=\"20%\"><input type=\"hidden\" id=\"CantSolicitada$i\" name=\"CantSolicitada[]\" value=\"".$datos['cant_solicitada']."\">".$datos['cant_solicitada']."</td>\n";								if($datos['cant_solicitada'] <= $cantidadExistente)								{									$cantidad=$datos['cant_solicitada'];								}								else								{									if($cantidadExistente<0)									{										$cantidad=0;									}									else									{										$cantidad=$cantidadExistente;									}								}								$salidaX .= "			<td align=\"center\" width=\"20%\"><input type=\"text\" id=\"CantDespachar$i\"  name=\"CantDespachar[]\" value=\"$cantidad\" size=\"10\" class=\"input-text\" onkeyup=\"ValidarCantidad('CantDespachar$i',xGetElementById('CantDespachar$i').value,xGetElementById('CantSolicitada$i').value);\" onkeypress=\"ValidarCantidad('CantDespachar$i',xGetElementById('CantDespachar$i').value,xGetElementById('CantSolicitada$i').value);\"></td>\n";								$salidaX .= "			<td align=\"right\" width=\"5%\"><input type=\"checkbox\" id=\"CheckDespachar$i\"  name=\"CheckDespachar[]\" value=\"".$datos['solicitud_id'].".-.".$datos['codigo_producto'].".-.".$cantidad.".-.".$i.".-.".$datos['codigo_producto'].".-.".$datos['consecutivo_d'].".-.".$datos['tipo_solicitud'].".-.".$datos['usuario_id']."\" ></td>\n";								$salidaX .= "			</tr>";								$salidaX .= "			</table>";								$salidaX .= "			</td></tr>";								$i++;							}						}					}				}			}			$contadorJs=$i;			$salidaX .= "			</table>";			$salidaX .= "			<table width=\"100%\" border=\"0\" align=\"center\"> \n";			$salidaX .= "			<tr>";			$salidaX .= "				<td align=\"right\"><input type=\"button\" name=\"Despachar\" value=\"DESPACHAR\" class=\"input-submit\" onclick=\"DespacharDptoNC('$contadorJs','$departamento','$descripcionDpto','$concepto');\"></td>\n";			$salidaX .= "			</tr>";			$salidaX .= "			</table>";			$salidaX .= "			</form> \n";    }		else		{      $salidaX .= "			<table width=\"90%\" border=\"0\" align=\"center\"> \n";			$salidaX .= "			<tr>";			$salidaX .= "			<td align=\"center\" class=\"label_error\">NO SE ENCONTRARON DATOS</td>\n";			$salidaX .= "			</tr>";			$salidaX .= "			</table>";		}				return $salidaX;	}		function DespacharDptoSC_HTML($CheckDespachar,$departamento,$descripcionDpto,$concepto)	{		$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				$salidaX .= "	<table border=\"0\" width=\"60%\" align=\"center\" class=\"modulo_table_list\">";		$salidaX .= "		<tr><td width=\"40%\" class=\"modulo_table_list_title\" align=\"center\"><b>DEPARTAMENTO</b></td>";		$salidaX .= "    <td class=\"modulo_list_claro\" align=\"center\"><b>".$descripcionDpto."</b></td></tr>";    $salidaX .= "	</table><BR>";		$numElement=0;		$CheckDespachar1="new Array(";		$b=true;				foreach($CheckDespachar as $key=>$valor)		{			$b? $CheckDespachar1.="'".$valor."'":$CheckDespachar1.=",'".$valor."'";			$b=false;		}		$CheckDespachar1.=")";					for($i=0; $i<sizeof($CheckDespachar); $i++)		{			$y= explode(".-.",$CheckDespachar[$i]);						$temp = array();			if(array_key_exists($y[3], $SelectMedicamentos))			{				if(strcmp($y[1],$SelectMedicamentos[$y[3]]) != 0)				{					$temp = $y;					$temp[1] = $SelectMedicamentos[$y[3]];					$datos[$y[0]][] = $temp;				}				else				{					$datos[$y[0]][] = $y;				}			}			else			{				$datos[$y[0]][] = $y;			}		}				foreach($datos as $SolicitudId=>$vector)		{			foreach($vector as $indice=>$Datos)			{				$vars=$objClass->ConfirmacionDespachoDetalleSolicitud($SolicitudId,$Datos[6]);				for($i=0;$i<sizeof($vars);$i++)				{					if($Datos[1]==$vars[$i]['codigo_producto'])					{						$Cantidad[$SolicitudId][$Datos[1]]=$Datos[8];					}				}			}		}		    if($datos)		{			$l=0;			foreach($datos as $SolicitudId=>$vector)			{				foreach($vector as $indice=>$Datos)				{			  	if($SolicitudIdAnt!=$SolicitudId)					{						$vars=$objClass->ConfirmacionDespachoDetalleSolicitud($SolicitudId,$Datos[6]);						if($vars)						{							$salidaX .= "			<table width=\"100%\" class=\"modulo_table_list\" border=\"0\" align=\"center\" cellspacing=\"2\" cellpadding=\"2\"> \n";							$salidaX .= "				<tr class=\"modulo_table_list_title\">\n";							$salidaX .= "					<td colspan=\"8\">SOLICITUD No.:&nbsp&nbsp&nbsp;$SolicitudId</td>\n";							$salidaX .= "				</tr>\n";							$salidaX .= "				<tr class=\"modulo_table_list_title\">\n";							$salidaX .= "					<td width=\"30%\" nowrap>MEDICAMENTO/INSUMO</td>\n";							$salidaX .= "					<td width=\"8%\" nowrap>CANT <BR> SOLICITADA</td>\n";							$salidaX .= "					<td width=\"8%\" nowrap>CANT A<BR> DESPACHAR</td>\n";							$salidaX .= "					<td width=\"8%\" nowrap>CANT <BR> PENDIENTE</td>\n";							$salidaX .= "					<td width=\"8%\" nowrap>DEJAR <BR> PENDIENTE</td>\n";							$salidaX .= "					<td width=\"8%\" nowrap>CANCELAR</td>\n";							$salidaX .= "					<td width=\"15%\" nowrap>MOTIVO<br>CANCELACION</td>\n";							$salidaX .= "					<td width=\"15%\" nowrap>OBSERVACIONES</td>\n";							$salidaX .= "				</tr>\n";							for($i=0;$i<sizeof($vars);$i++)							{								$che='';								$che1='';								$d='';								if($Datos[9]==" => ")									$Datos[9]="";																	if($Datos[9])								{									list($cod_pro,$nombre_pro)=explode(" => ",$Datos[9]);								}																if(array_key_exists($vars[$i]['codigo_producto'],$cancelar))								{									$che='checked';									$che1='';								}								else								{									$d='disabled';									$che='';									$che1='checked';								}								$continue=1;								if($y % 2)								{									$estilo='modulo_list_claro';								}								else								{									$estilo='modulo_list_oscuro';								}								$salidaX .= "        <tr class=\"$estilo\">";								$cantidadDespachar=0;								$salidaX .= "				<td>";								$salidaX .= "	".$vars[$i]['codigo_producto']." => ".$vars[$i]['descripcion']."";								if($Datos[9])								{									$salidaX .= "				<BR><b>Equivalente:</b>&nbsp&nbsp&nbsp;<label class=\"label_error\">".$Datos[9]."</label>";								}								$salidaX .= "				</td>\n";								$salidaX .= "				<td>".$vars[$i]['cantidad']."</td>\n";								$salidaX .= "				<td>".$Cantidad[$SolicitudId][$vars[$i]['codigo_producto']]."</td>\n";								$Cantpendiente=$vars[$i]['cantidad']-$Cantidad[$SolicitudId][$vars[$i]['codigo_producto']];								$salidaX .= "				<td>".$Cantpendiente."</td>\n";								if($Cantpendiente>0)								{									$salidaX .= "				<td align=\"center\"><input type=\"radio\" id=\"pendiente$l\" name=\"decision$l\" value=\"".$SolicitudId."||//".$vars[$i]['codigo_producto']."||//".$Cantpendiente."||//".$vars[$i]['evolucion_id']."||//".$Datos[7]."||//".$cod_pro."\" onclick=\"xGetElementById('motivo_can$l').disabled=true;xGetElementById('observaciones$l').disabled=true;xGetElementById('motivo_can$l').value='';xGetElementById('observaciones$l').value='';\" checked></td>\n";									$numElement++;									$salidaX .= "				<td align=\"center\"><input type=\"radio\" id=\"cancelar$l\" name=\"decision$l\" value=\"".$SolicitudId."||//".$vars[$i]['codigo_producto']."||//".$Cantpendiente."||//".$vars[$i]['evolucion_id']."||//".$Datos[7]."||//".$cod_pro."\" onclick=\"xGetElementById('motivo_can$l').disabled=false;xGetElementById('observaciones$l').disabled=false;\"></td>\n";									$numElement++;									$salidaX .= "       <td><select $d id=\"motivo_can$l\" name=\"motivoCancelacion[".$SolicitudId."||//".$vars[$i]['codigo_producto']."]\" class=\"select\">";									$motivos=$objClass->MotivosCancelacionDespacho();									$motivoCancelacionU='';									if($motivoCancelacion[$cod_pro]!=-1)									{										$motivoCancelacionU=$motivoCancelacion[$cod_pro];									}									$salidaX .=" <option value=\"-1\">---Seleccione---</option>";									for($cont=0;$cont<sizeof($motivos);$cont++)									{										if($motivos[$cont]['motivo_id']==$motivoCancelacionU)										{											$salidaX .=" <option value=\"".$motivos[$cont]['motivo_id']."\" selected>".substr($motivos[$cont]['descripcion'], 0, 30)."</option>";										}									else										{											$salidaX .=" <option value=\"".$motivos[$cont]['motivo_id']."\">".substr($motivos[$cont]['descripcion'], 0, 30)."</option>";										}									}									$salidaX .= "      </select></td>";									$numElement++;									$val='';									if(!empty($observaciones[$cod_pro]))									{										$val=$observaciones[$cod_pro];									}									$salidaX .= "			<td><textarea $d rows=\"2\" cols=\"10\" id=\"observaciones$l\" name=\"observaciones[".$SolicitudId."||//".$vars[$i]['codigo_producto']."]\" class=\"'textarea\">$val</textarea></td>\n";									$numElement++;								}								else								{									$salidaX .= "				<td align=\"center\">&nbsp;</td>\n";									$salidaX .= "				<td align=\"center\">&nbsp;</td>\n";									$salidaX .= "				<td align=\"center\">&nbsp;</td>\n";									$salidaX .= "				<td align=\"center\">&nbsp;</td>\n";																		$salidaX .= "				<input type=\"hidden\" id=\"pendiente$l\" value=\"\">\n";									$salidaX .= "				<input type=\"hidden\" id=\"cancelar$l\" value=\"\">\n";									$salidaX .= "				<input type=\"hidden\" id=\"motivo_can$l\" value=\"\">\n";									$salidaX .= "				<input type=\"hidden\" id=\"observaciones$l\" value=\"\">\n";								}								$l++;							}							$salidaX .= "			</table><BR>";						}						$SolicitudIdAnt=$SolicitudId;					}				}			}			$salidaX .= "			<table width=\"100%\" border=\"0\" align=\"center\" cellspacing=\"2\" cellpadding=\"2\"> \n";			$salidaX .= "			<tr><td align=\"right\"><input type=\"button\" name=\"Confirmar\" value=\"CONFIRMAR\" class=\"input-submit\" onclick=\"ConfirmacionDespachoDpto($CheckDespachar1,'$departamento','$descripcionDpto','$concepto','$l');\"></td></tr>";			$salidaX .= "			</table>";						$salidaX .= "			<br><center><input type=\"button\" name=\"volver\" value=\"VOLVER\" class=\"input-submit\" onclick=\"javascript:Iniciar();MostrarSpan('d2Container');DespachoDpto('$departamento','$descripcionDpto');\"></center>";		}		return $salidaX;	}			function DevolucionDpto_HTML($ProductosTotalDevolucion,$departamento,$descripcionDpto,$concepto)	{		$objClass=new app_Solicitud_Medicamentos_PorBodega_user;				$salidaX .= "	<table border=\"0\" width=\"100%\" align=\"center\" class=\"modulo_table_list\">";		$salidaX .= "		<tr><td width=\"40%\" class=\"modulo_table_list_title\" align=\"center\"><b>DEPARTAMENTO</b></td>";		$salidaX .= "		<td class=\"modulo_list_claro\" align=\"center\"><b>".$descripcionDpto."</b></td></tr>";    $salidaX .= "	</table><br>";		    if($ProductosTotalDevolucion)		{			$salidaX .= "			<table width=\"100%\" class=\"modulo_table_list\" border=\"0\" align=\"center\" cellspacing=\"2\" cellpadding=\"2\"> \n";			$salidaX .= "				<tr class=\"modulo_table_list_title\">\n";			$salidaX .= "					<td>PRODUCTO</td>\n";			$salidaX .= "					<td nowrap width=\"10%\">CANTIDAD DEVOLUCION</td>\n";			$salidaX .= "					<td nowrap width=\"5%\">LOTES</td>\n";			$salidaX .= "			    <td nowrap width=\"13%\">FECHA VENCIMIENTO</td>";			$salidaX .= "			    <td nowrap width=\"13%\">LOTE</td>";			$salidaX .= "			    <td nowrap width=\"14%\">CANTIDAD LOTE</td>";			$salidaX .= "			    <td nowrap width=\"5%\">&nbsp;</td>";			$salidaX .= "				</tr>";			$i=0;			foreach($ProductosTotalDevolucion as $CodigoPro=>$valorX)			{      	$cantidadT=0;				foreach($valorX as $key1=>$valorY)				{					$cantidadT=$cantidadT+$valorY['cantidad'];				}								if($y % 2)				{					$estilo='modulo_list_claro';					$estilo1='modulo_list_oscuro';				}				else				{					$estilo='modulo_list_oscuro';					$estilo1='modulo_list_claro';				}				$salidaX .= "       <tr class=\"$estilo\">";				$salidaX .= "				<td>".$CodigoPro." => ".$valorX[$key1]['descripcion']."</td>\n";				$entero=(int)($cantidadT);				if($cantidadT%$entero)				{					$salidaX .= "				<td>".FormatoValor($cantidadT)."</td>\n";				}				else				{        	$salidaX .= "				<td>".$entero."</td>\n";				}								$Datos=$objClass->FechasLotesProductosDevolDpto($departamento,$CodigoPro);							if($valorX[$key1]['sw_control_fecha_vencimiento']=='1')				{					$style="style=\"display:block\"";				}				else				{					$style="style=\"display:none\"";				}				$salidaX .= "     <td align=\"center\"><table width=\"100%\" $style id=\"InsLoteD$i\" border=\"0\" cellpadding=\"0\" cellspancing=\"0\" align=\"center\"><tr><td align=\"center\" width=\"100%\"><a href=\"javascript:MostrarLotesPtosDevols('$EstacionId','$NombreEstacion','$Documento','$Ingreso','$observaciones','".$CodigoPro."','".$valorX[$key1]['descripcion']."','".$cantidadT."','".$valorX[$key1]['consecutivo']."','".$tipo_id_paciente."','".$paciente_id."','".$nombrepac."','".$cama."','".$pieza."','".$parametro."','".$departamento."','$Fecha','$usuarioestacion','$descripcionDpto','2');\"><img border=\"0\" src=\"".GetThemePath()."/images/pparamed.png\"></a></td></tr></table></td>";				if($Datos)				{					$salidaX .= "     <td align=\"center\" colspan=\"3\">";					$salidaX .= "	     <table cellspacing=\"2\"  cellpadding=\"3\"border=\"0\" width=\"99%\" align=\"center\">";					for($j=0;$j<sizeof($Datos);$j++)					{						$salidaX .= "	      <tr class=\"$estilo1\" id=\"ElimLoteD$i$j\" >\n";						$salidaX .= "	      <td width=\"32%\">".$Datos[$j]['fecha_vencimiento']."</td>";						$salidaX .= "	      <td width=\"35%\">".$Datos[$j]['lote']."</td>";          	$entero=(int)($Datos[$j]['cantidad']);						if($Datos[$j]['cantidad']%$entero)						{							$salidaX .= "	      <td>".$Datos[$j]['cantidad']."</td>";						}						else						{							$salidaX .= "				<td>".$entero."</td>\n";						}						$salidaX .= "	      <td width=\"5%\"><a href=\"javascript:FuncionEliminar('".$Datos[$j]['fecha_vencimiento']."','".$Datos[$j]['lote']."','".$Datos[$j]['cantidad']."','".$Datos[$j]['consecutivo']."','".$Datos[$j]['codigo_producto']."','InsLoteD$i','ElimLoteD$i$j');\"><img border=\"0\" src=\"".GetThemePath()."/images/elimina.png\"></a></td>";						$salidaX .= "	      </tr>";						$totalCan+=$Datos[$j]['cantidad'];					}					$salidaX .= "	     </table>";					$salidaX .= "</td>";				}				else				{			  	$salidaX .= "				<td colspan=\"3\"></td>\n";				}				$salidaX .= "				<td align=\"center\"><input type=\"checkbox\" id=\"checkboxDevol$i\" name=\"checkboxDevol[]\" value=\"".$CodigoPro."||//".$cantidadT."||//".$totalCan."\"></td>\n";				$salidaX .= "				</tr>";				$i++;			}			$salidaX .= "			</table>";			$salidaX .= "    <table border=\"0\" width=\"100%\" align=\"center\">";			$salidaX .= "    <tr><td align=\"right\"><b><input class=\"input-submit\" type=\"button\" name=\"Confirmar\" value=\"CONFIRMAR\" onclick=\"ConfirmarDevolucionDptoSI('$departamento','$concepto','$i');\"></b></td></tr>";			$salidaX .= "		</table><BR>";		}		return $salidaX;	}?>