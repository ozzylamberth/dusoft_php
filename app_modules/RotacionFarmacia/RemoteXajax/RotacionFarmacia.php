<?php/** * Archivo Xajax * Tiene como responsabilidad hacer el manejo de las funciones * que son invocadas por medio de xajax * * @package IPSOFT-SIIS * @version 1.0 $ * @copyright (C) 2009 IPSOFT - SA (www.ipsoft-sa.com) * @author Sandra Viviana Pantoja Torres  */IncludeClass("ClaseHTML");IncludeClass("ClaseUtil");/** * Funcion que permite mostrar los laboratorios * @param array  $form vector con toda la forma * @return Object $objResponse objeto de respuesta al formulario   */function MostrarBodegas($form) {    $objResponse = new xajaxResponse();    $sel = AutoCarga::factory("RotacionFarmaciaSQL", "classes", "app", "RotacionFarmacia");    $bodegas_D = $sel->Consultar_Bodegas_Destino($form['destino']);    $html = "document.formabodega.bodega_destino.options.length = 0;\n";    $html .= "document.formabodega.bodega_destino.options[0] = new Option('--SELECCIONAR--','-1',false, false);\n";    $i = 1;    foreach ($bodegas_D as $key => $dtl) {        $html .= "document.formabodega.bodega_destino.options[" . ($i++) . "] = new Option('" . $dtl['descripcion'] . "','" . $dtl['bodega'] . "',false, false);\n";    }    $objResponse->script($html);    return $objResponse;}function buscar_famacia($empresa_id, $farmacia_id) {    $objResponse = new xajaxResponse();    $sql = AutoCarga::factory("RotacionFarmaciaSQL", "classes", "app", "RotacionFarmacia");    $datos = $sql->buscar_farmacia($empresa_id, $farmacia_id);    $objResponse->assign("nombre_farmacia", "innerHTML", $datos['descripcion']);    return $objResponse;}function rotacion_producto($periodos_tiempo, $zona_id, $proyeccion, $codigo_producto) {    $objResponse = new xajaxResponse();    $sql = AutoCarga::factory("RotacionFarmaciaSQL", "classes", "app", "RotacionFarmacia");    $i = 1;    foreach ($periodos_tiempo as $key => $value) {        $datos[] = $sql->rotacion_producto($value[0], $value[1], $zona_id, $i, $codigo_producto);        $i++;    }    $cantidad_periodos = count($datos);    $resultado = array();    foreach ($datos as $key => $value) {        foreach ($value as $indice => $detalle) {            $resultado[$detalle['bodega']]['farmacia'] = $detalle['farmacia'];            $resultado[$detalle['bodega']]['codigo_producto'] = $detalle['codigo_producto'];            $resultado[$detalle['bodega']]['descripcion_producto'] = $detalle['descripcion_producto'];            $resultado[$detalle['bodega']]['stock_farmacia'] = $detalle['stock_farmacia'];            $resultado[$detalle['bodega']]['stock_bodega'] = $detalle['stock_bodega'];            $resultado[$detalle['bodega']]['ubicacion_producto'] = $detalle['ubicacion_producto'];            for ($i = 1; $i <= $cantidad_periodos; $i++) {                if ((!array_key_exists($i, $resultado[$detalle['bodega']]['cantidad_total_despachada'])) || ($resultado[$detalle['bodega']]['cantidad_total_despachada'][$i] == " - ")) {                    if ($i == $detalle['periodo_tiempo']) {                        $resultado[$detalle['bodega']]['cantidad_total_despachada'][$i] = $detalle['cantidad_total_despachada'];                    } else {                        $resultado[$detalle['bodega']]['cantidad_total_despachada'][$i] = " - ";                    }                }            }        }    }    //var_dump($resultado);    //exit();    $html .= " <table width=\"100%\" class=\"modulo_table_list\" border=\"0\"  align=\"center\">";    $html .= "	<tr  align=\"center\" class=\"formulacion_table_list\" >\n";    $html .= "      <td  width=\"5%\">CODIGO PRODUCTO</td>\n";    $html .= "      <td  width=\"15%\">DESCRIPCION PRODUCTO</td>\n";    //$html .= "      <td  width=\"5%\">UBICACION</td>\n";    $html .= "      <td  width=\"5%\">STOCK BODEGA</td>\n";    $html .= "      <td  width=\"5%\">STOCK FARMACIA</td>\n";    foreach ($periodos_tiempo as $key => $value) {        $html .= "  <td  width=\"3%\">{$value[2]}</td>\n";    }    $html .= "      <td  width=\"3%\">PROYECCION</td>\n";    $html .= "      <td  width=\"15%\">FARMACIA</td>\n";    $html .= "  </tr>\n";    if (!empty($resultado)) {        foreach ($resultado as $key => $value) {            $estilo = ($estilo == 'modulo_list_oscuro') ? 'modulo_list_claro' : 'modulo_list_oscuro';            $html .= "	<tr class='{$estilo}' >\n";            $html .= "      <td align='left'>{$value['codigo_producto']}</td>\n";            $html .= "      <td align='left'>{$value['descripcion_producto']}</td>\n";            //$html .= "      <td align='left'>{$value['ubicacion_producto']}</td>\n";            $html .= "      <td align='center'>{$value['stock_bodega']}</td>\n";            $html .= "      <td align='center'>{$value['stock_farmacia']}</td>\n";            $calcular_proyeccion = 0;            for ($i = 1; $i <= count($value['cantidad_total_despachada']); $i++) {                $calcular_proyeccion += $value['cantidad_total_despachada'][$i];                $html .= "  <td  align='center'>{$value['cantidad_total_despachada'][$i]}</td>\n";            }            $calcular_proyeccion = ($calcular_proyeccion / $proyeccion);            $html .= "      <td align='center'>" . round($calcular_proyeccion, 2) . "</td>\n";            $html .= "      <td align='left'>{$value['farmacia']}</td>\n";            $html .= "  </tr>\n";        }        $objResponse->assign('error', 'innerHTML', '');    } else {        $objResponse->assign('error', 'innerHTML', 'NO HAY DATOS REGISTRADOS');    }    $html .= "</table>\n";    $objResponse->assign('resultado_rotacion', 'innerHTML', $html);    return $objResponse;}function rotacion_general_farmacias($farmacia_id, $fecha_inicial, $fecha_final) {    $objResponse = new xajaxResponse();    $sql = AutoCarga::factory("RotacionFarmaciaSQL", "classes", "app", "RotacionFarmacia");        $datos = $sql->rotacion_general_farmacias($farmacia_id, $fecha_inicial, $fecha_final);    $html .= " <table width=\"100%\" class=\"modulo_table_list\" border=\"0\"  align=\"center\">";    $html .= "	<tr  align=\"center\" class=\"formulacion_table_list\" >\n";    $html .= "      <td  width=\"5%\">CODIGO PRODUCTO</td>\n";    $html .= "      <td  width=\"25%\">DESCRIPCION PRODUCTO</td>\n";    $html .= "      <td  width=\"5%\">MOLECULA</td>\n";    $html .= "      <td  width=\"5%\">LABORATORIO</td>\n";        $html .= "      <td  width=\"3%\">TIPO PRODUCTO</td>\n";    $html .= "      <td  width=\"3%\">SALIDAS</td>\n";    $html .= "  </tr>\n";    if (!empty($datos)) {        foreach ($datos as $key => $value) {            $estilo = ($estilo == 'modulo_list_oscuro') ? 'modulo_list_claro' : 'modulo_list_oscuro';            $html .= "	<tr class='{$estilo}' >\n";            $html .= "      <td align='left'>{$value['codigo_producto']}</td>\n";            $html .= "      <td align='left'>{$value['descripcion_producto']}</td>\n";            $html .= "      <td align='center'>{$value['molecula']}</td>\n";            $html .= "      <td align='center'>{$value['laboratorio']}</td>\n";                      $html .= "      <td align='left'>{$value['tipo_producto']}</td>\n";            $html .= "      <td align='left'>{$value['cantidad_total_despachada']}</td>\n";            $html .= "  </tr>\n";        }        $objResponse->assign('error', 'innerHTML', '');    } else {        $objResponse->assign('error', 'innerHTML', 'NO HAY DATOS REGISTRADOS');    }    $html .= "</table>\n";    $objResponse->assign('resultado_rotacion', 'innerHTML', $html);    return $objResponse;}?>