<?php  /**  * @package IPSOFT-SIIS  * @version $Id: BuscadorDiagnosticosI.class.php,v 1.1 2008/12/12 22:22:55 hugo Exp $  * @copyright (C) 2005 IPSOFT - SA (www.ipsoft-sa.com)  * @author Hugo F  Manrique  */  /**  * Clase: BuscadorDiagnosticosSQL  * Clase encargada del manejo de base de datos para hacer las consultas y las  * actualizaciones que sean necesarias  *  * @package IPSOFT-SIIS  * @version $Revision: 1.1 $  * @copyright (C) 2005 IPSOFT - SA (www.ipsoft-sa.com)  * @author Hugo F  Manrique  */  class BuscadorDiagnosticos  {    /**    * @var array Variable para el manejo de los datos de $_REQUEST    */    var $request = array();    /**    * Constructor de la clase    */    function BuscadorDiagnosticos()    {      $this->request = $_REQUEST;    }    /**    * Funcion donde se crea el buscador    *    * @return string    */    function FormaBuscadorDiagnosticos()    {      $ruta = "BuscadorDiagnosticosI.class.php?";      $action['buscar'] = $ruta.URLRequest(array("datos_vp"=>$this->request['datos_vp']));      $action['paginador'] = $ruta.URLRequest(array("datos_vp"=>$this->request['datos_vp'],"buscador"=>$this->request['buscador']));            $cut = AutoCarga::factory("ClaseUtil");      $html .= ReturnHeader('Buscador');      $html .= ReturnBody()."<br>\n";      $html .= "<script>\n";      $html .= "  function IndicarSeleccion(diagnostico_id, descripcion)\n";      $html .= "  {\n";      $html .= "    window.opener.document.".$this->request['datos_vp']['nombre_forma'].".".$this->request['datos_vp']['nc_diagnostico_id'].".value = diagnostico_id;\n";      $html .= "    window.opener.document.".$this->request['datos_vp']['nombre_forma'].".".$this->request['datos_vp']['nc_diagnostico_descripcion'].".value = descripcion;\n";      if($this->request['datos_vp']['label_descripcion'])        $html .= "    window.opener.document.getElementById('".$this->request['datos_vp']['label_descripcion']."').innerHTML = diagnostico_id +' '+descripcion;\n";      $html .= "    window.close();\n";      $html .= "  }\n";      $html .= "</script>\n";      $html .= $cut->RollOverFilas();      $html .= ThemeAbrirTabla("DIAGNOSTICOS","95%");       $html .= "<form id=\"formBuscaDiagnost1\" name=\"formBuscaDiagnost1\" method=\"post\" action=\"".$action['buscar']."\" > \n";      $html .= "  <table width=\"100%\" align=\"center\" class=\"modulo_table_list\" > \n";      $html .= "    <tr> \n";      $html .= "      <td class=\"formulacion_table_list\" align=\"center\" colspan=\"5\" > BUSQUEDA DE DIAGNOSTICOS</td> \n";      $html .= "    </tr> \n";      $html .= "    <tr class=\"formulacion_table_list\"> \n";      $html .= "      <td width=\"15%\">CODIGO</td> \n";      $html .= "      <td width=\"15%\" class=\"modulo_list_claro\" > \n";      $html .= "        <input type=\"text\" style=\"width:100%\" class=\"input-text\" name=\"buscador[codigo]\" value=\"".$this->request['buscador']['codigo']."\"> \n";      $html .= "      </td> \n";      $html .= "      <td width=\"15%\" >DESCRIPCION</td>\n";      $html .= "      <td class=\"modulo_list_claro\" align=\"center\" > \n";      $html .= "        <input type=\"text\" style=\"width:100%\" class=\"input-text\" name=\"buscador[descripcion]\" value=\"".$this->request['buscador']['descripcion']."\" > \n";      $html .= "      </td> \n";      $html .= "      <td class=\"hc_table_submodulo_list_title\" align=\"center\" > \n";      $html .= "        <input type=\"submit\" class=\"input-submit\" name=\"aceptar\" value=\"Buscar\"\">\n";      $html .= "      </td>\n";      $html .= "    </tr>\n";      $html .= "  </table>\n";      $html .= "</form><br>\n";                        $bls = new BuscadorDiagnosticosSQL();      $diagnosticos = $bls->ObtenerDiagnosticos($this->request['buscador'],$this->request['offset']);            if(!empty($diagnosticos))      {        $html .= "<table width=\"100%\" align=\"center\" class=\"modulo_table_list\" > \n";        $html .= "  <tr class=\"modulo_table_list_title\"> \n";        $html .= "    <td>CODIGO</td>\n";        $html .= "    <td>DIAGNOSTICO</td>\n";                  $html .= "    <td>OP</td>\n";                $html .= "  </tr>\n";                                $conteo = $bls->conteo;        $pagina = $bls->pagina;                $est = "modulo_list_claro"; $back = "#DDDDDD";                  foreach($diagnosticos as $key1 => $vecDiagnos)        {          ($est == "modulo_list_claro")? $est = "modulo_list_oscuro":$est = "modulo_list_claro";           ($back == "#DDDDDD")? $back = "#CCCCCC":$back = "#DDDDDD";                    $html .= "  <tr class=\"".$est."\" onmouseout=mOut(this,\"".$back."\"); onmouseover=mOvr(this,'#FFFFFF'); >\n";          $html .= "    <td>".$vecDiagnos['diagnostico_id']."</td> \n";          $html .= "    <td>".$vecDiagnos['diagnostico_nombre']."</td> \n";                    $html .= "    <td align=\"center\" >\n";          $html .= "      <a href=\"javascript:IndicarSeleccion('".$vecDiagnos['diagnostico_id']."','".$vecDiagnos['diagnostico_nombre']."')\">";                      $html .= "        <img src=\"".GetThemePath()."/images/checkno.png\" border=\"0\">\n";                      $html .= "      </a>\n";                      $html .= "    </td> \n";          $html .= "	</tr>\n";        }        $html .= "</table> \n";        $pghtml = AutoCarga::factory('ClaseHTML');        $html .= $pghtml->ObtenerPaginado($conteo,$pagina,$action['paginador']);                         }      else      {        $html .= "<center>\n";        $html .= "  <label calss=\"label_error\">NO SE ENCONTRARON REGISTROS PARA LA BUSQUEDA SOLICITADA</label>\n";        $html .= "<center>\n";      }      $html .= "<form id=\"cerrar\" name=\"cerar\" method=\"post\" action=\"javascript:window.close()\" >\n";      $html .= "  <table width=\"100%\" align=\"center\" > \n";      $html .= "    <tr> \n";      $html .= "      <td align=\"center\" > \n";      $html .= "        <input type=\"submit\" class=\"input-submit\" name=\"cerar\" value=\"Cerrar\" >\n";      $html .= "      </td>\n";                          $html .= "    </tr>\n";              $html .= "  </table>\n";      $html .= "</form>\n";      $html .= ThemeCerrarTabla();      $html .= "</body>\n";			$html .= "</html>\n";      return $html;                    }                    //Metodo para listar los diagnosticos    function frmListDiagnost($action, $nombDiag, $valOff)    {        $bls = new BuscadorDiagnosticosSQL();                $html .= "<script> ";        $html .= "  function mOvr(src,clrOver){                        src.style.background = clrOver;                    } \n                             function mOut(src,clrIn){                        src.style.background = clrIn;                    } \n ;";                            $html .= "  function selDiagnos(objDiag, objClaDiag){";                for($i=0; $i<5; $i++){            $html .= "document.formBuscaDiagnost1.claseDiagnos_".$i.".disabled = true; ";        }                                                     $html .= "      objClaDiag.disabled = false;                                                document.formBuscaDiagnost1.valClaseDiagnos.value = -1;                        document.formBuscaDiagnost1.valDiagnos.value = objDiag.value;                                                                          alert('diagnosId: ' + document.formBuscaDiagnost1.valDiagnos.value +                               '\\nclaseDiagnos: ' + document.formBuscaDiagnost1.valClaseDiagnos.value);                           } \n                                        function selClaseDiagnos(objClaDiag){                        document.formBuscaDiagnost1.valClaseDiagnos.value = objClaDiag.value;                                                                 alert('Nombre: ' + objClaDiag.name);                        alert('diagnosId: ' + document.formBuscaDiagnost1.valDiagnos.value +         '\\nclaseDiagnos: ' + document.formBuscaDiagnost1.valClaseDiagnos.value);                                        } \n ";                           $html .= "</script> ";        //$html .= "<pre>".print_r($this->request, true)."</pre> \n";                                return $html;    }  }	  $VISTA = 'HTML';  $_ROOT = '../../';  include $_ROOT.'includes/enviroment.inc.php';  include $_ROOT.'classes/BuscadorDiagnosticosI/BuscadorDiagnosticosSQL.class.php';  $fileName = "themes/$VISTA/".GetTheme()."/module_theme.php";    IncludeClass("AutoCarga");  IncludeFile($fileName);  $bsc = new BuscadorDiagnosticos();  echo $bsc->FormaBuscadorDiagnosticos();?>